<?php
///-build_id: 2017010213.5255
/// This source file is subject to the Software License Agreement that is bundled with this 
/// package in the file license.txt, or you can get it here
/// http://addons-modules.com/en/content/3-terms-and-conditions-of-use
///
/// @copyright  2009-2016 Addons-Modules.com
///  If you need open code to customize or merge code with othe modules, please contact us.
if (!defined('_PS_VERSION_'))
	exit;

if(file_exists(_PS_ROOT_DIR_  . "/modules/agilemultipleseller/agilemultipleseller.php"))
	include_once(_PS_ROOT_DIR_  . "/modules/agilemultipleseller/agilemultipleseller.php");

class AgileSellerCommission extends Module
{
	const VOUCHER_COST_AT_STORE = 1;
	const VOUCHER_COST_AT_SELLER = 2;

	const COMISSION_MODE_SELLER = 0;
	const COMISSION_MODE_CATEGORY = 1;
	
	private	$_html = '';
	private $_postErrors = array();

	function __construct()   {    $this->agile_configs = Configuration::getMultiple($this->getConfigKeys());      $this->agile_dependencies = array('agilemultipleseller' => '3.7.0.1', 'agilekernel'=>'1.7.1.0');     $this->agile_newfiles = array();      $this->name = 'agilesellercommission';    $this->isAgileKernelCompatible = true;    $this->tab = 'administration';       $this->author = 'addons-modules.com';    $this->version = '2.7.0.3';    $this->ps_versions_compliancy = array('min' => '1.7', 'max' => '1.8');    $this->dependencies = array('agilemultipleseller','agilekernel');    $this->bootstrap = true;      parent::__construct();        $this->displayName = $this->l('Agile Seller Commission module');    $this->description = $this->l('Enable seller commission related functions');       }     private function getConfigKeys()  {   return array('ASC_RT_COMMISSION_AT','ASC_CT_COMMISSION_AT','ASC_COMMISSION_CURRENCY','ASC_PAYPAL_SANDBOX','ASC_COMMISSION_MODE','ASC_USE_PAYPAL','ASC_PAYPAL_EMAIL','ASC_PAYPAL_HEADER','ASC_SHIPPING_INCLUDE','ASC_DEDUCTION_CHOICE_1','ASC_DEDUCTION_CHOICE_0','ASC_TAX_INCLUDE','ASC_VOUCHER_COST');  }      function install()   {      if(!Module::isInstalled('agilekernel'))    {     $this->_errors[] = $this->l('You have to install Agile Kernel module before installing this module. The download link of this module should have been included your download email for your order. If you can not find it, please request by email to support@addons-modules.com with your order #.');     return false;    }      if(!$this->AgilePreinstall())return false;              if  (parent::install() == false )    {     $this->_errors[] = $this->l('Install error - call parent::install()');     return false;    }                            AgileInstaller::add_field_ifnotexists('commission_rate','deduction_rate','float(16,2)','NULL');          AgileInstaller::add_field_ifnotexists('seller_commission','deduction_amount','float(16,2)','NULL');          AgileInstaller::add_field_ifnotexists('seller_commission','order_origin','int(10)','NULL');    AgileInstaller::add_field_ifnotexists('seller_commission','tokens_used','float(16,2)','0');           if  ($this->AgileSetDefaultConfig('ASC_RT_COMMISSION_AT', AgileMultipleSeller::getCommissionCancellationDefaultStatuses()) == false     OR $this->AgileSetDefaultConfig('ASC_CT_COMMISSION_AT', AgileMultipleSeller::getCommissionCreationDefaultStatuses()) == false     OR $this->AgileSetDefaultConfig('ASC_COMMISSION_CURRENCY', Configuration::get('PS_CURRENCY_DEFAULT')) == false     OR $this->AgileSetDefaultConfig('ASC_PAYPAL_SANDBOX', '1') == false     OR $this->AgileSetDefaultConfig('ASC_COMMISSION_MODE', self::COMISSION_MODE_SELLER) == false     OR $this->AgileSetDefaultConfig('ASC_USE_PAYPAL', '1') == false     OR $this->AgileSetDefaultConfig('ASC_PAYPAL_EMAIL', '') == false     OR $this->AgileSetDefaultConfig('ASC_PAYPAL_HEADER', '') == false     OR $this->AgileSetDefaultConfig('ASC_SHIPPING_INCLUDE', 1) == false     OR $this->AgileSetDefaultConfig('ASC_TAX_INCLUDE', 1) == false     OR $this->AgileSetDefaultConfig('ASC_VOUCHER_COST', self::VOUCHER_COST_AT_STORE) == false     OR $this->AgileSetDefaultConfig('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP, 0) == false     OR $this->AgileSetDefaultConfig('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY, 0) == false     )    {     $this->_errors[] = $this->l('Install error - initialize configuration settings');     return  false;    }        try    {        $R44B1740495C3DC5BAB56D0F3706FEA4F = intval(Configuration::get('AGILE_MS_PROFILE_ID'));     if(!AgileInstaller::create_tab('Seller Commissions','SellerCommissionsParent','AgileModulesParent', $this->name))return false;     AgileInstaller::init_tab_prmission_for_existing_profiles('SellerCommissionsParent',1,1,1,1);     AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'SellerCommissionsParent',1,0,0,0);        if(!AgileInstaller::create_tab('Transaction Fees','AdminBaseCommissionRates','SellerCommissionsParent', $this->name))return false;     AgileInstaller::init_tab_prmission_for_existing_profiles('AdminBaseCommissionRates',1,1,1,1);     AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'AdminBaseCommissionRates',1,0,0,0);       if(!AgileInstaller::create_tab('Commission Rates(Per Seller)','AdminRangeCommissionRates', 'SellerCommissionsParent', $this->name))return false;     AgileInstaller::init_tab_prmission_for_existing_profiles('AdminRangeCommissionRates',1,1,1,1);     AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'AdminRangeCommissionRates', 1,0,0,0);       if(!AgileInstaller::create_tab('Account History','AdminCommissions','SellerCommissionsParent',$this->name))return false;     AgileInstaller::init_tab_prmission_for_existing_profiles('AdminCommissions',1,1,1,1);     AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'AdminCommissions', 1,0,0,0);       if(!AgileInstaller::create_tab('Account Balance','AdminCommissionBalances','SellerCommissionsParent',$this->name))return false;     AgileInstaller::init_tab_prmission_for_existing_profiles('AdminCommissionBalances',1,1,1,1);     AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'AdminCommissionBalances', 1,0,0,0);      }    catch(Exception $R0D54236DA20594EC13FC81B209733931)    {     $this->_errors[] = $this->l('Install error - register tabs : ' . $R0D54236DA20594EC13FC81B209733931->getMessage());     return false;    }        try    {        Db::getInstance()->Execute('UPDATE ' . _DB_PREFIX_ . 'seller_commission SET record_type=102 WHERE record_type=101 AND record_balance<0');     Db::getInstance()->Execute('UPDATE ' . _DB_PREFIX_ . 'seller_commission SET record_type=101 WHERE record_type=102 AND record_balance>0');          Db::getInstance()->Execute('UPDATE ' . _DB_PREFIX_ . 'seller_commission SET record_type=3 WHERE record_type=0');       Autoload::getInstance()->generateIndex();     $this->prepareDefaultCommissionSetting();     AgileInstaller::ensureSellerReadModulePermission(Configuration::get('AGILE_MS_PROFILE_ID'), array('READ'));      }    catch(Exception $R0D54236DA20594EC13FC81B209733931)    {     $this->_errors[] = $this->l('Install error - others : ' . $R0D54236DA20594EC13FC81B209733931->getMessage());     return false;    }        return true;   }        public function uninstall()      {              if(!parent::uninstall())return false;      AgileInstaller::delete_tab('AdminCommissions');    AgileInstaller::delete_tab('AdminBaseCommissionRates');    AgileInstaller::delete_tab('AdminRangeCommissionRates');    AgileInstaller::delete_tab('AdminCommissionBalances');    AgileInstaller::delete_tab('AdminCategoryCommissionRates');      AgileInstaller::delete_tab('SellerCommissionsParent');        return true;      }     public function getContent()   {    include_once(_PS_ROOT_DIR_  . "/modules/agilemultipleseller/agilemultipleseller.php");       $this->_html = '<h2>'.$this->displayName.'</h2>';        $R0E50532F705BA890C56DC90FC3472539 = AgileInstaller::detect_admin_folder($_SERVER['SCRIPT_FILENAME']);    $R5A0E1B3F4DE39462E7CECCA34A34D7E1 = AgileInstaller::install_health_check($this->agile_newfiles, $this->name, $R0E50532F705BA890C56DC90FC3472539);    if(!empty($R5A0E1B3F4DE39462E7CECCA34A34D7E1)) $this->_html .= $R5A0E1B3F4DE39462E7CECCA34A34D7E1;        $this->_html .= AgileInstaller::show_agile_links();    if (Tools::isSubmit('submitSetting'))    {        $R18744FB24E9F887B0ED93080F8A0301F = Tools::getValue('id_order_state_rt_commission');     Configuration::updateValue('ASC_RT_COMMISSION_AT', $R18744FB24E9F887B0ED93080F8A0301F);       $RC7398767CC528ADCB08CA3F76BE7C7AF = Tools::getValue('id_order_state_ct_commission');     Configuration::updateValue('ASC_CT_COMMISSION_AT', $RC7398767CC528ADCB08CA3F76BE7C7AF);          $RAAC0583F41E071BC5FCC156B15CCF856 = intval(Tools::getValue('commission_currency'));     Configuration::updateValue('ASC_COMMISSION_CURRENCY', $RAAC0583F41E071BC5FCC156B15CCF856);          $RB7C04CB8FF83DC89BA49F6E8DAAA48B7 = Tools::getValue('paypal_email');     Configuration::updateValue('ASC_PAYPAL_EMAIL', $RB7C04CB8FF83DC89BA49F6E8DAAA48B7);                $R1FADA53F9B19C70CCBFD13F7CDDEDB64 = Tools::getValue('paypal_header');     Configuration::updateValue('ASC_PAYPAL_HEADER', $R1FADA53F9B19C70CCBFD13F7CDDEDB64);          $R575FB563544B1414D5FE3126AC46F6CD = intval(Tools::getValue('paypal_sandbox'));     Configuration::updateValue('ASC_PAYPAL_SANDBOX', $R575FB563544B1414D5FE3126AC46F6CD);       $RC35FEEF6892B6EB2699FAF6E11982A8A = intval(Tools::getValue('commission_mode'));     Configuration::updateValue('ASC_COMMISSION_MODE', $RC35FEEF6892B6EB2699FAF6E11982A8A);        AgileInstaller::delete_tab('AdminRangeCommissionRates');     AgileInstaller::delete_tab('AdminCategoryCommissionRates');     $R44B1740495C3DC5BAB56D0F3706FEA4F = intval(Configuration::get('AGILE_MS_PROFILE_ID'));     if($RC35FEEF6892B6EB2699FAF6E11982A8A == self::COMISSION_MODE_CATEGORY)     {      if(!AgileInstaller::create_tab('Commission Rates(Per Category)','AdminCategoryCommissionRates','AgileMarketPlace',$this->name))return false;      AgileInstaller::init_tab_prmission_for_existing_profiles('AdminCategoryCommissionRates',1,1,1,1);      AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'AdminCategoryCommissionRates', 1,0,0,0);         }     else     {      if(!AgileInstaller::create_tab('Commission Rates(Per Seller)','AdminRangeCommissionRates', 'AgileMarketPlace',$this->name))return false;      AgileInstaller::init_tab_prmission_for_existing_profiles('AdminRangeCommissionRates',1,1,1,1);      AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'AdminRangeCommissionRates', 1,0,0,0);     }       $RFBF9B94ABD7BFB50267BBA167B79B8DE = intval(Tools::getValue('use_paypal'));     Configuration::updateValue('ASC_USE_PAYPAL', $RFBF9B94ABD7BFB50267BBA167B79B8DE);             $R1E53524E43D1860D1D97E5799B748E74 = intval(Tools::getValue('shipping_include'));     Configuration::updateValue('ASC_SHIPPING_INCLUDE', $R1E53524E43D1860D1D97E5799B748E74);       $R1D69EF984893C862A4C67016C5249AF7 = intval(Tools::getValue('tax_include'));     Configuration::updateValue('ASC_TAX_INCLUDE', $R1D69EF984893C862A4C67016C5249AF7);          $R3FE6D08F75CF7B24BF21F299D39D5559 = intval(Tools::getValue('voucher_cost'));     Configuration::updateValue('ASC_VOUCHER_COST', $R3FE6D08F75CF7B24BF21F299D39D5559);       Configuration::updateValue('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY, intval(Tools::getValue('deduction_choice_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY)));     Configuration::updateValue('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP, intval(Tools::getValue('deduction_choice_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP)));       $this->displayConf();    }              $this->displayForm();    $this->fieldsVisibilityJS();    return $this->_html;   }     private function fieldsVisibilityJS()   {    $this->_html .= '     <script type="text/javascript">      $(document).ready(function() {       $("#use_paypal_yes").click(function(){        togglePaymentFields(1);       });       $("#use_paypal_no").click(function(){        togglePaymentFields(0);       });              togglePaymentFields(' . (int)Configuration::get('ASC_USE_PAYPAL') . ');           $("#commission_mode_seller").click(function(){        toggleCommissionModeFields(0);       });       $("#commission_mode_category").click(function(){        toggleCommissionModeFields(1);       });       toggleCommissionModeFields(' . (int)Configuration::get('ASC_COMMISSION_MODE') . ');             });            function togglePaymentFields(usePaypal){       if(usePaypal){        $("#paypal_sandbox_yes").parent().parent().parent().parent().show();        $("#paypal_email").parent().parent().show();        $("#paypal_header").parent().parent().show();       }       else{        $("#paypal_sandbox_yes").parent().parent().parent().parent().hide();        $("#paypal_email").parent().parent().hide();        $("#paypal_header").parent().parent().hide();       }           }        function toggleCommissionModeFields(commissionMode){       if(commissionMode == 0){        $("#shipping_include_yes").parent().parent().parent().parent().show();        $("#deduction_choice_0").parent().parent().parent().parent().show();       }       else{        $("#shipping_include_yes").parent().parent().parent().parent().hide();        $("#deduction_choice_0").parent().parent().parent().parent().hide();       }      }       </script>    ';    }     public function displayConf()   {    $this->_html .= $this->displayConfirmation($this->l('Settings updated'));   }     public function displayForm()   {    include_once(_PS_ROOT_DIR_  . "/modules/agilemultipleseller/agilemultipleseller.php");                 $RC91C47F484460FFE82CE832D44A8DA99 = Currency::getCurrencies();      $R82480D518A58E7C87C13FBE2DABA8AF3=array();    array_push($R82480D518A58E7C87C13FBE2DABA8AF3, array(       'id' =>  AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP,       'val' => 1,     'name' => $this->l('Apply deductions to orders from this store - This option is available only when you use [Commission Mode] of [Per Seller]'),      ));    if(Module::isInstalled('prestabay')) {     array_push($R82480D518A58E7C87C13FBE2DABA8AF3, array(       'id' =>  AgileMultipleSeller::ORDER_ORIGIN_EBAY,       'val' => 1,      'name' => $this->l('Apply deductions to orders from this store - This option is available only when you use [Commission Mode] of [Per Seller]'),      ));    }      $RD05A28496998D5D330106BBAE629B948 = array(     'form' => array(      'legend' => array(       'title' => $this->l('Seller Commision Settings'),       'image' => $this->_path.'logo.png',      ),      'input' => array(       array(        'type' => 'radio',         'label' => $this->l('Use Paypal Payment: '),        'name' => 'use_paypal',        'values' => array(         array(          'id' => 'use_paypal_yes',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'use_paypal_no',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => array(          $this->l('Please choose if your store will use Paypal as payment method to perform payments between seller and store.') ,        )       ),       array(        'type' => 'text',        'label' => $this->l('Paypal Header Image: '),        'name' => 'paypal_header',       ),       array(        'type' => 'text',        'label' => $this->l('Store Paypal Email: '),        'name' => 'paypal_email',        'desc' => array(         $this->l('When seller chooses commissions, this Paypal account be used.')         )       ),       array(        'type' => 'radio',         'label' => $this->l('Sandbox Mode: '),        'name' => 'paypal_sandbox',        'values' => array(         array(          'id' => 'paypal_sandbox_yes',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'paypal_sandbox_no',          'value' => 0,          'label' => $this->l('No'),         ),        ),       ),                 array(        'type' => 'select',        'label' => $this->l('Commission Currency: '),        'name' => 'commission_currency',        'options' => array(         'query' => $RC91C47F484460FFE82CE832D44A8DA99,         'id' => 'id_currency',         'name' => 'name'        ),        'desc' => array(         $this->l('Please choose the currency that you used for commission payment and calculation.'),         '<font color="red">' . $this->l('DO NOT change currency once you start doing business.') . '</font>&nbsp;' . $this->l('Otherwise, the balance calculation will be incorrect.')        )       ),       array(        'type' => 'text',        'label' => $this->l('Return commission at: '),        'name' => 'id_order_state_rt_commission',        'desc' => array(         $this->l('Plase enter list of order status ID that will trigger creating the commission back to seller(Commission will be created one time only).') ,         $this->l('Please enter the status ID separated by comma for example: 6,7 (find all available order statuses and IDs at Orders - Statueses tab)')         )       ),               array(        'type' => 'text',        'label' => $this->l('Create commission at: '),        'name' => 'id_order_state_ct_commission',        'desc' => array(         $this->l('Plase enter list of order status ID that will trigger returning the commission back to seller(Commission will be returned one time only).') ,         $this->l('Please enter the status ID separated by comma for example: 2,4,5 (find all available order statuses and IDs at Orders - Statueses tab)')        )       ),             array(        'type' => 'radio',        'label' => $this->l('Commission Mode: '),        'name' => 'commission_mode',        'values' => array(         array(          'id' => 'commission_mode_seller',          'value' => self::COMISSION_MODE_SELLER,          'label' => $this->l('Per Seller - You can set commission rate based seller and order amount range')         ),         array(          'id' => 'commission_mode_category',          'value' => self::COMISSION_MODE_CATEGORY,          'label' => $this->l('Per Category - You can set commission rate based on product category '),         ),        ),       ),         array(        'type' => 'radio',        'label' => $this->l('Shipping fee in commission: '),        'name' => 'shipping_include',        'values' => array(         array(          'id' => 'shipping_include_yes',          'value' => 1,           'label' => $this->l('Yes - This option is available only when you use [Commission Mode] of [Per Seller]')         ),         array(          'id' => 'shipping_include_no',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => array(         $this->l('Do you want shipping fees to be included in the commission fee(commission) calculation?')         )       ),         array(        'type' => 'checkbox',        'label' => $this->l('Deduction Handling: '),        'name' => 'deduction_choice',        'values' => array(         'query' => $R82480D518A58E7C87C13FBE2DABA8AF3,         'id' => 'id',         'name' => 'name'        ),        'desc' => array(            $this->l('You deduct a percentage (for example 10%) from total sale amount, apply 90% of total for commission calculation.') ,            $this->l('You must specify the deduction rate in the Commission Fee setting in "Customer"->"Commission Fees" tab.')        )       ),             array(        'type' => 'radio',        'label' => $this->l('Tax include in commission: '),        'name' => 'tax_include',        'values' => array(         array(          'id' => 'tax_include_yes',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'tax_include_no',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => array(          $this->l('Do you want tax to be included in the commission fee(commission) calculation?')         )       ),       array(        'type' => 'radio',        'label' => $this->l('Discount voucher handling: '),        'name' => 'voucher_cost',        'values' => array(         array(          'id' => 'voucher_cost_store',          'value' => 1,          'label' => $this->l('At store cost').' - ' . $this->l('Store will take care of the cost.'),         ),         array(          'id' => 'voucher_cost_seller',          'value' => 2,          'label' => $this->l('At sellers cost') . ' - ' . $this->l('Sellers will share the cost by percentage of amount of the products in an order. ') ,         ),        ),        'desc' => array(         $this->l('All vouchers belong to store level, including vouchers converted from customer loyalty points.')         )       ),      ),      'submit' => array(       'title' => $this->l('Save'),      )     )    );      $R3A1E73211A105E82A8C89F8C8E3C8264 = new HelperForm();    $R3A1E73211A105E82A8C89F8C8E3C8264->show_toolbar = false;    $R3A1E73211A105E82A8C89F8C8E3C8264->table =  $this->name;    $R51C716B9664B3F4E109066C05B9B1A86 = new Language((int)Configuration::get('PS_LANG_DEFAULT'));    $R3A1E73211A105E82A8C89F8C8E3C8264->default_form_language = $R51C716B9664B3F4E109066C05B9B1A86->id;    $R3A1E73211A105E82A8C89F8C8E3C8264->module = $this;    $R3A1E73211A105E82A8C89F8C8E3C8264->allow_employee_form_lang = Configuration::get('PS_BO_ALLOW_EMPLOYEE_FORM_LANG') ? Configuration::get('PS_BO_ALLOW_EMPLOYEE_FORM_LANG') : 0;    $R3A1E73211A105E82A8C89F8C8E3C8264->identifier = $this->identifier;    $R3A1E73211A105E82A8C89F8C8E3C8264->submit_action = 'submitSetting';    $R3A1E73211A105E82A8C89F8C8E3C8264->currentIndex = $this->context->link->getAdminLink('AdminModules', false).'&configure='.$this->name.'&tab_module='.$this->tab.'&module_name='.$this->name;    $R3A1E73211A105E82A8C89F8C8E3C8264->token = Tools::getAdminTokenLite('AdminModules');    $R3A1E73211A105E82A8C89F8C8E3C8264->tpl_vars = array(     'fields_value' => $this->getConfigFieldsValues(),     'languages' => $this->context->controller->getLanguages(),     'id_language' => $this->context->language->id    );      $this->_html .=  $R3A1E73211A105E82A8C89F8C8E3C8264->generateForm(array($RD05A28496998D5D330106BBAE629B948));     }     public function getConfigFieldsValues()   {    $RAD18A3B70BBA0E07328F61AA60763FD4 = array('ASC_PAYPAL_EMAIL','ASC_PAYPAL_SANDBOX','ASC_COMMISSION_MODE','ASC_USE_PAYPAL','ASC_PAYPAL_HEADER','ASC_COMMISSION_CURRENCY','ASC_RT_COMMISSION_AT','ASC_CT_COMMISSION_AT','ASC_SHIPPING_INCLUDE','ASC_TAX_INCLUDE','ASC_VOUCHER_COST','ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP,'ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY);    $RBAAA917A11E347C49C3462A9383AE5BD = Configuration::getMultiple($RAD18A3B70BBA0E07328F61AA60763FD4);      return array(     'paypal_email' => Tools::getValue('paypal_email', array_key_exists('ASC_PAYPAL_EMAIL', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_PAYPAL_EMAIL'] : ''),     'paypal_sandbox' => Tools::getValue('paypal_sandbox', array_key_exists('ASC_PAYPAL_SANDBOX', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_PAYPAL_SANDBOX'] : ''),     'commission_mode' => Tools::getValue('commission_mode', array_key_exists('ASC_COMMISSION_MODE', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_COMMISSION_MODE'] : ''),     'use_paypal' => Tools::getValue('use_paypal', array_key_exists('ASC_USE_PAYPAL', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_USE_PAYPAL'] : ''),     'paypal_header' => Tools::getValue('paypal_header', array_key_exists('ASC_PAYPAL_HEADER', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_PAYPAL_HEADER'] : ''),     'commission_currency' => Tools::getValue('commission_currency', array_key_exists('ASC_COMMISSION_CURRENCY', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_COMMISSION_CURRENCY'] : ''),     'id_order_state_rt_commission' => Tools::getValue('id_order_state_rt_commission', array_key_exists('ASC_RT_COMMISSION_AT', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_RT_COMMISSION_AT'] : ''),     'id_order_state_ct_commission' => Tools::getValue('id_order_state_ct_commission', array_key_exists('ASC_CT_COMMISSION_AT', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_CT_COMMISSION_AT'] : ''),     'shipping_include' => Tools::getValue('shipping_include', array_key_exists('ASC_SHIPPING_INCLUDE', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_SHIPPING_INCLUDE'] : ''),     'tax_include' => Tools::getValue('tax_include', array_key_exists('ASC_TAX_INCLUDE', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_TAX_INCLUDE'] : ''),     'voucher_cost' => Tools::getValue('voucher_cost', array_key_exists('ASC_VOUCHER_COST', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_VOUCHER_COST'] : ''),     'deduction_choice_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP => Tools::getValue('deduction_choice_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP,intval(array_key_exists('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP, $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP] : '')),     'deduction_choice_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY => Tools::getValue('deduction_choice_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY,intval(array_key_exists('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY, $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY] : '')),    );   }     public function displayErrors()   {    $R5E535DBA6BC26B2ECEEF3DA589516785 = sizeof($this->_postErrors);    $this->_html .= '    <div class="module_error alert alert-danger">     <h3>'.($R5E535DBA6BC26B2ECEEF3DA589516785 > 1 ? $this->l('There are') : $this->l('There is')).' '.$R5E535DBA6BC26B2ECEEF3DA589516785.' '.($R5E535DBA6BC26B2ECEEF3DA589516785 > 1 ? $this->l('errors') : $this->l('error')).'</h3>     <ol>';    foreach ($this->_postErrors AS $RB5ADDE8D7D7412251F47419FE9BF51A7)     $this->_html .= '<li>'.$RB5ADDE8D7D7412251F47419FE9BF51A7.'</li>';    $this->_html .= '     </ol>    </div>';   }                                        public static function createSellerCommission($R56EA904D533235F889591E04DE8C6B68, $RDF830F9CB8C1732381AC17B92807939D = 0)      {          if(!Module::isInstalled('agilemultipleseller'))return;    require_once(dirname(__FILE__) .'/../agilemultipleseller/agilemultipleseller.php');    require_once(dirname(__FILE__) .'/SellerCommission.php');    require_once(dirname(__FILE__) .'/BaseCommissionRate.php');    require_once(dirname(__FILE__) .'/RangeCommissionRate.php');    require_once(dirname(__FILE__) .'/CategoryCommissionRate.php');                    $R618D46BFB3D9579915B90EC4A8003FD8 = (intval(Configuration::get('ASC_SHIPPING_INCLUDE'))==1);    $RD2E4221754276C36B2C961E8CF4CE0AC = (intval(Configuration::get('ASC_TAX_INCLUDE'))==1);    $RA413954C9275A825961B03387857680F = (intval(Configuration::get('ASC_VOUCHER_COST'))==self::VOUCHER_COST_AT_SELLER);    $R582372929C059F6FA4A84BA4F760C251 = AgileMultipleSeller::get_seller_sales_from_order($R56EA904D533235F889591E04DE8C6B68->id, $R618D46BFB3D9579915B90EC4A8003FD8,$RA413954C9275A825961B03387857680F, $RD2E4221754276C36B2C961E8CF4CE0AC);    $RB872CA91835A318C2496C985F925F690 = AgileMultipleSeller::get_seller_sales_from_order($R56EA904D533235F889591E04DE8C6B68->id, true ,$RA413954C9275A825961B03387857680F, true);          $R2D406961C94DCD35D73719B5EEF83A16 = new Currency((int)Configuration::get('ASC_COMMISSION_CURRENCY'));    $R982D82AB19D549185E77D69EDC88590C = new Currency($R56EA904D533235F889591E04DE8C6B68->id_currency);                 foreach ($R582372929C059F6FA4A84BA4F760C251 AS $R95909C49377A2B4F24C79D29C629AF65 => $R2B94D73078EA36E557524750E50CAC48)    {        if(intval($R95909C49377A2B4F24C79D29C629AF65)<=0)continue;                            $R34CD0CD32ADCA6EF99053114A747410E = (int)SellerCommission::getCommissionRecordID($R56EA904D533235F889591E04DE8C6B68->id,$R95909C49377A2B4F24C79D29C629AF65);        if($R34CD0CD32ADCA6EF99053114A747410E>0)continue;                 $R005607C5DB49D5FDB3DD5714B5AE8340 =  $R2B94D73078EA36E557524750E50CAC48 *  $R2D406961C94DCD35D73719B5EEF83A16->conversion_rate/$R982D82AB19D549185E77D69EDC88590C->conversion_rate;        $RE93194D15E811317AC1FBBD2FAFDF42D =  $RB872CA91835A318C2496C985F925F690[$R95909C49377A2B4F24C79D29C629AF65] *  $R2D406961C94DCD35D73719B5EEF83A16->conversion_rate/$R982D82AB19D549185E77D69EDC88590C->conversion_rate;                 $R30573444EF866FA1971A41176B44EE37 = 0;     $RD10DD22F90C1536E6748FF3D8A937A4E = 0;     if(Configuration::get('ASC_COMMISSION_MODE') == self::COMISSION_MODE_CATEGORY)     {      $R30573444EF866FA1971A41176B44EE37 = self::get_seller_categorycommission_from_cart($R95909C49377A2B4F24C79D29C629AF65, $R56EA904D533235F889591E04DE8C6B68->id_cart);     }     else     {      $R6ECC060ABBBDE39E26308F0BD5065F2B = RangeCommissionRate::getRate((int)$R95909C49377A2B4F24C79D29C629AF65,$R005607C5DB49D5FDB3DD5714B5AE8340,RangeCommissionRate::RATE_FOR_COMMISSION);         if( ($RDF830F9CB8C1732381AC17B92807939D == AgileMultipleSeller::ORDER_ORIGIN_EBAY AND intval(Configuration::get('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY)) ==1)       OR       ($RDF830F9CB8C1732381AC17B92807939D == AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP AND intval(Configuration::get('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP)) ==1)      )        $R4BE09637F709519ED86C7D7C6E09156F =  RangeCommissionRate::getRate((int)$R95909C49377A2B4F24C79D29C629AF65,$R005607C5DB49D5FDB3DD5714B5AE8340,RangeCommissionRate::RATE_FOR_DEDUCTION);             else       $R4BE09637F709519ED86C7D7C6E09156F =  0;            $R30573444EF866FA1971A41176B44EE37 = $R582372929C059F6FA4A84BA4F760C251[$R95909C49377A2B4F24C79D29C629AF65] * (1 - $R4BE09637F709519ED86C7D7C6E09156F * 0.01) * floatval($R6ECC060ABBBDE39E26308F0BD5065F2B) * 0.01 *  $R2D406961C94DCD35D73719B5EEF83A16->conversion_rate/$R982D82AB19D549185E77D69EDC88590C->conversion_rate;      }                         $RD10DD22F90C1536E6748FF3D8A937A4E = BaseCommissionRate::getBaseCommissionRate($R95909C49377A2B4F24C79D29C629AF65);                $R92C7BD05EEE9798F658DB7A6771B074E = new SellerCommission();              $R92C7BD05EEE9798F658DB7A6771B074E->id_seller = $R95909C49377A2B4F24C79D29C629AF65;              $R92C7BD05EEE9798F658DB7A6771B074E->id_order = $R56EA904D533235F889591E04DE8C6B68->id;              $R92C7BD05EEE9798F658DB7A6771B074E->id_currency = $R2D406961C94DCD35D73719B5EEF83A16->id;              $R92C7BD05EEE9798F658DB7A6771B074E->sales_amount = $RE93194D15E811317AC1FBBD2FAFDF42D;              $R92C7BD05EEE9798F658DB7A6771B074E->base_commission = $RD10DD22F90C1536E6748FF3D8A937A4E;              $R92C7BD05EEE9798F658DB7A6771B074E->range_commission = $R30573444EF866FA1971A41176B44EE37;              if( ($RDF830F9CB8C1732381AC17B92807939D == AgileMultipleSeller::ORDER_ORIGIN_EBAY AND intval(Configuration::get('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY)) ==1)                  OR                  ($RDF830F9CB8C1732381AC17B92807939D == AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP AND intval(Configuration::get('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP)) ==1)                 )                   $R92C7BD05EEE9798F658DB7A6771B074E->deduction_amount = $R582372929C059F6FA4A84BA4F760C251[$R95909C49377A2B4F24C79D29C629AF65] * $R4BE09637F709519ED86C7D7C6E09156F * 0.01  * $R2D406961C94DCD35D73719B5EEF83A16->conversion_rate/$R982D82AB19D549185E77D69EDC88590C->conversion_rate;              else                  $R92C7BD05EEE9798F658DB7A6771B074E->deduction_amount = 0;                                            $R92C7BD05EEE9798F658DB7A6771B074E->order_origin = $RDF830F9CB8C1732381AC17B92807939D;          $R92C7BD05EEE9798F658DB7A6771B074E->seller_sales =  $RE93194D15E811317AC1FBBD2FAFDF42D - $RD10DD22F90C1536E6748FF3D8A937A4E - $R30573444EF866FA1971A41176B44EE37 - $R92C7BD05EEE9798F658DB7A6771B074E->deduction_amount;                                                                                      $R92C7BD05EEE9798F658DB7A6771B074E->record_type = SellerCommission::RECORD_TYPE_BUYER_PAY_STORE;                $R92C7BD05EEE9798F658DB7A6771B074E->record_balance = $R92C7BD05EEE9798F658DB7A6771B074E->seller_sales;                          $R92C7BD05EEE9798F658DB7A6771B074E->payment_txn_id = '';              $R92C7BD05EEE9798F658DB7A6771B074E->date_add = date('Y-m-d H:i:s');              $R92C7BD05EEE9798F658DB7A6771B074E->memo = Mail::l('Order Confirmed');        if(Module::isInstalled('agileprepaidcredit'))     {      require_once(_PS_ROOT_DIR_  .'/modules/agileprepaidcredit/agileprepaidcredit.php');      $RC6375B5CB74000BDF34BAD706EA96DB5  = AgilePrepaidCredit::tokens_used_in_cart($R56EA904D533235F889591E04DE8C6B68->id_cart);      if($RC6375B5CB74000BDF34BAD706EA96DB5 >0)      {        $R10F633CE723F16EFC27F400DC30CF004 = AgilePrepaidCredit::ConvertTokens2Price($RC6375B5CB74000BDF34BAD706EA96DB5, $R2D406961C94DCD35D73719B5EEF83A16->id);       $R92C7BD05EEE9798F658DB7A6771B074E->tokens_used = $R10F633CE723F16EFC27F400DC30CF004;      }     }                    $R92C7BD05EEE9798F658DB7A6771B074E->save();                                                    SellerCommission::updateRecordType($R56EA904D533235F889591E04DE8C6B68->id, intval(Configuration::get('AGILE_MS_PAYMENT_MODE')), '');    }      }          public static function cancelSellerCommission($R56EA904D533235F889591E04DE8C6B68)      {          if(!Module::isInstalled('agilemultipleseller'))return;    require_once(dirname(__FILE__) .'/../agilemultipleseller/agilemultipleseller.php');    require_once(dirname(__FILE__) .'/SellerCommission.php');    require_once(dirname(__FILE__) .'/BaseCommissionRate.php');    require_once(dirname(__FILE__) .'/RangeCommissionRate.php');            $R4C40966EA8337EFDF326315499413376 = AgileMultipleSeller::getSellersByOrder($R56EA904D533235F889591E04DE8C6B68->id);            foreach($R4C40966EA8337EFDF326315499413376 AS $R17AC9BFA1ABB066C772CEAE0B3CD86E9)          {              $R95909C49377A2B4F24C79D29C629AF65 = intval($R17AC9BFA1ABB066C772CEAE0B3CD86E9['id_employee']);           $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT id_seller_commission FROM ' . _DB_PREFIX_ . 'seller_commission WHERE record_type= ' . SellerCommission::RECORD_TYPE_ORDER_CANCELLATION . ' AND id_order=' . $R56EA904D533235F889591E04DE8C6B68->id . ' AND id_seller=' . $R95909C49377A2B4F24C79D29C629AF65;        $R9E73CFF475431B450299602E95FF3041 = intval(Db::getInstance()->getValue($R130D64A4AD653C91E0FD80DE8FEADC3A));              if($R9E73CFF475431B450299602E95FF3041>0)continue;                           $R34CD0CD32ADCA6EF99053114A747410E = SellerCommission::getCommissionRecordID($R56EA904D533235F889591E04DE8C6B68->id, $R95909C49377A2B4F24C79D29C629AF65);                            $R92C7BD05EEE9798F658DB7A6771B074E = new SellerCommission($R34CD0CD32ADCA6EF99053114A747410E);                            if(Validate::isLoadedObject($R92C7BD05EEE9798F658DB7A6771B074E))              {                                  $R92C7BD05EEE9798F658DB7A6771B074E->id = 0;                                  $R92C7BD05EEE9798F658DB7A6771B074E->record_type = SellerCommission::RECORD_TYPE_ORDER_CANCELLATION;                                  $R92C7BD05EEE9798F658DB7A6771B074E->sales_amount = 0 - $R92C7BD05EEE9798F658DB7A6771B074E->sales_amount;                  $R92C7BD05EEE9798F658DB7A6771B074E->base_commission = 0 - $R92C7BD05EEE9798F658DB7A6771B074E->base_commission;                  $R92C7BD05EEE9798F658DB7A6771B074E->range_commission = 0 - $R92C7BD05EEE9798F658DB7A6771B074E->range_commission;                  $R92C7BD05EEE9798F658DB7A6771B074E->seller_sales =  0 - $R92C7BD05EEE9798F658DB7A6771B074E->seller_sales;                  $R92C7BD05EEE9798F658DB7A6771B074E->record_balance =  0 - $R92C7BD05EEE9798F658DB7A6771B074E->record_balance;                  $R92C7BD05EEE9798F658DB7A6771B074E->deduction_amount =  0 - $R92C7BD05EEE9798F658DB7A6771B074E->deduction_amount;                  $R92C7BD05EEE9798F658DB7A6771B074E->memo = Mail::l('Order cancalled');                                        $R92C7BD05EEE9798F658DB7A6771B074E->save();                                    SellerCommission::updateBalance($R95909C49377A2B4F24C79D29C629AF65,$R92C7BD05EEE9798F658DB7A6771B074E->id);              }          }      }                       public static function get_seller_commission_amount($R95909C49377A2B4F24C79D29C629AF65, $R9EAB500987B048B930229921452F6AA2, $RA2927833804D19DDBF8E91BED19ECB0A,$RDF830F9CB8C1732381AC17B92807939D=0)      {          if(!intval($R95909C49377A2B4F24C79D29C629AF65))return -1;      include_once(_PS_ROOT_DIR_  . "/modules/agilemultipleseller/agilemultipleseller.php");    require_once(dirname(__FILE__) .'/SellerCommission.php');    require_once(dirname(__FILE__) .'/BaseCommissionRate.php');    require_once(dirname(__FILE__) .'/RangeCommissionRate.php');    require_once(dirname(__FILE__) .'/CategoryCommissionRate.php');      if(Configuration::get('ASC_COMMISSION_MODE') == self::COMISSION_MODE_CATEGORY)    {     $R30573444EF866FA1971A41176B44EE37 = self::get_seller_categorycommission_from_cart($R95909C49377A2B4F24C79D29C629AF65);    }    else    {     $R6ECC060ABBBDE39E26308F0BD5065F2B = RangeCommissionRate::getRate((int)$R95909C49377A2B4F24C79D29C629AF65,$R9EAB500987B048B930229921452F6AA2,RangeCommissionRate::RATE_FOR_COMMISSION);            if( ($RDF830F9CB8C1732381AC17B92807939D == AgileMultipleSeller::ORDER_ORIGIN_EBAY AND intval(Configuration::get('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_EBAY)) ==1)      OR      ($RDF830F9CB8C1732381AC17B92807939D == AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP AND intval(Configuration::get('ASC_DEDUCTION_CHOICE_' . AgileMultipleSeller::ORDER_ORIGIN_PRESTASHOP)) ==1)     )       $R4BE09637F709519ED86C7D7C6E09156F =  RangeCommissionRate::getRate((int)$R95909C49377A2B4F24C79D29C629AF65,$R9EAB500987B048B930229921452F6AA2,RangeCommissionRate::RATE_FOR_DEDUCTION);            else      $R4BE09637F709519ED86C7D7C6E09156F = 0;          $R30573444EF866FA1971A41176B44EE37 = $R9EAB500987B048B930229921452F6AA2 * (1 - $R4BE09637F709519ED86C7D7C6E09156F * 0.01) * floatval($R6ECC060ABBBDE39E26308F0BD5065F2B) * 0.01;        }                    $RD10DD22F90C1536E6748FF3D8A937A4E = BaseCommissionRate::getBaseCommissionRate($R95909C49377A2B4F24C79D29C629AF65);                  $R2D406961C94DCD35D73719B5EEF83A16 = new Currency((int)Configuration::get('ASC_COMMISSION_CURRENCY'));          $R8A696D7C97F4F25163D14A38D5AB569D = new Currency($RA2927833804D19DDBF8E91BED19ECB0A);          $RD10DD22F90C1536E6748FF3D8A937A4E = $RD10DD22F90C1536E6748FF3D8A937A4E * $R8A696D7C97F4F25163D14A38D5AB569D->conversion_rate/$R2D406961C94DCD35D73719B5EEF83A16->conversion_rate;          $R034AE2AB94F99CC81B389A1822DA3353 = $RD10DD22F90C1536E6748FF3D8A937A4E + $R30573444EF866FA1971A41176B44EE37;          return $R034AE2AB94F99CC81B389A1822DA3353;      }      public static function get_seller_categorycommission_from_cart($R95909C49377A2B4F24C79D29C629AF65, $RF50CDD3F2AACFD3098534F1C052C25BE = 0)   {    if((int)$RF50CDD3F2AACFD3098534F1C052C25BE == 0)$RF50CDD3F2AACFD3098534F1C052C25BE = Context::getContext()->cart->id;     $RF9AA09C4492B9A9D072FC9F115B8C9AE = new Cart($RF50CDD3F2AACFD3098534F1C052C25BE);      $RD2E4221754276C36B2C961E8CF4CE0AC = (intval(Configuration::get('ASC_TAX_INCLUDE'))==1);      if(!Validate::isLoadedObject($RF9AA09C4492B9A9D072FC9F115B8C9AE))return 0;    $R08331032AF766761F73862782421264A = 0;    foreach ($RF9AA09C4492B9A9D072FC9F115B8C9AE->getProducts() AS $RF413F06AEBBCEF5E1C8B1019DEE6FE6B => $RB3F07F8C3658A835940E88288B58F707)    {     $R1B8AE585FCBE16464BB4673988D498E2 = intval(AgileSellerManager::getObjectOwnerID('product',$RB3F07F8C3658A835940E88288B58F707['id_product']));     if($R1B8AE585FCBE16464BB4673988D498E2 != $R95909C49377A2B4F24C79D29C629AF65)continue;     $R6ECC060ABBBDE39E26308F0BD5065F2B = CategoryCommissionRate::getCommissionRate($R95909C49377A2B4F24C79D29C629AF65, $RB3F07F8C3658A835940E88288B58F707['id_product']);     $R08331032AF766761F73862782421264A +=  ($RD2E4221754276C36B2C961E8CF4CE0AC ? $R05F1251C8874DB388DE19660A0B53B18 = $RB3F07F8C3658A835940E88288B58F707['total_wt'] :  $RB3F07F8C3658A835940E88288B58F707['total'])  * $R6ECC060ABBBDE39E26308F0BD5065F2B * 0.01;    }      return $R08331032AF766761F73862782421264A;       }                   public function getL($RF413F06AEBBCEF5E1C8B1019DEE6FE6B)   {    $RA43A52C3D1634FFA3BF745E85786DC5E = array(     'Commission' => $this->l('Commission'),     'Seller Sales' => $this->l('Seller Sales'),     'Seller' => $this->l('Seller'),     'Invalid paymeny key' => $this->l('Invalid paymeny key'),              'Invalid payment record type' => $this->l('Invalid payment record type'),              'Invalid payment return key' => $this->l('Invalid payment return key'),              'Invalid seller id' => $this->l('Invalid seller id'),     'mc_gross' => $this->l('Paypal key \'mc_gross\' not specified, can\'t control amount paid.'),     'payment_status' => $this->l('Paypal key \'payment_status\' not specified, can\'t control payment validity'),     'payment' => $this->l('Payment: '),     'custom' => $this->l('Paypal key \'custom\' not specified, can\'t rely to cart'),     'txn_id' => $this->l('Paypal key \'txn_id\' not specified, transaction unknown'),     'mc_currency' => $this->l('Paypal key \'mc_currency\' not specified, currency unknown'),     'cart' => $this->l('Cart not found'),     'order' => $this->l('Order has already been placed'),     'transaction' => $this->l('Paypal Transaction ID: '),     'verified' => $this->l('The PayPal transaction could not be VERIFIED.'),     'connect' => $this->l('Problem connecting to the PayPal server.'),     'nomethod' => $this->l('No communications transport available.'),     'socketmethod' => $this->l('Verification failure (using fsockopen). Returned: '),     'curlmethod' => $this->l('Verification failure (using cURL). Returned: '),     'curlmethodfailed' => $this->l('Connection using cURL failed'),     'Please wait, redirecting to Paypal... Thanks.' => $this->l('Please wait, redirecting to Paypal... Thanks.'),     'Sorry, we do not ship to your country.' => $this->l('Sorry, we do not ship to your country.'),     'Cancel' => $this->l('Cancel'),     'My cart' => $this->l('My cart'),     'Return to shop' => $this->l('Return to shop'),     'Currency Restriction: (Invalid currency restriction setting for this module)' => $this->l('Currency Restriction: (Invalid currency restriction setting for this module)'),     'Paypal error: (invalid or undefined business account email)' => $this->l('Paypal error: (invalid or undefined business account email)'),     'Recurring cycle error: (invalid or recurring cycle)' => $this->l('Recurring cycle error: (invalid or recurring cycle)'),     'Non interest txn_type: (None interest txn_type, ignored)' => $this->l('Non interest txn_type: (None interest txn_type, ignored)'),              'Error copying cart: (Error occured when copying cart for recurring payment)' => 'Error copying cart: (Error occured when copying cart for recurring payment)',     'Paypal error: (invalid address or customer)' => $this->l('Paypal error: (invalid address or customer)')       );    return $RA43A52C3D1634FFA3BF745E85786DC5E[$RF413F06AEBBCEF5E1C8B1019DEE6FE6B];   }         public function getSellerPaypalEmailAddress($R95909C49377A2B4F24C79D29C629AF65)      {    require_once(_PS_ROOT_DIR_ . "/modules/agilemultipleseller/AgileSellerPaymentInfo.php");    $R9064F5F2E50522D4A4419AF4D6D76216 = AgileSellerPaymentInfo::getForSellerByModuleName('agilepaypal', $R95909C49377A2B4F24C79D29C629AF65);    if(!Validate::isLoadedObject($R9064F5F2E50522D4A4419AF4D6D76216))$R9064F5F2E50522D4A4419AF4D6D76216 = AgileSellerPaymentInfo::getForSellerByModuleName('agilepaypalparallel', $R95909C49377A2B4F24C79D29C629AF65);    if(!Validate::isLoadedObject($R9064F5F2E50522D4A4419AF4D6D76216))$R9064F5F2E50522D4A4419AF4D6D76216 = AgileSellerPaymentInfo::getForSellerByModuleName('agilepaypaladaptive', $R95909C49377A2B4F24C79D29C629AF65);    if(!Validate::isLoadedObject($R9064F5F2E50522D4A4419AF4D6D76216))return '';    return $R9064F5F2E50522D4A4419AF4D6D76216->info1;      }         public function getPaypalUrl()   {           $R06EF4AC754BC78465B50D437B6E540BE = 'https://www.paypal.com/cgi-bin/webscr';           $R575FB563544B1414D5FE3126AC46F6CD = 'https://www.sandbox.paypal.com/cgi-bin/webscr';     return Configuration::get('ASC_PAYPAL_SANDBOX') ? $R575FB563544B1414D5FE3126AC46F6CD : $R06EF4AC754BC78465B50D437B6E540BE;   }         public static function get_paycommission_url($RC2D2567438B1F39DD71F78195B5F3DED)   {    if(version_compare(_PS_VERSION_, '1.5', '>='))     return Context::getContext()->link->getModuleLink('agilesellercommission', 'paycommission', $RC2D2567438B1F39DD71F78195B5F3DED, true);      $R6E4F14B335243BE656C65E3ED9E1B115 = Tools::getShopDomainSsl(true,true) . __PS_BASE_URI__ . "modules/agilesellercommission/paycommission.php?";    foreach($RC2D2567438B1F39DD71F78195B5F3DED as $RF413F06AEBBCEF5E1C8B1019DEE6FE6B => $R244F38266C59587D696AEC08A771B803)    {     $R6E4F14B335243BE656C65E3ED9E1B115 .= '&' . $RF413F06AEBBCEF5E1C8B1019DEE6FE6B . '=' . $R244F38266C59587D696AEC08A771B803;    }      return $R6E4F14B335243BE656C65E3ED9E1B115;   }      public function process_paycommission()   {    $RA97450E8677CC61180F8E1EE941A7E2A = intval(Tools::getValue('isfront',0));    $R4BACCAEF8C5D4479DE1CFCC8171D2B49 = Tools::getValue('retkey');    if($RA97450E8677CC61180F8E1EE941A7E2A ==0)    {     $R337B3B5835F4276FB155CDAFD62F22A7 = Tools::getShopDomainSsl(true,true) . __PS_BASE_URI__ .  Configuration::get('AGILE_MS_ADMIN_FOLDER_NAME') . "/index.php?controller=admincommissionbalances&token={$R4BACCAEF8C5D4479DE1CFCC8171D2B49}";    }    else    {     $R337B3B5835F4276FB155CDAFD62F22A7 = Context::getContext()->link->getModuleLink('agilemultipleseller', 'sellersummary', array(), true);    }        $this->context->smarty->assign(array(     'redirect_text' => $this->getL('Please wait, redirecting to Paypal... Thanks.'),     'cancel_text' => $this->getL('Cancel'),     'return_text' => $this->getL('Return to shop'),     'paypal_url' => $this->getPaypalUrl(),     'return_url' =>$R337B3B5835F4276FB155CDAFD62F22A7,     'address_override' => 0,     ));          $RBDF1E52780E67C6D25724A766C4FDB32 = intval(Tools::getValue('record_type'));    if($RBDF1E52780E67C6D25724A766C4FDB32 != SellerCommission::RECORD_TYPE_STORE_PAY_SELLER AND $RBDF1E52780E67C6D25724A766C4FDB32!= SellerCommission::RECORD_TYPE_SELLER_PAY_STORE)    {     return  $this->getL('Invalid payment record type');    }          $R95909C49377A2B4F24C79D29C629AF65 = intval(Tools::getValue('id_seller'));      $RCF34839F9B98B3757B4630C37A4E1D24 = new SellerInfo(SellerInfo::getIdBSellerId($R95909C49377A2B4F24C79D29C629AF65));    $REB44C9104964A8695E0EEEEDFA867D04 = new Employee($R95909C49377A2B4F24C79D29C629AF65);    if(!Validate::isLoadedObject($REB44C9104964A8695E0EEEEDFA867D04) OR $REB44C9104964A8695E0EEEEDFA867D04->id_profile != Configuration::get('AGILE_MS_PROFILE_ID'))    {     return $this->getL('Invalid seller id');    }      $paykey = Tools::encrypt($R95909C49377A2B4F24C79D29C629AF65);      if($paykey!=Tools::getValue('paykey'))    {     return $this->getL('Invalid paymeny key');    }      if($RA97450E8677CC61180F8E1EE941A7E2A==0 AND empty($R4BACCAEF8C5D4479DE1CFCC8171D2B49))    {     return $this->getL('Invalid payment return key');    }      $R58BD474D1FD829AA1306331DA2CAE4C7 = 0;    $R5C56A42C3A509ED8D4ED17B6BBD03121 = '';    $R901A6B96DBC8033F4D411C6E0FB53113 = NULL;    $R972A1D6D7FBAA83B27C6006E2C7CBC3F='';    $R385E260F6B3A22D493800D470BBEC7A1 = '';    if($RBDF1E52780E67C6D25724A766C4FDB32==SellerCommission::RECORD_TYPE_SELLER_PAY_STORE)    {     $R385E260F6B3A22D493800D470BBEC7A1 = $this->getL('Commission');     $R5C56A42C3A509ED8D4ED17B6BBD03121 = Configuration::get('ASC_PAYPAL_EMAIL');     $RD5D8F70E90FCD7F6429DEDAE71E78CE7 = new Country(intval(Configuration::get('PS_COUNTRY_DEFAULT')));       $R972A1D6D7FBAA83B27C6006E2C7CBC3F = Configuration::get('ASC_PAYPAL_HEADER');      $R8394FC9580ECD882A4E8C68B2AD6E0D1 = $this->getSellerPaypalEmailAddress($R95909C49377A2B4F24C79D29C629AF65);     $R5C8FCAAEACF68406A41FF36B3F8C5574  = $this->getL('Seller') . '-' . $R95909C49377A2B4F24C79D29C629AF65;    }    else if($RBDF1E52780E67C6D25724A766C4FDB32==SellerCommission::RECORD_TYPE_STORE_PAY_SELLER)    {     $R385E260F6B3A22D493800D470BBEC7A1 = $this->getL('Seller Sales');     $RD5D8F70E90FCD7F6429DEDAE71E78CE7 = new Country($RCF34839F9B98B3757B4630C37A4E1D24->id_country);     $R5C56A42C3A509ED8D4ED17B6BBD03121 = $this->getSellerPaypalEmailAddress($R95909C49377A2B4F24C79D29C629AF65);     $R8394FC9580ECD882A4E8C68B2AD6E0D1 = Configuration::get('ASC_PAYPAL_EMAIL');     $R5C8FCAAEACF68406A41FF36B3F8C5574  = Configuration::get('PS_SHOP_NAME');    }        if (empty($R5C56A42C3A509ED8D4ED17B6BBD03121) OR !Validate::isEmail($R5C56A42C3A509ED8D4ED17B6BBD03121))     return $this->getL('Paypal error: (invalid or undefined business account email)');          $currency = new Currency(Configuration::get('ASC_COMMISSION_CURRENCY'));        if (!Validate::isLoadedObject($currency))     return $this->getL('Currency Restriction: (Invalid currency restriction setting for this module)');        $RFF073106DF53C7C31BC2E1F5598ABC67 = Tools::getValue('amount_to_pay');      $this->context->smarty->assign(array(     'payment_name' => $R385E260F6B3A22D493800D470BBEC7A1,     'address' => $RCF34839F9B98B3757B4630C37A4E1D24,     'country' => $RD5D8F70E90FCD7F6429DEDAE71E78CE7,     'retkey' => $R4BACCAEF8C5D4479DE1CFCC8171D2B49,     'state' => $R901A6B96DBC8033F4D411C6E0FB53113,     'adminfolder' => Configuration::get('AGILE_MS_ADMIN_FOLDER_NAME'),     'payer_email' =>$R8394FC9580ECD882A4E8C68B2AD6E0D1,     'payer_id' =>$R5C8FCAAEACF68406A41FF36B3F8C5574,     'total' => $RFF073106DF53C7C31BC2E1F5598ABC67,     'business' => $R5C56A42C3A509ED8D4ED17B6BBD03121,     'currency' => $currency,     'id_seller' => intval($R95909C49377A2B4F24C79D29C629AF65),     'paypal_id' => intval($this->id),     'header' => $R972A1D6D7FBAA83B27C6006E2C7CBC3F,     'paykey' => $paykey,     'invoice' => $RBDF1E52780E67C6D25724A766C4FDB32,     'txnid' => date('YmdHis'),     'url' => Tools::getHttpHost(true, true).__PS_BASE_URI__    ));      return '';   }         private function prepareDefaultCommissionSetting()   {    include_once(_PS_ROOT_DIR_ . "/modules/agilesellercommission/BaseCommissionRate.php");    include_once(_PS_ROOT_DIR_ . "/modules/agilesellercommission/RangeCommissionRate.php");      $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT count(*) as cnt FROM ' . _DB_PREFIX_ . 'base_commission';    $RC8FD32E12E64A95B738412272EA38028 = (int)Db::getInstance()->getValue($R130D64A4AD653C91E0FD80DE8FEADC3A);    if($RC8FD32E12E64A95B738412272EA38028 <1)    {     $R3DDCCEC7F3A281AC93A7D551B5A8377B = new BaseCommissionRate();     $R3DDCCEC7F3A281AC93A7D551B5A8377B->id_seller = 0;     $R3DDCCEC7F3A281AC93A7D551B5A8377B->base_commission = 0;     $R3DDCCEC7F3A281AC93A7D551B5A8377B->save();    }        $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT count(*) as cnt FROM ' . _DB_PREFIX_ . 'commission_rate';    $RC8FD32E12E64A95B738412272EA38028 = (int)Db::getInstance()->getValue($R130D64A4AD653C91E0FD80DE8FEADC3A);    if($RC8FD32E12E64A95B738412272EA38028 <1)    {     $R2E07583F0303F73E8D8BB03840E1DCF7 = new RangeCommissionRate();     $R2E07583F0303F73E8D8BB03840E1DCF7->id_seller = 0;     $R2E07583F0303F73E8D8BB03840E1DCF7->from_amount = 0;     $R2E07583F0303F73E8D8BB03840E1DCF7->to_amount = 0;     $R2E07583F0303F73E8D8BB03840E1DCF7->commission = 10;     $R2E07583F0303F73E8D8BB03840E1DCF7->deduction_rate = 0;     $R2E07583F0303F73E8D8BB03840E1DCF7->save();    }   }         }  