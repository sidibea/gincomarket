<?php
///-build_id: 2017010213.5255
/// This source file is subject to the Software License Agreement that is bundled with this 
/// package in the file license.txt, or you can get it here
/// http://addons-modules.com/en/content/3-terms-and-conditions-of-use
///
/// @copyright  2009-2016 Addons-Modules.com
///  If you need open code to customize or merge code with othe modules, please contact us.
include_once(_PS_ROOT_DIR_.'/modules/agilesellercommission/BaseCommissionRate.php');
include_once(_PS_ROOT_DIR_.'/modules/agilesellercommission/agilesellercommission.php');

class AdminBaseCommissionRatesController extends ModuleAdminController
{    
	private static $id_commission_currency = 0;

	public function __construct()   {     $this->bootstrap = true;    $this->table = 'base_commission';     $this->className = 'BaseCommissionRate';     $this->lang = false;    self::$id_commission_currency = (int)Configuration::get('ASC_COMMISSION_CURRENCY');    $this->addRowAction('delete');    parent::__construct();      $this->actions = [];    if($this->is_seller)     $this->list_no_link = true;    else    {     $this->addRowAction('edit');   $this->addRowAction('delete');  }           $this->_join = '            LEFT JOIN `'._DB_PREFIX_.'sellerinfo` s ON (a.`id_seller`=s.`id_seller`)            LEFT JOIN `'._DB_PREFIX_.'sellerinfo_lang` sl ON (sl.`id_sellerinfo`=s.`id_sellerinfo` AND sl.id_lang=' . intval($this->context->language->id) . ')            ';        $this->_select = 'IF(a.`id_seller`=0,"' . $this->l('Default Transaction Fee'). '", sl.company) AS seller                       ,' . intval(Configuration::get('ASC_COMMISSION_CURRENCY')) . ' AS id_currency                       ';      $this->fields_list = array(     'id_base_commission' => array('title' => $this->l('ID'), 'align' => 'center', 'width' => 100),     'id_seller' => array('title' => $this->l('Seller ID'), 'align' => 'center', 'width' => 100, 'filter_key'=> 'a!id_seller'),     'seller' => array('title' => $this->l('Seller Name'), 'align' => 'left', 'width' => 150, 'tmpTableFilter' => true),     'base_commission' => array('title' => $this->l('Transaction Fee'), 'width' => 150,'align' => 'right', 'type' => 'price', 'currency' => true, 'callback' => 'setCommissionCurrency' )    );        if($this->is_seller)    {     $this->_where = $this->_where . ' AND a.id_seller = ' . intval($this->context->cookie->id_employee);    }       }      public function initToolbar()   {    parent::initToolbar();    if($this->is_seller)unset($this->toolbar_btn['new']);   }      public function renderList()   {    if($this->is_seller)     return $this->displaySellerTransactionFee();    else     return parent::renderList();   }         public function displaySellerTransactionFee()      {    $R17AC9BFA1ABB066C772CEAE0B3CD86E9 = new Employee($this->context->cookie->id_employee);          $currency = new Currency(intval(Configuration::get('ASC_COMMISSION_CURRENCY')));    return 'Seller Name: ' . $R17AC9BFA1ABB066C772CEAE0B3CD86E9->firstname . ' ' . $R17AC9BFA1ABB066C772CEAE0B3CD86E9->lastname .'<br />'  .$this->l('Your transaction fee is') . ':<span style="font-size:x-large">' . Tools::displayPrice(BaseCommissionrate::getBaseCommissionRate($this->context->cookie->id_employee),$currency).'</span>' . $this->l(' per order ');         }       public function renderForm()   {    if (!($R602BAA072843820A45861C75C510C77E = $this->loadObject(true)))     return;      $R28CB95CC5EDD83F8B305E4CDEE816851 = new Currency(self::$id_commission_currency);      $this->fields_form = array(     'legend' => array(       'title' => $this->l('Transaction Fee')       ),      'input' => array(       array(        'type' => 'select',        'label' => $this->l('Seller:'),        'name' => 'id_seller',        'required' => false,        'default_value' => 0,        'options' => array(         'query' => AgileSellerManager::getSellersNV(true,$this->l('Store Default')),         'id' => 'id_seller',         'name' => 'name',         ),        'desc'=>$this->l('Choose a seller to who the transaction fee will apply. Choose Store Defualt if it will apply to all sellers.')       ),              array(        'type' => 'text',        'label' => $this->l('Transaction Fee:') . '(' . $R28CB95CC5EDD83F8B305E4CDEE816851->sign . ')',        'name' => 'base_commission',        'size' => 33,        'required' => false        ),       )      );            $this->fields_form['submit'] = array(     'title' => $this->l('Save'),     'class' => 'agile-btn agile-btn-default pull-right'    );        return parent::renderForm();   }      public static function setCommissionCurrency($R7EEF19FC5649E7794F922BF96203A43C, $R08A3F2CD13353414E9C62A1132D2FB78)   {    return Tools::displayPrice($R7EEF19FC5649E7794F922BF96203A43C, self::$id_commission_currency);   }  }      