<?php
///-build_id: 2017010213.5255
/// This source file is subject to the Software License Agreement that is bundled with this 
/// package in the file license.txt, or you can get it here
/// http://addons-modules.com/en/content/3-terms-and-conditions-of-use
///
/// @copyright  2009-2016 Addons-Modules.com
///  If you need open code to customize or merge code with othe modules, please contact us.
include_once(_PS_ROOT_DIR_.'/modules/agilesellercommission/RangeCommissionRate.php');
include_once(_PS_ROOT_DIR_.'/modules/agilesellercommission/agilesellercommission.php');

class AdminRangeCommissionRatesController extends ModuleAdminController
{
	protected $_list_error;
	private static $id_commission_currency = 0;
	
	public function __construct()   {    self::$id_commission_currency = (int)Configuration::get('ASC_COMMISSION_CURRENCY');    $this->bootstrap = true;    $this->table = 'commission_rate';     $this->className = 'RangeCommissionRate';        parent::__construct();       $this->lang = false;    $this->actions = [];    if($this->is_seller)     $this->list_no_link = true;    else    {     $this->addRowAction('edit');   $this->addRowAction('delete');  }           $this->_join = '            LEFT JOIN `'._DB_PREFIX_.'sellerinfo` s ON (a.`id_seller`=s.`id_seller`)            LEFT JOIN `'._DB_PREFIX_.'sellerinfo_lang` sl ON (sl.`id_sellerinfo`=s.`id_sellerinfo` AND sl.id_lang=' . intval($this->context->language->id) . ')            ';        $this->_select = 'IF(a.`id_seller`=0,"' . $this->l('Default Commission Fee'). '", sl.company) AS seller                    ,' . intval(Configuration::get('PS_CURRENCY_DEFAULT')) . ' AS id_currency               ';                     $this->fields_list = array(     'id_commission_rate' => array('title' => $this->l('ID'), 'align' => 'center', 'width' => 25),     'id_seller' => array('title' => $this->l('Seller ID'), 'align' => 'center', 'width' => 25, 'filter_key' => 'a!id_seller'),     'seller' => array('title' => $this->l('Seller Name'), 'align' => 'right', 'width' => 50, 'tmpTableFilter' => true),     'from_amount' => array('title' => $this->l('From Amount'), 'align' => 'right', 'width' => 50, 'type' => 'price', 'currency'=>true, 'callback' => 'setCommissionCurrency'),     'to_amount' => array('title' => $this->l('To Amount'), 'align' => 'right', 'width' => 50, 'type' => 'price', 'currency'=>true, 'callback' => 'setCommissionCurrency'),     'commission' => array('title' => $this->l('Commission Fee(%)'), 'width' => 150),     'deduction_rate' => array('title' => $this->l('Deduction Rate(%)'), 'width' => 150)    );     }      public function initToolbar()   {    parent::initToolbar();    if($this->is_seller)unset($this->toolbar_btn['new']);   }      public function postProcess()   {    if (isset($_POST['submitAdd'.$this->table]))    {        $this->validateRules();     if (sizeof($this->errors))     {         $this->errors = array_unique($this->errors);         return;     }     $R08331032AF766761F73862782421264A = floatval(Tools::getValue('commission'));     if ($R08331032AF766761F73862782421264A < 0 || $R08331032AF766761F73862782421264A > 100 )     {      $this->errors[] = Tools::displayError('The commission rate must be between 1 and 100.');     }     }    if (!sizeof($this->errors))        parent::postProcess();             }     public function getList($R843772E13ECF32C5CEEF23010FB27FBA, $R66FCA7DF8ACD3193B06AA41AF17FF2D2 = null, $R5F910067EBB465A4DF2C21BDFF43F038 = null, $RBE4C4D037E939226F65812885A53DAD9 = 0, $RFED47D15719EF82BD3F83B580230DA5B = null, $R42FFD007CC602DEAAAD396DF386AF38D = false)   {    if($this->is_seller)     $this->_where = $this->_where . ' AND (IFNULL(a.id_seller,0) = 0 OR a.id_seller = ' . intval($this->context->cookie->id_employee) . ')';      parent::getList($R843772E13ECF32C5CEEF23010FB27FBA, $R66FCA7DF8ACD3193B06AA41AF17FF2D2, $R5F910067EBB465A4DF2C21BDFF43F038, $RBE4C4D037E939226F65812885A53DAD9, $RFED47D15719EF82BD3F83B580230DA5B, $R42FFD007CC602DEAAAD396DF386AF38D);        if($this->is_seller)    {        $R236B9B603EE3ACEE3B4073119303F7EC = array();     $R7E0C898C1444874FB7933A01AC35B75D = array();     foreach($this->_list as $R4EEB713E57BBAAF1217CF39632604473)     {      if((int)$R4EEB713E57BBAAF1217CF39632604473['id_seller'] == 0)$R236B9B603EE3ACEE3B4073119303F7EC[]  = $R4EEB713E57BBAAF1217CF39632604473;      else $R7E0C898C1444874FB7933A01AC35B75D[] = $R4EEB713E57BBAAF1217CF39632604473;     }         $this->_list = (count($R7E0C898C1444874FB7933A01AC35B75D) > 0 ? $R7E0C898C1444874FB7933A01AC35B75D : $R236B9B603EE3ACEE3B4073119303F7EC);       $this->_listTotal = count($this->_list);    }   }        public function renderForm()   {    if (!($R602BAA072843820A45861C75C510C77E = $this->loadObject(true)))     return;      $R28CB95CC5EDD83F8B305E4CDEE816851 = new Currency(self::$id_commission_currency);        $this->fields_form = array(     'legend' => array(       'title' => $this->l('Transaction Fee')       ),      'input' => array(       array(        'type' => 'select',        'label' => $this->l('Seller:'),        'name' => 'id_seller',        'required' => false,        'default_value' => 0,        'options' => array(         'query' => AgileSellerManager::getSellersNV(true,$this->l('Store Default')),         'id' => 'id_seller',         'name' => 'name',         ),        'desc'=>$this->l('Choose a seller to who the transaction fee will apply. Choose Store Defualt if it will apply to all sellers.')       ),              array(        'type' => 'text',        'label' => $this->l('From Amount') . '(' . $R28CB95CC5EDD83F8B305E4CDEE816851->sign . ')',        'name' => 'from_amount',        'size' => 33,        'required' => false        ),         array(        'type' => 'text',        'label' => $this->l('To Amount') . '(' . $R28CB95CC5EDD83F8B305E4CDEE816851->sign . ')',        'name' => 'to_amount',        'size' => 33,        'required' => false        ),         array(        'type' => 'text',        'label' => $this->l('Commission Rate(%)'),        'name' => 'commission',        'size' => 33,        'required' => false,        'desc'=>$this->l('This value should be from 0 to 100')        ),         array(        'type' => 'text',        'label' => $this->l('Deduction Rate(%)'),        'name' => 'deduction_rate',        'size' => 33,        'required' => false,        'desc'=>$this->l('Please input 0-100 for the percentage amount to deduct from the total amount before it is used for commission calculations.')        ),       )      );          $this->fields_form['submit'] = array(     'title' => $this->l('Save'),     'class' => 'agile-btn agile-btn-default pull-right'    );        return parent::renderForm();   }         public static function setCommissionCurrency($R7EEF19FC5649E7794F922BF96203A43C, $R08A3F2CD13353414E9C62A1132D2FB78)   {    return Tools::displayPrice($R7EEF19FC5649E7794F922BF96203A43C, self::$id_commission_currency);   }  }      