<?php
///-build_id: 2016071823.0745
/// This source file is subject to the Software License Agreement that is bundled with this 
/// package in the file license.txt, or you can get it here
/// http://addons-modules.com/en/content/3-terms-and-conditions-of-use
///
/// @copyright  2009-2012 Addons-Modules.com
///  If you need open code to customize or merge code with othe modules, please contact us.

class	SellerShipping extends ObjectModel
{
	public		$id_sellershipping;
	public      $id_sellerinfo;
	public      $shipping_method;
	public      $shipping_free_price;
	public      $shipping_free_weight;
	public      $status;
	public      $date_add;

	
	private static $_idZones = array();
	private static $_idCountries = array();

	protected	$fieldsRequired = array('id_sellerinfo');
	protected	$fieldsSize = array();
	protected	$fieldsValidate = array('id_sellerinfo' => 'isUnsignedId');

	protected 	$table = 'sellershipping';
	protected 	$identifier = 'id_sellershipping';
	protected	$_includeContainer = false;

	public function delete()  {   return parent::delete();  }   public function getFields()  {   parent::validateFields();   if (isset($this->id))    $RB0D5D47F3D2E32A124C14253ABA3976A['id_sellershipping'] = intval($this->id);   $RB0D5D47F3D2E32A124C14253ABA3976A['id_sellerinfo'] = intval($this->id_sellerinfo);   $RB0D5D47F3D2E32A124C14253ABA3976A['shipping_method'] = intval($this->shipping_method);   $RB0D5D47F3D2E32A124C14253ABA3976A['shipping_free_price'] = intval($this->shipping_free_price);   $RB0D5D47F3D2E32A124C14253ABA3976A['shipping_free_weight'] = intval($this->shipping_free_weight);   $RB0D5D47F3D2E32A124C14253ABA3976A['status'] = intval($this->status);   $RB0D5D47F3D2E32A124C14253ABA3976A['date_add'] = pSQL($this->date_add);      return $RB0D5D47F3D2E32A124C14253ABA3976A;  }    public static function getCarrierIDbyProductID($RF50CDD3F2AACFD3098534F1C052C25BE,$R40095968F29813E02A981F327827F17B,$REDFEC30A90E80DFAD993E56F628914D4)  {         $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT id_carrier FROM ' . _DB_PREFIX_ . 'agile_cartcarrier WHERE id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE . ' AND id_product=' . $R40095968F29813E02A981F327827F17B . ' AND id_product_attribute=' . $REDFEC30A90E80DFAD993E56F628914D4;         $R0ACBF3334E5196BD6BFD3ADC13786C4C = Db::getInstance()->getValue($R130D64A4AD653C91E0FD80DE8FEADC3A);         return $R0ACBF3334E5196BD6BFD3ADC13786C4C;   }    public static function cleanCartCarrier($RF50CDD3F2AACFD3098534F1C052C25BE)  {         if(intval($RF50CDD3F2AACFD3098534F1C052C25BE)<=0)return;                 $R130D64A4AD653C91E0FD80DE8FEADC3A = '                 SELECT cc.id_cart,cc.id_product,cc.id_product_attribute                  FROM ' . _DB_PREFIX_ . 'agile_cartcarrier cc                     LEFT JOIN ' . _DB_PREFIX_ . 'cart_product cp ON (cc.id_cart=cp.id_cart AND cc.id_product=cp.id_product AND cc.id_product_attribute=cp.id_product_attribute)                 WHERE cc.id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE . ' AND cp.id_cart IS  NULL         ';         $RF2E7515B502FFA8B26442E464A4D5A1A = Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);         if(isset($RF2E7515B502FFA8B26442E464A4D5A1A) AND !empty($RF2E7515B502FFA8B26442E464A4D5A1A))         {             foreach($RF2E7515B502FFA8B26442E464A4D5A1A AS $RE871B8847840FE1778C08FEDF70104A6)             {                 $R130D64A4AD653C91E0FD80DE8FEADC3A = 'DELETE FROM ' . _DB_PREFIX_ . 'agile_cartcarrier WHERE id_cart=' . $RE871B8847840FE1778C08FEDF70104A6['id_cart'] . ' AND id_product=' . $RE871B8847840FE1778C08FEDF70104A6['id_product'] . ' AND id_product_attribute=' . $RE871B8847840FE1778C08FEDF70104A6['id_product_attribute'];                 Db::getInstance()->Execute($R130D64A4AD653C91E0FD80DE8FEADC3A);             }         }                    $R130D64A4AD653C91E0FD80DE8FEADC3A = '                 SELECT cp.id_cart,cp.id_product,cp.id_product_attribute                  FROM ' . _DB_PREFIX_ . 'cart_product cp                     LEFT JOIN ' . _DB_PREFIX_ . 'agile_cartcarrier cc ON (cp.id_cart=cc.id_cart AND cp.id_product=cc.id_product AND cp.id_product_attribute=cc.id_product_attribute)                 WHERE cp.id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE . ' AND cc.id_cart IS  NULL         ';         $RE484ED591E12CF9125AE1D47AE08748B = Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);         if(isset($RE484ED591E12CF9125AE1D47AE08748B) AND !empty($RE484ED591E12CF9125AE1D47AE08748B))         {                      $RF9AA09C4492B9A9D072FC9F115B8C9AE = new Cart($RF50CDD3F2AACFD3098534F1C052C25BE);             $R3CA092FF89E1C9FFB12399030355F8FC = self::getZoneID($RF9AA09C4492B9A9D072FC9F115B8C9AE->id_address_delivery, $RF9AA09C4492B9A9D072FC9F115B8C9AE->id_customer);               foreach($RE484ED591E12CF9125AE1D47AE08748B AS $R4EEB713E57BBAAF1217CF39632604473)          {              $R40095968F29813E02A981F327827F17B = intval($R4EEB713E57BBAAF1217CF39632604473['id_product']);              $R05EFE94FD9ED2FF7F4374835F3790260 = self::getDefaultCarrier($R3CA092FF89E1C9FFB12399030355F8FC, $R40095968F29813E02A981F327827F17B);     $R130D64A4AD653C91E0FD80DE8FEADC3A = 'REPLACE INTO ' . _DB_PREFIX_ . 'agile_cartcarrier (id_cart,id_product,id_product_attribute,id_carrier,date_add) VALUES(' . $RF50CDD3F2AACFD3098534F1C052C25BE. ','. intval($R4EEB713E57BBAAF1217CF39632604473['id_product']) . ','. intval($R4EEB713E57BBAAF1217CF39632604473['id_product_attribute']) . ',' . $R05EFE94FD9ED2FF7F4374835F3790260. ',\''. date('Y-m-d H:i:s') . '\')';              Db::getInstance()->Execute($R130D64A4AD653C91E0FD80DE8FEADC3A);               }      }      self::updateCartCarrier($RF50CDD3F2AACFD3098534F1C052C25BE);  }      public static function updateCartCarrier($RF50CDD3F2AACFD3098534F1C052C25BE)  {      $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT COUNT(*) FROM ' . _DB_PREFIX_  .'agile_cartcarrier WHERE id_carrier<=0 AND id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE;      $RDDA0718F3749E961E79C22CB935FE0DE = intval(Db::getInstance()->getValue($R130D64A4AD653C91E0FD80DE8FEADC3A));              $R0ACBF3334E5196BD6BFD3ADC13786C4C = intval(Configuration::get('AGILE_SS_CARRIER_ID'));      if($RDDA0718F3749E961E79C22CB935FE0DE>0)$R0ACBF3334E5196BD6BFD3ADC13786C4C = 0;         $R130D64A4AD653C91E0FD80DE8FEADC3A = 'UPDATE ' . _DB_PREFIX_ . 'cart SET id_carrier=' . $R0ACBF3334E5196BD6BFD3ADC13786C4C . ' WHERE id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE;         Db::getInstance()->Execute($R130D64A4AD653C91E0FD80DE8FEADC3A);  }         public static function updateCartCarrierForProduct($RF50CDD3F2AACFD3098534F1C052C25BE,$R40095968F29813E02A981F327827F17B,$REDFEC30A90E80DFAD993E56F628914D4,$R0ACBF3334E5196BD6BFD3ADC13786C4C,$RB4C21F041201E5B437AE2F7A0141A18A)  {         if(intval($RF50CDD3F2AACFD3098534F1C052C25BE)<=0 OR intval($R40095968F29813E02A981F327827F17B)<=0 OR intval($R0ACBF3334E5196BD6BFD3ADC13786C4C)<=0)return;      $R130D64A4AD653C91E0FD80DE8FEADC3A = 'UPDATE ' . _DB_PREFIX_ . 'agile_cartcarrier SET id_carrier=' . $R0ACBF3334E5196BD6BFD3ADC13786C4C;      if(Module::isInstalled('agilepickupcenter')) {       $R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A . ',id_location=' . $RB4C21F041201E5B437AE2F7A0141A18A ;      }      $R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A . ' WHERE id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE . ' AND id_product=' . $R40095968F29813E02A981F327827F17B . ' AND id_product_attribute=' . $REDFEC30A90E80DFAD993E56F628914D4;      Db::getInstance()->Execute($R130D64A4AD653C91E0FD80DE8FEADC3A);            if(Module::isInstalled('agilepickupcenter')) {    if($R0ACBF3334E5196BD6BFD3ADC13786C4C == intval(Configuration::getGlobalValue('AGILE_PICKUPCENTER_CARRIER_ID')) AND intval($RB4C21F041201E5B437AE2F7A0141A18A)==0) {    $RB4C21F041201E5B437AE2F7A0141A18A = SellerShipping::first_or_default_location(SellerShipping::get_carrier_product_locations($RF50CDD3F2AACFD3098534F1C052C25BE,$R40095968F29813E02A981F327827F17B,$R0ACBF3334E5196BD6BFD3ADC13786C4C));   }   $R130D64A4AD653C91E0FD80DE8FEADC3A = 'UPDATE ' . _DB_PREFIX_ . 'agile_cartcarrier SET id_location=' . $RB4C21F041201E5B437AE2F7A0141A18A;   $R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A . ' WHERE id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE . ' AND id_product=' . $R40095968F29813E02A981F327827F17B . ' AND id_product_attribute=' . $REDFEC30A90E80DFAD993E56F628914D4;   Db::getInstance()->Execute($R130D64A4AD653C91E0FD80DE8FEADC3A);      }       self::updateCartCarrier($RF50CDD3F2AACFD3098534F1C052C25BE);  }    public static function getDefaultCarrier($R3CA092FF89E1C9FFB12399030355F8FC, $R40095968F29813E02A981F327827F17B)  {         if(intval($R3CA092FF89E1C9FFB12399030355F8FC)<=0 OR intval($R40095968F29813E02A981F327827F17B)<=0)return 0;          $RE1B2B3167E624F30E44FB480AE7FA500 = self::getAvailableCarriers($R3CA092FF89E1C9FFB12399030355F8FC, $R40095968F29813E02A981F327827F17B);         if(!isset($RE1B2B3167E624F30E44FB480AE7FA500) OR empty($RE1B2B3167E624F30E44FB480AE7FA500))return 0;                          $R0ACBF3334E5196BD6BFD3ADC13786C4C = intval($RE1B2B3167E624F30E44FB480AE7FA500[0]['id_carrier']);          return $R0ACBF3334E5196BD6BFD3ADC13786C4C;  }      private static function get_specific_carriers($R40095968F29813E02A981F327827F17B)  {   if(intval($R40095968F29813E02A981F327827F17B)<=0)return '';          require_once(_PS_ROOT_DIR_  . "/modules/agilemultipleseller/SellerInfo.php");   if(Module::isInstalled('agilepickupcenter')     && Configuration::get('AGILE_MEDICAL_PRODUCT_CID')    && Configuration::getGlobalValue('AGILE_PICKUPCENTER_CARRIER_ID')    && AgileMultipleSeller::IsProductInMedicalCategory($R40095968F29813E02A981F327827F17B)   )    {    return Configuration::getGlobalValue('AGILE_PICKUPCENTER_CARRIER_ID');   }   else   {    $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT id_carrier_reference FROM ' . _DB_PREFIX_ . 'product_carrier WHERE id_product=' . intval($R40095968F29813E02A981F327827F17B);    $RE484ED591E12CF9125AE1D47AE08748B = Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);     if(empty($RE484ED591E12CF9125AE1D47AE08748B))return '';    return implode(",", AgileHelper::retrieve_column_values($RE484ED591E12CF9125AE1D47AE08748B, "id_carrier_reference", false));   }  }    public static function getAvailableCarriers($R3CA092FF89E1C9FFB12399030355F8FC, $R40095968F29813E02A981F327827F17B, $R22AC9E3C2EE714BEF680E5CB5C8B74C1 = 1, $REDFEC30A90E80DFAD993E56F628914D4=0)  {   $RB10E8575D7A5B4C417D9DCF8D6BC17BE = Context::getContext();         if(!$R40095968F29813E02A981F327827F17B)return;   $R91CACE256C6C839A6B447F6BAE86D72A = Context::getContext()->customer->id;   $RB67F4F4FC0A88900A925BA14A75BBE2B = Customer::getGroupsStatic($R91CACE256C6C839A6B447F6BAE86D72A);         require_once(_PS_ROOT_DIR_  . "/modules/agilemultipleseller/SellerInfo.php");   require_once(_PS_ROOT_DIR_  . "/modules/agilesellershipping/agilesellershipping.php");      $REED9DDFC72D7A32A8013BE5CA230F17F = 0;   $R33AB389C5DC324845A24E83F5A32740D = '';   $RAA6BA4E59373BB6CCC0A3EC68AB29A8A = self::get_specific_carriers($R40095968F29813E02A981F327827F17B);   $R33AB389C5DC324845A24E83F5A32740D .=  (empty($RAA6BA4E59373BB6CCC0A3EC68AB29A8A) ? '' : (' AND c.id_reference in (' . $RAA6BA4E59373BB6CCC0A3EC68AB29A8A . ') '));   $R33AB389C5DC324845A24E83F5A32740D .=  ' AND c.id_carrier IN (SELECT distinct `id_carrier` FROM `' . _DB_PREFIX_ . 'carrier_group` WHERE id_group in (' . implode($RB67F4F4FC0A88900A925BA14A75BBE2B,",") . '))';    $R9C564F169D41B99A49F79DF45C0F520E =  intval(Configuration::getGlobalValue('AGILE_PICKUPCENTER_CARRIER_ID'));   if(Module::isInstalled('agilepickupcenter')     && Configuration::get('AGILE_MEDICAL_PRODUCT_CID')    && $R9C564F169D41B99A49F79DF45C0F520E    && AgileMultipleSeller::IsProductInMedicalCategory($R40095968F29813E02A981F327827F17B)   )    {       $REED9DDFC72D7A32A8013BE5CA230F17F = 1;    $R33AB389C5DC324845A24E83F5A32740D .= ' AND c.id_carrier = ' . $R9C564F169D41B99A49F79DF45C0F520E;   }   else {    if($R9C564F169D41B99A49F79DF45C0F520E)     {      $R33AB389C5DC324845A24E83F5A32740D .= ' AND c.id_carrier <> ' . $R9C564F169D41B99A49F79DF45C0F520E;    }   }    $R7E308D3DB7C4A1D469407B8146D91500 =  (int)Configuration::get('AGILE_SS_CARRIER_ID');          $R1B8AE585FCBE16464BB4673988D498E2 = AgileSellerManager::getObjectOwnerID('product',$R40095968F29813E02A981F327827F17B);         $R130D64A4AD653C91E0FD80DE8FEADC3A = '             SELECT c.id_carrier, c.name              FROM ' . _DB_PREFIX_ . 'carrier_zone cz                  LEFT JOIN ' . _DB_PREFIX_ . 'carrier_owner co ON cz.id_carrier=co.id_carrier                 LEFT JOIN ' . _DB_PREFIX_ . 'carrier c ON cz.id_carrier=c.id_carrier             WHERE c.active=1 AND c.deleted=0                 AND IFNULL(co.id_owner,0) IN (0, ' . $R1B8AE585FCBE16464BB4673988D498E2 . ')                 AND cz.id_zone = ' . (int)$R3CA092FF89E1C9FFB12399030355F8FC . '     AND c.id_carrier != ' . $R7E308D3DB7C4A1D469407B8146D91500 . '     ' . $R33AB389C5DC324845A24E83F5A32740D . '             ORDER BY IFNULL(co.is_default,0) DESC             ';          $RE484ED591E12CF9125AE1D47AE08748B = Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);           $RBFCF3A7208040A0DC9A20D4E430A732B = (int)intval(Configuration::get('AGILE_SS_AS_DEFAULT_CARRIER'));     if($RBFCF3A7208040A0DC9A20D4E430A732B == AgileSellerShipping::USE_DEFAULT_CARRIER_ALWAYS || (empty($RE484ED591E12CF9125AE1D47AE08748B)))    {              $R130D64A4AD653C91E0FD80DE8FEADC3A = '                  SELECT c.id_carrier, c.name                   FROM ' . _DB_PREFIX_ . 'carrier_zone cz                       LEFT JOIN ' . _DB_PREFIX_ . 'carrier c ON cz.id_carrier=c.id_carrier                  WHERE c.active=1 AND c.deleted=0                      AND cz.id_zone = ' . (int)$R3CA092FF89E1C9FFB12399030355F8FC . '                      AND c.id_carrier=' . (int)Configuration::get('AGILE_SS_CARRIER_ID'). '                  ';    $R29F66D67F44907CCAF8179E2C4A449F4 = Db::getInstance()->getRow($R130D64A4AD653C91E0FD80DE8FEADC3A);    if(!empty($R29F66D67F44907CCAF8179E2C4A449F4)) $RE484ED591E12CF9125AE1D47AE08748B[] = $R29F66D67F44907CCAF8179E2C4A449F4;         }      $RB3F07F8C3658A835940E88288B58F707 = new Product($R40095968F29813E02A981F327827F17B);   $R641B40019EF8793BDF52E372E8120CFD = Product::getPriceStatic($R40095968F29813E02A981F327827F17B, false, $REDFEC30A90E80DFAD993E56F628914D4, 6) * $R22AC9E3C2EE714BEF680E5CB5C8B74C1;   $R679EE2B84BC6290C0A6E686A72727E32 = $RB3F07F8C3658A835940E88288B58F707->weight * $R22AC9E3C2EE714BEF680E5CB5C8B74C1;   $R45F20A48822D335974DD5F0116D6A7CC = array();   foreach($RE484ED591E12CF9125AE1D47AE08748B as $R4EEB713E57BBAAF1217CF39632604473)   {    $R53CED8F460F10F938CCEC04FE634E4D3 = new Carrier($R4EEB713E57BBAAF1217CF39632604473['id_carrier']);       if ($RB3F07F8C3658A835940E88288B58F707->width > 0 || $RB3F07F8C3658A835940E88288B58F707->height > 0 || $RB3F07F8C3658A835940E88288B58F707->depth > 0 || $RB3F07F8C3658A835940E88288B58F707->weight > 0)    {     if (($R53CED8F460F10F938CCEC04FE634E4D3->max_width > 0 && $R53CED8F460F10F938CCEC04FE634E4D3->max_width < $RB3F07F8C3658A835940E88288B58F707->width)      || ($R53CED8F460F10F938CCEC04FE634E4D3->max_height > 0 && $R53CED8F460F10F938CCEC04FE634E4D3->max_height < $RB3F07F8C3658A835940E88288B58F707->height)      || ($R53CED8F460F10F938CCEC04FE634E4D3->max_depth > 0 && $R53CED8F460F10F938CCEC04FE634E4D3->max_depth < $RB3F07F8C3658A835940E88288B58F707->depth)      || ($R53CED8F460F10F938CCEC04FE634E4D3->max_weight > 0 && $R53CED8F460F10F938CCEC04FE634E4D3->max_weight < $RB3F07F8C3658A835940E88288B58F707->weight))continue;    }    if($R53CED8F460F10F938CCEC04FE634E4D3->range_behavior == 1)    {     $RAA1B8056C6B230EA06B16C09326D3B84 = $R53CED8F460F10F938CCEC04FE634E4D3->getShippingMethod();         if ($RAA1B8056C6B230EA06B16C09326D3B84 == Carrier::SHIPPING_METHOD_WEIGHT AND !Carrier::checkDeliveryPriceByWeight($R4EEB713E57BBAAF1217CF39632604473['id_carrier'], $R679EE2B84BC6290C0A6E686A72727E32, $R3CA092FF89E1C9FFB12399030355F8FC))     {      continue;     }     if ($RAA1B8056C6B230EA06B16C09326D3B84 == Carrier::SHIPPING_METHOD_PRICE AND !Carrier::checkDeliveryPriceByPrice($R4EEB713E57BBAAF1217CF39632604473['id_carrier'], $R641B40019EF8793BDF52E372E8120CFD, $R3CA092FF89E1C9FFB12399030355F8FC, $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->id_currency))     {      continue;     }    }        $R45F20A48822D335974DD5F0116D6A7CC[] = $R4EEB713E57BBAAF1217CF39632604473;    }      $RE48EAE0EF9C83D75245F7030D0DDAEA9 = self::assignCarrierPrices($R45F20A48822D335974DD5F0116D6A7CC, $R3CA092FF89E1C9FFB12399030355F8FC, $R40095968F29813E02A981F327827F17B, $R22AC9E3C2EE714BEF680E5CB5C8B74C1, $REDFEC30A90E80DFAD993E56F628914D4);   $RD651EBA3C4DD36D1A27763B3177F700A = array();   $RF4CB4206AA1D041CED8625B7F1C5623C = array();   foreach($RE48EAE0EF9C83D75245F7030D0DDAEA9 as $R53CED8F460F10F938CCEC04FE634E4D3)   {    if(($REED9DDFC72D7A32A8013BE5CA230F17F==1 && $R53CED8F460F10F938CCEC04FE634E4D3['id_carrier'] <> $R9C564F169D41B99A49F79DF45C0F520E)    || ($REED9DDFC72D7A32A8013BE5CA230F17F==0 && $R53CED8F460F10F938CCEC04FE634E4D3['id_carrier'] == $R9C564F169D41B99A49F79DF45C0F520E)) continue;    $RD651EBA3C4DD36D1A27763B3177F700A[$R53CED8F460F10F938CCEC04FE634E4D3['id_carrier']] = $R53CED8F460F10F938CCEC04FE634E4D3;    $RF4CB4206AA1D041CED8625B7F1C5623C[$R53CED8F460F10F938CCEC04FE634E4D3['id_carrier']] = $R53CED8F460F10F938CCEC04FE634E4D3['price'];   }   asort($RF4CB4206AA1D041CED8625B7F1C5623C);      $RB66FB03922CB483D24B046CB3B0CF512 = array();   foreach($RF4CB4206AA1D041CED8625B7F1C5623C as $R3584859062EA9ECFB39B93BFCEF8E869 => $R63D0786ECC7B962F8285396746DC2145)   {    $RB66FB03922CB483D24B046CB3B0CF512[] = $RD651EBA3C4DD36D1A27763B3177F700A[$R3584859062EA9ECFB39B93BFCEF8E869];   }     return $RB66FB03922CB483D24B046CB3B0CF512;  }       public static function getZoneID($R193B4BBC3D3E68B0E0C8876203C634B6, $R91CACE256C6C839A6B447F6BAE86D72A)     {     if(isset($R193B4BBC3D3E68B0E0C8876203C634B6) AND $R193B4BBC3D3E68B0E0C8876203C634B6 AND Customer::customerHasAddress($R91CACE256C6C839A6B447F6BAE86D72A, $R193B4BBC3D3E68B0E0C8876203C634B6))    $R3CA092FF89E1C9FFB12399030355F8FC = Address::getZoneById((int)($R193B4BBC3D3E68B0E0C8876203C634B6));   else   {    $defaultCountry = new Country(Configuration::get('PS_COUNTRY_DEFAULT'), Configuration::get('PS_LANG_DEFAULT'));    $R3CA092FF89E1C9FFB12399030355F8FC = (int)$defaultCountry->id_zone;      }      return $R3CA092FF89E1C9FFB12399030355F8FC;     }   public static function getLinkedCarriersForOrder($R0ACBF3334E5196BD6BFD3ADC13786C4C, $R3CA092FF89E1C9FFB12399030355F8FC)  {   $RB10E8575D7A5B4C417D9DCF8D6BC17BE = Context::getContext();          $R130D64A4AD653C91E0FD80DE8FEADC3A ='    SELECT c.*, cl.delay    FROM `'._DB_PREFIX_.'carrier` c    LEFT JOIN `'._DB_PREFIX_.'carrier_lang` cl ON (c.`id_carrier` = cl.`id_carrier` AND cl.`id_lang` = '.(int)($RB10E8575D7A5B4C417D9DCF8D6BC17BE->cookie->id_lang).')    WHERE c.id_carrier=' . $R0ACBF3334E5196BD6BFD3ADC13786C4C;          $R679E9B9234E2062F809DBD3325D37FB6 = Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);   $REBECFC911FDAC841EFD5B0F736863247 = array();    foreach ($R679E9B9234E2062F809DBD3325D37FB6 AS $RA09FE38AF36F6839F4A75051DC7CEA25 => $R4EEB713E57BBAAF1217CF39632604473)   {    $R53CED8F460F10F938CCEC04FE634E4D3 = new Carrier((int)$R4EEB713E57BBAAF1217CF39632604473['id_carrier']);    $RAA1B8056C6B230EA06B16C09326D3B84 = $R53CED8F460F10F938CCEC04FE634E4D3->getShippingMethod();    if ($RAA1B8056C6B230EA06B16C09326D3B84 != Carrier::SHIPPING_METHOD_FREE)    {         if ($R4EEB713E57BBAAF1217CF39632604473['range_behavior'])     {           if (!$R3CA092FF89E1C9FFB12399030355F8FC)       $R3CA092FF89E1C9FFB12399030355F8FC = (int)(_PS_VERSION_>'1.5' ? Context::getContext()->country->id :  Country::getDefaultCountryId());            if (($RAA1B8056C6B230EA06B16C09326D3B84 == Carrier::SHIPPING_METHOD_WEIGHT AND (!Carrier::checkDeliveryPriceByWeight($R4EEB713E57BBAAF1217CF39632604473['id_carrier'], $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->getTotalWeight(), $R3CA092FF89E1C9FFB12399030355F8FC)))       OR ($RAA1B8056C6B230EA06B16C09326D3B84 == Carrier::SHIPPING_METHOD_PRICE AND (!Carrier::checkDeliveryPriceByPrice($R4EEB713E57BBAAF1217CF39632604473['id_carrier'], $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->getOrderTotal(true, Cart::BOTH_WITHOUT_SHIPPING), $R3CA092FF89E1C9FFB12399030355F8FC, $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->id_currency))))      {       unset($R679E9B9234E2062F809DBD3325D37FB6[$RA09FE38AF36F6839F4A75051DC7CEA25]);       continue ;      }     }    }        $R4EEB713E57BBAAF1217CF39632604473['name'] = (strval($R4EEB713E57BBAAF1217CF39632604473['name']) != '0' ? $R4EEB713E57BBAAF1217CF39632604473['name'] : Configuration::get('PS_SHOP_NAME'));    $R4EEB713E57BBAAF1217CF39632604473['price'] = ($RAA1B8056C6B230EA06B16C09326D3B84 == Carrier::SHIPPING_METHOD_FREE ? 0 : $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->getOrderShippingCost((int)$R4EEB713E57BBAAF1217CF39632604473['id_carrier']));    $R4EEB713E57BBAAF1217CF39632604473['price_tax_exc'] = ($RAA1B8056C6B230EA06B16C09326D3B84 == Carrier::SHIPPING_METHOD_FREE ? 0 : $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->getOrderShippingCost((int)$R4EEB713E57BBAAF1217CF39632604473['id_carrier'], false));    $R4EEB713E57BBAAF1217CF39632604473['img'] = file_exists(_PS_SHIP_IMG_DIR_.(int)($R4EEB713E57BBAAF1217CF39632604473['id_carrier']).'.jpg') ? _THEME_SHIP_DIR_.(int)($R4EEB713E57BBAAF1217CF39632604473['id_carrier']).'.jpg' : '';        if ($R4EEB713E57BBAAF1217CF39632604473['price'] === false)    {     unset($R679E9B9234E2062F809DBD3325D37FB6[$RA09FE38AF36F6839F4A75051DC7CEA25]);     continue;    }     $REBECFC911FDAC841EFD5B0F736863247[] = $R4EEB713E57BBAAF1217CF39632604473;   }   return $REBECFC911FDAC841EFD5B0F736863247;  }      public static function assignCarrierPrices($RE484ED591E12CF9125AE1D47AE08748B, $R3CA092FF89E1C9FFB12399030355F8FC, $R40095968F29813E02A981F327827F17B, $R22AC9E3C2EE714BEF680E5CB5C8B74C1 = 1, $REDFEC30A90E80DFAD993E56F628914D4 = 0)  {   $RB10E8575D7A5B4C417D9DCF8D6BC17BE = Context::getContext();      $RB3F07F8C3658A835940E88288B58F707 = new Product($R40095968F29813E02A981F327827F17B, true, $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cookie->id_lang);   $RB23DB944F271CAFCA6F2C79ECB1B70B9 = Product::getPriceStatic($R40095968F29813E02A981F327827F17B, true, $REDFEC30A90E80DFAD993E56F628914D4, 6) * $R22AC9E3C2EE714BEF680E5CB5C8B74C1;   $R77428B72A47DAA3A6178DF619FFB60CE = floatval($RB3F07F8C3658A835940E88288B58F707->weight) * $R22AC9E3C2EE714BEF680E5CB5C8B74C1;   $REBECFC911FDAC841EFD5B0F736863247 = array();     foreach ($RE484ED591E12CF9125AE1D47AE08748B AS $RA09FE38AF36F6839F4A75051DC7CEA25 => $R4EEB713E57BBAAF1217CF39632604473)   {    $R0ACBF3334E5196BD6BFD3ADC13786C4C = (int)$R4EEB713E57BBAAF1217CF39632604473['id_carrier'];    $R53CED8F460F10F938CCEC04FE634E4D3 = new Carrier($R0ACBF3334E5196BD6BFD3ADC13786C4C,$RB10E8575D7A5B4C417D9DCF8D6BC17BE->cookie->id_lang);    $R6E3CED3C0C347D45115DA9AA41DEEEDE = $R53CED8F460F10F938CCEC04FE634E4D3->getShippingMethod();    $R24FC824144C5D333AED0FE061B144A8B =  $R22AC9E3C2EE714BEF680E5CB5C8B74C1 * floatval($RB3F07F8C3658A835940E88288B58F707->additional_shipping_cost);    if($R6E3CED3C0C347D45115DA9AA41DEEEDE == Carrier::SHIPPING_METHOD_FREE)    {     $R89FFEECBCD7B7E3554EE955B40610E80 = 0 + $R24FC824144C5D333AED0FE061B144A8B;    }    else if($R6E3CED3C0C347D45115DA9AA41DEEEDE == Carrier::SHIPPING_METHOD_WEIGHT)    {     $R89FFEECBCD7B7E3554EE955B40610E80 = $R53CED8F460F10F938CCEC04FE634E4D3->getDeliveryPriceByWeight($R77428B72A47DAA3A6178DF619FFB60CE,$R3CA092FF89E1C9FFB12399030355F8FC) + $R24FC824144C5D333AED0FE061B144A8B;    }    else    {     $R89FFEECBCD7B7E3554EE955B40610E80 = $R53CED8F460F10F938CCEC04FE634E4D3->getDeliveryPriceByPrice($RB23DB944F271CAFCA6F2C79ECB1B70B9,$R3CA092FF89E1C9FFB12399030355F8FC) + $R24FC824144C5D333AED0FE061B144A8B;    }        if($R53CED8F460F10F938CCEC04FE634E4D3->shipping_handling)     $R89FFEECBCD7B7E3554EE955B40610E80 += (float)Configuration::get('PS_SHIPPING_HANDLING');        $R2E40DD98B04A56243C3918D5F15BF59E = Group::getPriceDisplayMethod(Group::getCurrent()->id);    if($R2E40DD98B04A56243C3918D5F15BF59E == PS_TAX_INC AND !Tax::excludeTaxeOption())    {     $RB87DEFFF2BA684B74193D047FEF264A1 = Tax::getCarrierTaxRate((int)$R53CED8F460F10F938CCEC04FE634E4D3->id, (int)($RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->{Configuration::get('PS_TAX_ADDRESS_TYPE')}));     if (isset($RB87DEFFF2BA684B74193D047FEF264A1))$R89FFEECBCD7B7E3554EE955B40610E80 *= 1 + ($RB87DEFFF2BA684B74193D047FEF264A1 / 100);    }     $R89FFEECBCD7B7E3554EE955B40610E80 = Tools::convertPrice(floatval($R89FFEECBCD7B7E3554EE955B40610E80));     $R4EEB713E57BBAAF1217CF39632604473['price'] = $R89FFEECBCD7B7E3554EE955B40610E80;        if($RB3F07F8C3658A835940E88288B58F707->is_virtual)$R89FFEECBCD7B7E3554EE955B40610E80 = 0;     $R4EEB713E57BBAAF1217CF39632604473['name'] = (strval($R4EEB713E57BBAAF1217CF39632604473['name']) != '0' ? $R4EEB713E57BBAAF1217CF39632604473['name'] : Configuration::get('PS_SHOP_NAME'));        $R4EEB713E57BBAAF1217CF39632604473['name'] .= '-'. $R53CED8F460F10F938CCEC04FE634E4D3->delay . ':(' . Tools::displayPrice($R89FFEECBCD7B7E3554EE955B40610E80) . ')';        $REBECFC911FDAC841EFD5B0F736863247[] = $R4EEB713E57BBAAF1217CF39632604473;   }    return $REBECFC911FDAC841EFD5B0F736863247;  }   public static function get_carrier_products($RF50CDD3F2AACFD3098534F1C052C25BE,$R95909C49377A2B4F24C79D29C629AF65)  {   if(!intval($RF50CDD3F2AACFD3098534F1C052C25BE))return array();   $R0EEE54DBD8E9C0D43D2A7877AAE81F24 = Module::isInstalled('agilepickupcenter');    $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT cc.id_carrier,cc.id_product,cc.id_product_attribute ';   if($R0EEE54DBD8E9C0D43D2A7877AAE81F24)   {    $R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A . ',cc.id_location,l.location,l.id_location,l.address1,l.postcode ';   }                 $R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A . 'FROM ' . _DB_PREFIX_ . 'agile_cartcarrier cc                      LEFT JOIN ' . _DB_PREFIX_ . 'product_owner po ON cc.id_product=po.id_product ';   if($R0EEE54DBD8E9C0D43D2A7877AAE81F24)   {    $R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A . 'LEFT JOIN ' . _DB_PREFIX_ . 'location l ON cc.id_location=l.id_location ';   }                 $R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A . 'WHERE id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE . '                     AND IFNULL(po.id_owner,0) = ' . $R95909C49377A2B4F24C79D29C629AF65 . '      AND cc.id_carrier >0                 ';     return Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);     }   public static function products_without_carrier($R3CA092FF89E1C9FFB12399030355F8FC, $RF50CDD3F2AACFD3098534F1C052C25BE, $R843772E13ECF32C5CEEF23010FB27FBA)  {   $RB10E8575D7A5B4C417D9DCF8D6BC17BE = Context::getContext();      if(!$RF50CDD3F2AACFD3098534F1C052C25BE)return;   $RF9AA09C4492B9A9D072FC9F115B8C9AE = new Cart($RF50CDD3F2AACFD3098534F1C052C25BE);   $R743CE00DE0F4FEA746D03BBAE2968D01 = $RF9AA09C4492B9A9D072FC9F115B8C9AE->getProducts(false);   if(!isset($R743CE00DE0F4FEA746D03BBAE2968D01) OR empty($R743CE00DE0F4FEA746D03BBAE2968D01))return;   if(!$R3CA092FF89E1C9FFB12399030355F8FC)    $R3CA092FF89E1C9FFB12399030355F8FC = SellerShipping::getZoneID($RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->id_address_delivery, $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cart->id_customer);    $RE484ED591E12CF9125AE1D47AE08748B = array();   for($R5B92E56774920499F4ADDD0EC782C83E=0;$R5B92E56774920499F4ADDD0EC782C83E<count($R743CE00DE0F4FEA746D03BBAE2968D01);$R5B92E56774920499F4ADDD0EC782C83E++)   {    $R40095968F29813E02A981F327827F17B = intval($R743CE00DE0F4FEA746D03BBAE2968D01[$R5B92E56774920499F4ADDD0EC782C83E]['id_product']);    $REDFEC30A90E80DFAD993E56F628914D4 = intval($R743CE00DE0F4FEA746D03BBAE2968D01[$R5B92E56774920499F4ADDD0EC782C83E]['id_product_attribute']);    $R22AC9E3C2EE714BEF680E5CB5C8B74C1 = intval($R743CE00DE0F4FEA746D03BBAE2968D01[$R5B92E56774920499F4ADDD0EC782C83E]['quantity']);    $R29E86421AF7E81568F7C79AE872A9AE6 = SellerShipping::getAvailableCarriers($R3CA092FF89E1C9FFB12399030355F8FC, $R40095968F29813E02A981F327827F17B, $R22AC9E3C2EE714BEF680E5CB5C8B74C1, $REDFEC30A90E80DFAD993E56F628914D4);    if(empty($R29E86421AF7E81568F7C79AE872A9AE6))    {     $RE484ED591E12CF9125AE1D47AE08748B[] = array('id_product' => $R743CE00DE0F4FEA746D03BBAE2968D01[$R5B92E56774920499F4ADDD0EC782C83E]['id_product'], 'product_name' => $R743CE00DE0F4FEA746D03BBAE2968D01[$R5B92E56774920499F4ADDD0EC782C83E]['name']);    }   }   return $RE484ED591E12CF9125AE1D47AE08748B;  }     public static function get_carrier_product_locations($RF50CDD3F2AACFD3098534F1C052C25BE,$R40095968F29813E02A981F327827F17B,$R0ACBF3334E5196BD6BFD3ADC13786C4C)  {   if(!intval($RF50CDD3F2AACFD3098534F1C052C25BE) || !Module::isInstalled('agilepickupcenter') )return array();   $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT DISTINCT  l.location,l.id_location,l.address1,l.postcode,cc.id_location id_location_selected '                 . 'FROM ' . _DB_PREFIX_ . 'agile_cartcarrier cc '                 . 'INNER JOIN ' . _DB_PREFIX_ . 'product_owner po ON cc.id_product=po.id_product '                 . 'INNER JOIN ' . _DB_PREFIX_ . 'location l ON l.id_carrier=cc.id_carrier AND l.id_seller=po.id_owner '                 . 'WHERE cc.id_cart=' . $RF50CDD3F2AACFD3098534F1C052C25BE . ' AND cc.id_product = ' . $R40095968F29813E02A981F327827F17B    . ' AND cc.id_carrier=' . $R0ACBF3334E5196BD6BFD3ADC13786C4C . ' AND l.deleted=0';     return Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);     }   public static  function first_or_default_location($RBD77092B249DD66EF0B009A46427535F)  {   if(empty($RBD77092B249DD66EF0B009A46427535F))return 0;   return (int)$RBD77092B249DD66EF0B009A46427535F[0]['id_location'];  }  } 