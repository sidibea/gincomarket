<?php
///-build_id: 2017010210.404
/// This source file is subject to the Software License Agreement that is bundled with this 
/// package in the file license.txt, or you can get it here
/// http://addons-modules.com/en/content/3-terms-and-conditions-of-use
///
/// @copyright  2009-2016 Addons-Modules.com
///  If you need open code to customize or merge code with othe modules, please contact us.
if (!defined('_PS_VERSION_'))
	exit;

include_once(_PS_ROOT_DIR_ . "/modules/agilekernel/init.php");

if(!file_exists(_PS_ROOT_DIR_ . "/override/classes/module/Module.php"))
{
	include_once(_PS_ROOT_DIR_ . "/modules/agilekernel/override/classes/module/Module.php");
}
else if(strpos(file_get_contents(_PS_ROOT_DIR_ . "/override/classes/module/Module.php"),"AgilePreinstall") === false)
{
	include_once(_PS_ROOT_DIR_ . "/modules/agilekernel/override/classes/module/Module.php");
}

class AgileKernel extends Module
{
	private	$_html = '';
	public	$shared_override = array(
		'classes/Hook.php' => array('agilemultipleseller','agilepaypal'),
		'classes/Mail.php' => array('agilemultipleseller','agileprepaidcredit','agilesellershipping','agilepickupcenter'),
		'classes/pdf/HTMLTemplateInvoice.php' => array('agilemultipleseller','agilepickupcenter'),
		'classes/PaymentModule.php' => array('agilemultipleseller','agileprepaidcredit'),
		'controllers/front/CartController.php' => array('agilemultipleseller','agileprepaidcredit','agilemembership'),
		);

	public function __construct()   {    $this->agile_configs = Configuration::getMultiple($this->getConfigKeys());     $this->agile_newfiles = array();        $this->agile_dependencies = array();           $this->name = 'agilekernel';        $this->bootstrap = true;    parent::__construct();      $this->tab = 'front_office_features';    $this->author = 'addons-modules.com';    $this->version = '1.7.1.0';    $this->ps_versions_compliancy = array('min' => '1.7', 'max' => '1.8');    $this->dependencies = array();    $this->agile_dependencies = array();       $this->displayName = $this->l('Agile Kernel');    $this->description = $this->l('This is a kernel module for all Agile Modules from Addons-Modules.com, it holds the base and common components for all other Agile Module. You have to install this module first before installing any other Agile Modules.');   }      private function getConfigKeys()   {    return array('AK_ORDER_REFERENCE','AK_GRC_SITE_KEY','AK_GRC_SECRET_KEY','AK_GMAP_APIKEY');     }     public function install()   {    $R4D1B20585F5E90178187AC0090AC2F2F = $this->incompatibelModules();    if(!empty($R4D1B20585F5E90178187AC0090AC2F2F)){     $RD61B7D3281F8A9647967BDE23E6A0762 = $this->l('The following modules are not compatible with Agile Kernel module, you need upgrade all Agile modules to the latest version(please reauest update of those modules). You will then need to uninstall/delete those old modules first:') . '<BR>' . implode("<br>",$R4D1B20585F5E90178187AC0090AC2F2F);     $RD61B7D3281F8A9647967BDE23E6A0762 .= "<br><br>" . $this->l('Please note, if there was any custom changes made to your store or if there was any override classes code merged before, you will not be able to upgarde the modules easily because PrestaShop will not be able to uninstall those override classes. You may face issues if you proceed to upgrade the modules. ');     $RD61B7D3281F8A9647967BDE23E6A0762 .= $this->l('If this is the case, we recommend you to request an old version of module you just purchased to match the version of other Agile modules you have. ');       $this->_errors[] = $RD61B7D3281F8A9647967BDE23E6A0762;     return false;    }      $this->renameIncompatibleOldFile();        $RA279E72759B585B5FE9D78B5CF755E16 = $this->incompatibleFiles();    if(!empty($RA279E72759B585B5FE9D78B5CF755E16)){     $this->_errors[] =   $this->l('The following files are not compatible with Agile Kernel, please delete those files first:') . '<BR>' . implode("<br>",$RA279E72759B585B5FE9D78B5CF755E16);     return false;    }        if(!$this->AgilePreinstall())return false;        if  (parent::install() == false )    {     $this->_errors[] = $this->l('Install error - call parent::install()');     return false;    }      $this->install_configfile();        if(!AgileInstaller::create_tab('Agile Modules', 'AgileModulesParent', '', $this->name))return false;    AgileInstaller::init_tab_prmission_for_existing_profiles('AdminLocations',1,1,1,1);          if(!$this->AgileSetGlobalDefaultConfig('AK_ORDER_REFERENCE', '')     OR !$this->AgileSetGlobalDefaultConfig('AK_GRC_SITE_KEY', '')     OR !$this->AgileSetGlobalDefaultConfig('AK_GRC_SECRET_KEY', '')     OR !$this->AgileSetGlobalDefaultConfig('AK_GMAP_APIKEY', '')    )    return false;            if (!$this->registerHook('displayHeader')       OR !$this->registerHook('displayBackOfficeHeader')      OR !$this->registerHook('displayTop')      OR !$this->registerHook('displayBackOfficeTop')     )return false;        return true;   }      private function install_configfile()   {    $R0E50532F705BA890C56DC90FC3472539 = AgileInstaller::detect_admin_folder($_SERVER['SCRIPT_FILENAME']);      $R5BB0F91160D861A362326F16F17AA14C = _PS_ROOT_DIR_ . "/config/config.inc.php";    $RE82EE9B121F709895EF54EBA7FA6B78B = file_get_contents($R5BB0F91160D861A362326F16F17AA14C);      $R980C6A9BFD38E36311B691E3ADD7CCAD = strrpos($RE82EE9B121F709895EF54EBA7FA6B78B, "agilekernel");    if($R980C6A9BFD38E36311B691E3ADD7CCAD === false)    {     $RD9A93554B5AF46132E19F5DCFCD27AB5 = fopen($R5BB0F91160D861A362326F16F17AA14C, "a+");     if(!$RD9A93554B5AF46132E19F5DCFCD27AB5)return;        fwrite($RD9A93554B5AF46132E19F5DCFCD27AB5, "\r\nif(file_exists(_PS_ROOT_DIR_.'/modules/agilekernel/init.php'))include_once(_PS_ROOT_DIR_.'/modules/agilekernel/init.php');\r\n");     fclose($RD9A93554B5AF46132E19F5DCFCD27AB5);    }   }        public function uninstall()   {       @set_time_limit(300);    $R4D1B20585F5E90178187AC0090AC2F2F = $this->getAllAgileModules(true, false);    if(!empty($R4D1B20585F5E90178187AC0090AC2F2F))    {     $this->_errors[] = $this->l('This module can not be uninstalled, you must uninstall following Agile Modules first: ') . '<br>' . implode("<br>",$R4D1B20585F5E90178187AC0090AC2F2F);     return false;    }        AgileInstaller::delete_tab('AgileModulesParent');        if(!parent::uninstall())return false;    return true;   }     public function uninstall4Update()   {       @set_time_limit(300);    if(!parent::uninstall())return false;    return true;   }       private function getAllAgileModules($R7F188CBAB665CCE086DE2A9FEA5A8EA7, $RFAD8894088BD6BDA2C297D8E26697DFD)   {    $R4D1B20585F5E90178187AC0090AC2F2F = array();    $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT id_module, name FROM ' . _DB_PREFIX_ . 'module WHERE name like \'agile%\'';    if(!$RFAD8894088BD6BDA2C297D8E26697DFD)$R130D64A4AD653C91E0FD80DE8FEADC3A = $R130D64A4AD653C91E0FD80DE8FEADC3A  . ' AND name !=\'agilekernel\'';    $RAD04C361A915581334DEC30FE99EFD64 = Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);    $R577CA80609F0EA15B02D13C53BD95B20 = false;    foreach($RAD04C361A915581334DEC30FE99EFD64 as $RB1E236A47D72E88036214D97B38E8C72)    {     $R3ECE02B6F1DFB21A17670D6FBADB9C84 = Module::getInstanceByName($RB1E236A47D72E88036214D97B38E8C72['name']);     if(strtolower($R3ECE02B6F1DFB21A17670D6FBADB9C84->author) == 'addons-modules.com')     {      if($R7F188CBAB665CCE086DE2A9FEA5A8EA7)       $R4D1B20585F5E90178187AC0090AC2F2F[] = $R3ECE02B6F1DFB21A17670D6FBADB9C84->displayName . '-' .  $R3ECE02B6F1DFB21A17670D6FBADB9C84->version;      else       $R4D1B20585F5E90178187AC0090AC2F2F[] = $R3ECE02B6F1DFB21A17670D6FBADB9C84->name . '-' .  $R3ECE02B6F1DFB21A17670D6FBADB9C84->version;     }    }    return $R4D1B20585F5E90178187AC0090AC2F2F;   }      private function incompatibelModules()   {    $R4D1B20585F5E90178187AC0090AC2F2F = array();    $R130D64A4AD653C91E0FD80DE8FEADC3A = 'SELECT id_module, name FROM ' . _DB_PREFIX_ . 'module WHERE name like \'agile%\' and name!=\'agilekernel\'';    $RAD04C361A915581334DEC30FE99EFD64 = Db::getInstance()->ExecuteS($R130D64A4AD653C91E0FD80DE8FEADC3A);    $R577CA80609F0EA15B02D13C53BD95B20 = false;    foreach($RAD04C361A915581334DEC30FE99EFD64 as $RB1E236A47D72E88036214D97B38E8C72)    {     $R3ECE02B6F1DFB21A17670D6FBADB9C84 = Module::getInstanceByName($RB1E236A47D72E88036214D97B38E8C72['name']);     if(strtolower($R3ECE02B6F1DFB21A17670D6FBADB9C84->author) == 'addons-modules.com' && (!property_exists($R3ECE02B6F1DFB21A17670D6FBADB9C84, 'isAgileKernelCompatible') || $R3ECE02B6F1DFB21A17670D6FBADB9C84->isAgileKernelCompatible != true))     {      $R4D1B20585F5E90178187AC0090AC2F2F[] = $R3ECE02B6F1DFB21A17670D6FBADB9C84->displayName . '(' .  $R3ECE02B6F1DFB21A17670D6FBADB9C84->name .')' . '-' . $this->l('version') . $R3ECE02B6F1DFB21A17670D6FBADB9C84->version;     }    }    return $R4D1B20585F5E90178187AC0090AC2F2F;   }      private function renameIncompatibleOldFile()   {     if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileHelper.php"))rename(_PS_ROOT_DIR_ . "/classes/AgileHelper.php",_PS_ROOT_DIR_ . "/classes/AgileHelper.php.removed");    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileInstaller.php")) rename(_PS_ROOT_DIR_ . "/classes/AgileInstaller.php",_PS_ROOT_DIR_ . "/classes/AgileInstaller.php.removed");    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileSellerManager.php")) rename(_PS_ROOT_DIR_ . "/classes/AgileSellerManager.php",_PS_ROOT_DIR_ . "/classes/AgileSellerManager.php.removed");    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileSessionData.php")) rename(_PS_ROOT_DIR_ . "/classes/AgileSessionData.php",_PS_ROOT_DIR_ . "/classes/AgileSessionData.php.removed");    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileSessionHandler.php")) rename(_PS_ROOT_DIR_ . "/classes/AgileSessionHandler.php",_PS_ROOT_DIR_ . "/classes/AgileSessionHandler.php.removed");    if(file_exists(_PS_ROOT_DIR_ . "/classes/controller/AgileModuleFrontController.php")) rename(_PS_ROOT_DIR_ . "/classes/controller/AgileModuleFrontController.php",_PS_ROOT_DIR_ . "/classes/controller/AgileModuleFrontController.php.removed");    if(file_exists(_PS_ROOT_DIR_ . "/classes/module/AgileModule.php")) rename(_PS_ROOT_DIR_ . "/classes/module/AgileModule.php",_PS_ROOT_DIR_ . "/classes/module/AgileModule.php.removed");   }         private function incompatibleFiles()   {     $RA279E72759B585B5FE9D78B5CF755E16 =  array();    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileHelper.php")) $RA279E72759B585B5FE9D78B5CF755E16[] =  _PS_ROOT_DIR_ . "/classes/AgileHelper.php";    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileInstaller.php")) $RA279E72759B585B5FE9D78B5CF755E16[] =  _PS_ROOT_DIR_ . "/classes/AgileInstaller.php";    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileSellerManager.php")) $RA279E72759B585B5FE9D78B5CF755E16[] =  _PS_ROOT_DIR_ . "/classes/AgileSellerManager.php";    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileSessionData.php")) $RA279E72759B585B5FE9D78B5CF755E16[] =  _PS_ROOT_DIR_ . "/classes/AgileSessionData.php";    if(file_exists(_PS_ROOT_DIR_ . "/classes/AgileSessionHandler.php")) $RA279E72759B585B5FE9D78B5CF755E16[] =  _PS_ROOT_DIR_ . "/classes/AgileSessionHandler.php";    if(file_exists(_PS_ROOT_DIR_ . "/classes/controller/AgileModuleFrontController.php")) $RA279E72759B585B5FE9D78B5CF755E16[] =  _PS_ROOT_DIR_ . "/classes/controller/AgileModuleFrontController.php";    if(file_exists(_PS_ROOT_DIR_ . "/classes/module/AgileModule.php")) $RA279E72759B585B5FE9D78B5CF755E16[] =  _PS_ROOT_DIR_ . "/classes/module/AgileModule.php";        return $RA279E72759B585B5FE9D78B5CF755E16;   }      public function displayErrors()   {    $R5E535DBA6BC26B2ECEEF3DA589516785 = sizeof($this->_errors);    $this->_html .=  '    <div class="module_error alert alert-danger">     <h3>'.($R5E535DBA6BC26B2ECEEF3DA589516785 > 1 ? $this->l('There are') : $this->l('There is')).' '.$R5E535DBA6BC26B2ECEEF3DA589516785.' '.($R5E535DBA6BC26B2ECEEF3DA589516785 > 1 ? $this->l('errors') : $this->l('error')).'</h3>     <ol>';    foreach ($this->_errors AS $RB5ADDE8D7D7412251F47419FE9BF51A7)     $this->_html .=  '      <li>'.$RB5ADDE8D7D7412251F47419FE9BF51A7.'</li>';      $this->_html .=  '     </ol>    </div>';   }      private function getServicePoint()   {      if(defined('_IS_AGILE_DEV_') OR defined('_IS_AGILE_TEST_'))return "http://teststore.com/store/getModuleUpdateInfo.php";    else return "https://addons-modules.com/store/getModuleUpdateInfo.php";   }         private function getModuleUpdateInfo()   {    $RFEF7B2F283572C4405E10C6D97C1473B = (Configuration::get('PS_SSL_ENABLED') || Tools::usingSecureMode()) ? 'https://' : 'http://';    $R267562F8487C1248FD776E6803308CA6 = $RFEF7B2F283572C4405E10C6D97C1473B.Tools::getShopDomainSsl().__PS_BASE_URI__;    $RC2D2567438B1F39DD71F78195B5F3DED = array();    $RC2D2567438B1F39DD71F78195B5F3DED['order_reference'] = Configuration::get('AK_ORDER_REFERENCE');    $RC2D2567438B1F39DD71F78195B5F3DED['ps_version'] = _PS_VERSION_;    $RC2D2567438B1F39DD71F78195B5F3DED['store_url'] = $R267562F8487C1248FD776E6803308CA6;    $RC2D2567438B1F39DD71F78195B5F3DED['modules'] = urlencode(implode("|",$this->getAllAgileModules(false,true)));    return AgileHelper::call_remote_server($this->getServicePoint(), $RC2D2567438B1F39DD71F78195B5F3DED);     }        public function getContent()   {    if (Tools::isSubmit('submitSettings'))    {     Configuration::updateValue('AK_ORDER_REFERENCE', Tools::getValue('ak_order_reference'));     Configuration::updateValue('AK_GRC_SITE_KEY', Tools::getValue('ak_grc_site_key'));     Configuration::updateValue('AK_GRC_SECRET_KEY', Tools::getValue('ak_grc_secret_key'));     Configuration::updateValue('AK_GMAP_APIKEY', Tools::getValue('ak_gmap_apikey'));          $this->_html .= $this->displayConfirmation($this->l('Settings updated'));    }          $this->_html = '<h2>'.$this->displayName.'</h2>';      $R0E50532F705BA890C56DC90FC3472539 = AgileInstaller::detect_admin_folder($_SERVER['SCRIPT_FILENAME']);    $R5A0E1B3F4DE39462E7CECCA34A34D7E1 = AgileInstaller::install_health_check($this->agile_newfiles, $this->name, $R0E50532F705BA890C56DC90FC3472539);    if(!empty($R5A0E1B3F4DE39462E7CECCA34A34D7E1)) $this->_html .= $R5A0E1B3F4DE39462E7CECCA34A34D7E1;      $this->_html .= AgileInstaller::show_agile_links();      $this->_html .= $this->displayModuleUpdateInfo();        if(!empty($this->_errors))$this->_html .= $this->displayErrors();          $this->_html .= $this->renderForm();        return $this->_html;   }         public function displayModuleUpdateInfo()   {        $RED1AF45C036BDD48486C3EB0E631E3A7 = $this->getModuleUpdateInfo();     $R8E9B55C6D440AF5BF2F3CD63A6B4F944 = Tools::jsonDecode($RED1AF45C036BDD48486C3EB0E631E3A7);        $R0EB1982D9BAA9716AC37A8F047D5800D = array();        $R469F52873FDD86DF3AA7E56AAA077AB5 = gettype($R8E9B55C6D440AF5BF2F3CD63A6B4F944);      if($R469F52873FDD86DF3AA7E56AAA077AB5 == "NULL" && !empty($RED1AF45C036BDD48486C3EB0E631E3A7)){     $R0EB1982D9BAA9716AC37A8F047D5800D[] = $RED1AF45C036BDD48486C3EB0E631E3A7;    }      else if($R8E9B55C6D440AF5BF2F3CD63A6B4F944->status == 'error')    {     $R0EB1982D9BAA9716AC37A8F047D5800D[] = $R8E9B55C6D440AF5BF2F3CD63A6B4F944->message;    }      $this->_html .=  '    <div class="alert alert-info">     <script type="text/javascript">     function updateAgileModule(module, version, url) {      var adminModuleUrl = "./index.php?controller=AdminModules&token=' . Tools::getAdminTokenLite('AdminModules') . '&ajax=true&action=update_agile_module&m_to_update=" + module + "&v_to_update=" + version + "&u_to_update=" + url;      $("[id^=updateModule_]").hide();      $("#divUpdateMessage").show();      $.post(adminModuleUrl, "",      function (response, status, xhr) {       var msg = response.status + "\\r\\n";       if(response.messages.length ==0) msg = msg + "'  . $this->l('Module has been updated successfully.') .'\\r\\n";       else       {        for(idx=0;idx<response.messages.length;idx++)msg = msg + response.messages[idx] + "\\r\\n";       }       msg = msg + "\\r\\n";       $("#divUpdateMessage").html();       agile_show_message(msg);       window.location.reload(true);             }, "json");       }     $("document").ready(function(){      $("#divUpdateMessage").hide();        });     </script>         <H4><b>' . $this->l('Agile Module Update Info'). '</b></h4>      <div id="divUpdateMessage" class="alert alert-info"><img src="../modules/agilekernel/img/processing.gif" style="display:;"></div>     ';      if($R8E9B55C6D440AF5BF2F3CD63A6B4F944->status == 'ok')    {     $RF8063415D46FE064AD68B35A3CBE766A = sizeof($R8E9B55C6D440AF5BF2F3CD63A6B4F944->modules);     if($RF8063415D46FE064AD68B35A3CBE766A > 0)      $this->_html .=  '<span>'.$this->l('There following ') .' '.$RF8063415D46FE064AD68B35A3CBE766A.' '. $this->l('module(s) areavailable for upodate') .'</span>';     else      $this->_html .=  '<span>'.$this->l('All your modules are up to date at this moment') .'</span>';          $this->_html .= '<ol>';     foreach ($R8E9B55C6D440AF5BF2F3CD63A6B4F944->modules as $R01787CB5A57D47DC8A648998E4A6512C)     {      $R0F9F3E6F83512CB44E4D5B50F7B1696E = '';      if(!empty($R01787CB5A57D47DC8A648998E4A6512C->update_url))$R0F9F3E6F83512CB44E4D5B50F7B1696E = '<input id="updateModule_' . $R01787CB5A57D47DC8A648998E4A6512C->module . '" type=button onclick="updateAgileModule(\'' . $R01787CB5A57D47DC8A648998E4A6512C->module . '\',\'' . $R01787CB5A57D47DC8A648998E4A6512C->version  . '\',\'' . urlencode($R01787CB5A57D47DC8A648998E4A6512C->update_url) .'\');" class="btn btn-default" value="' . $this->l('Update') . '">';      else $R0F9F3E6F83512CB44E4D5B50F7B1696E = '<span>' . $this->l('Please contact support@addons-modules.com for module upgrade.') . '</span>';        $this->_html .=  '         <li>'.$R01787CB5A57D47DC8A648998E4A6512C->module. ' ' . $R01787CB5A57D47DC8A648998E4A6512C->version . '&nbsp;&nbsp;(your version:' . $R01787CB5A57D47DC8A648998E4A6512C->your_version . ')&nbsp;' . $R0F9F3E6F83512CB44E4D5B50F7B1696E. '</li>';     }     $this->_html .=  '       </ol>';    }    else    {     $this->_html .=  '       <span>'.$this->l('There following ') .' '.count($R0EB1982D9BAA9716AC37A8F047D5800D).' '. $this->l('error(s) occured when retrive module upodate information.') .'</span>       <ol style="color:red;">';     foreach ($R0EB1982D9BAA9716AC37A8F047D5800D as $RB5ADDE8D7D7412251F47419FE9BF51A7)     {      $this->_html .=  '        <li>'.$RB5ADDE8D7D7412251F47419FE9BF51A7. '</li>';     }     $this->_html .=  '       </ol>';         }    $this->_html .=  '</div>';       }       public function renderForm()   {    $RD05A28496998D5D330106BBAE629B948 = array(     'form' => array(       'legend' => array(        'title' => $this->l('Settings'),        'image' => $this->_path.'logo.png',        ),       'input' => array(        array(         'type' => 'text',         'label' => $this->l('Your Order Reference #'),         'name' => 'ak_order_reference',         'desc' => $this->l('Order reference - please enter a correct/valid order reference # from Addons-module.com, separated by a comma. For example: CODJHZHBJ,BYNPHFRJP,NDUSMTDZV.')         ),        array(         'type' => 'text',         'label' => $this->l('Google ReCapcha Site Key'),         'name' => 'ak_grc_site_key',         ),        array(         'type' => 'text',         'label' => $this->l('Google ReCapcha Secret Key'),         'name' => 'ak_grc_secret_key',         'desc' => $this->l('All Capcha used in modules from Addons-Modules.com is Google ReCapcha, you need this if you using one of following modules: Agile Showcase Manager, Agile Product Reviews, Agile Seller Messenger. Otherwise, you can leave those 2 fields empty.') . '<br><a href="https://www.google.com/recaptcha/admin#list" target="_new">' . $this->l('You can get a pair of key for your domain from Goole for free') . '</a>'         ),        array(         'type' => 'text',         'label' => $this->l('Google Map API Key'),         'name' => 'ak_gmap_apikey',         'desc' => $this->l('All Google Maps used in modules from Addons-Modules.com will need this, if you using one of following modules: Agile Pickup Center, Agile Multiple Seller. Otherwise, you can leave this field empty.') . '<br><a href="https://addons-modules.com/store/en/content/99-how-to-apply-or-get-google-api-key" target="_new">' . $this->l('You can get a Google Map API Key for your domain from Goole for free') . '</a>'         ),        ),       'submit' => array(        'title' => $this->l('Save'),        )       )      );      $R3A1E73211A105E82A8C89F8C8E3C8264 = new HelperForm();    $R3A1E73211A105E82A8C89F8C8E3C8264->show_toolbar = false;    $R3A1E73211A105E82A8C89F8C8E3C8264->table = $this->table;    $R51C716B9664B3F4E109066C05B9B1A86 = new Language((int)Configuration::get('PS_LANG_DEFAULT'));    $R3A1E73211A105E82A8C89F8C8E3C8264->default_form_language = $R51C716B9664B3F4E109066C05B9B1A86->id;    $R3A1E73211A105E82A8C89F8C8E3C8264->allow_employee_form_lang = Configuration::get('PS_BO_ALLOW_EMPLOYEE_FORM_LANG') ? Configuration::get('PS_BO_ALLOW_EMPLOYEE_FORM_LANG') : 0;    $R3A1E73211A105E82A8C89F8C8E3C8264->identifier = $this->identifier;    $R3A1E73211A105E82A8C89F8C8E3C8264->submit_action = 'submitSettings';    $R3A1E73211A105E82A8C89F8C8E3C8264->currentIndex = $this->context->link->getAdminLink('AdminModules', false).'&configure='.$this->name.'&tab_module='.$this->tab.'&module_name='.$this->name;    $R3A1E73211A105E82A8C89F8C8E3C8264->token = Tools::getAdminTokenLite('AdminModules');    $R3A1E73211A105E82A8C89F8C8E3C8264->tpl_vars = array(     'fields_value' => array(       'ak_order_reference' => Tools::getValue('ak_order_reference', array_key_exists('AK_ORDER_REFERENCE', $this->agile_configs) ? $this->agile_configs['AK_ORDER_REFERENCE'] : ''),       'ak_grc_site_key' => Tools::getValue('ak_grc_site_key', array_key_exists('AK_GRC_SITE_KEY', $this->agile_configs) ? $this->agile_configs['AK_GRC_SITE_KEY'] : ''),       'ak_grc_secret_key' => Tools::getValue('ak_grc_secret_key', array_key_exists('AK_GRC_SECRET_KEY', $this->agile_configs) ? $this->agile_configs['AK_GRC_SECRET_KEY'] : ''),       'ak_gmap_apikey' => Tools::getValue('ak_gmap_apikey', array_key_exists('AK_GMAP_APIKEY', $this->agile_configs) ? $this->agile_configs['AK_GMAP_APIKEY'] : ''),       ),      'languages' => $this->context->controller->getLanguages(),      'id_language' => $this->context->language->id      );      return $R3A1E73211A105E82A8C89F8C8E3C8264->generateForm(array($RD05A28496998D5D330106BBAE629B948));     }      public function hookDisplayTop($RC2D2567438B1F39DD71F78195B5F3DED)   {    return $this->display(__FILE__, 'views/templates/hook/agilemodal.tpl');       }      public function hookDisplayHeader($RC2D2567438B1F39DD71F78195B5F3DED)   {    if (Tools::getValue('action') == 'quickview') {     return;    }          $this->context->controller->registerJavascript('agile-common-js','/modules/agilekernel/js/common.js',['position' => 'bottom', 'priority' => 100]);    Media::addJsDef(array(     'PleaseWaitWhileProcessYourRequest' => $this->l('Please wait while your request is been processed.')     ,'return_code' => $this->l('Retun Code')     ,'is_agileprepaidcredit_installed' => (Module::isInstalled('agileprepaidcredit') ? true : false)    ));         if( (isset($this->context->controller->needGoogleMap) &&  $this->context->controller->needGoogleMap)     ||(Module::isInstalled('agilemultipleseller') && (in_array($this->context->controller->php_self, array('product'))))     ||(Module::isInstalled('agilepickupcenter') && (in_array($this->context->controller->php_self, array('order'))))    ){     $this->context->controller->registerJavascript('agile-googlemap-js','/modules/agilekernel/js/googlemaps.js',['position' => 'bottom', 'priority' => 100]);     $this->assignCommonGoogleMaps();    }        $RC16152C629E1F99B9B420553A46E263E = Configuration::get('AK_GRC_SITE_KEY');      if(!empty($RC16152C629E1F99B9B420553A46E263E))    {     if(in_array($this->context->controller->php_self, array('product','showcaseform')))     {      $this->context->smarty->assign(array(       'ak_grc_site_key' =>  $RC16152C629E1F99B9B420553A46E263E,       'ak_grc_language' => $this->context->language->iso_code      ));     }    }        if ($this->context->controller->php_self == 'product')    {     $this->context->controller->registerJavascript('ak-hookproduct-js','/modules/agilekernel/js/hookproduct.js',['position' => 'bottom', 'priority' => 100]);    }                                                                                                                                                   return $this->display(__FILE__, 'views/templates/hook/header.tpl');     }      private function assignCommonGoogleMaps()   {    $R11379CA68679C34EB1986763C0689FA6 = Configuration::get('AK_GMAP_APIKEY');    $this->context->smarty->assign(array(     'ak_gmap_apikey' =>  $R11379CA68679C34EB1986763C0689FA6     ));       }     public function hookDisplayBackOfficeHeader($RC2D2567438B1F39DD71F78195B5F3DED)   {    $this->context->controller->addJS(__PS_BASE_URI__ . '/modules/agilekernel/js/common.js');        if( (Module::isInstalled('agilemultipleseller') && in_array($this->context->controller->php_self, array('adminsellerinfos'))) ||     (Module::isInstalled('agilepickupcenter') && $this->context->controller->php_self = 'adminlocations')    ){     $this->context->controller->addJS(__PS_BASE_URI__ . '/modules/agilekernel/js/googlemaps.js');     $this->assignCommonGoogleMaps();    }       }     private function displayCommonGoogleMaps()   {       }     private function remove_parameters($RF138ED503DCB2A82584AF23E860E6F1D)   {    $R034AE2AB94F99CC81B389A1822DA3353 = array();    foreach($_GET as $RF413F06AEBBCEF5E1C8B1019DEE6FE6B => $R244F38266C59587D696AEC08A771B803)    {     if(!in_array($RF413F06AEBBCEF5E1C8B1019DEE6FE6B, $RF138ED503DCB2A82584AF23E860E6F1D))$R034AE2AB94F99CC81B389A1822DA3353[$RF413F06AEBBCEF5E1C8B1019DEE6FE6B] = $R244F38266C59587D696AEC08A771B803;    }    return $R034AE2AB94F99CC81B389A1822DA3353;       }     public function hookDisplayBackOfficeTop($RC2D2567438B1F39DD71F78195B5F3DED)   {    if(!$this->active)return '';        $RD8BB3C282D54ABD7C28006FF403D5EB4 = $this->incompatibelModules();    $R77719AEA1364F8DB6A98722DF14FD9FB = array();    if(empty($RD8BB3C282D54ABD7C28006FF403D5EB4))    {           $this->renameIncompatibleOldFile();        $R77719AEA1364F8DB6A98722DF14FD9FB = $this->incompatibleFiles();    }        $this->context->smarty->assign(array(     'incompatible_agilemodules' => $RD8BB3C282D54ABD7C28006FF403D5EB4,     'incompatible_agilefiles' => $R77719AEA1364F8DB6A98722DF14FD9FB     ));        return  $this->display(__FILE__, 'views/templates/hook/backofficetop.tpl')  . $this->display(__FILE__, 'views/templates/hook/agilemodal.tpl') ;     }       public function get_shared_override_files($RAEA8AD3A82E30759710E3B735C79E6B2)   {    $R34F9D9180A0638B53CFA6C9401EB8E73 = array();    if(empty($this->shared_override))return $R34F9D9180A0638B53CFA6C9401EB8E73;    foreach($this->shared_override as $R6741CE3B293EB8E2C4F8EE62BEC5335C => $R52E86422141EA678B3963142BB909A12)    {        if(!in_array($RAEA8AD3A82E30759710E3B735C79E6B2, $R52E86422141EA678B3963142BB909A12))continue;        if(!file_exists($this->get_shared_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C)))continue;     $R34F9D9180A0638B53CFA6C9401EB8E73[$R6741CE3B293EB8E2C4F8EE62BEC5335C] = $R52E86422141EA678B3963142BB909A12;    }    return $R34F9D9180A0638B53CFA6C9401EB8E73;     }     public function get_shared_override_path($R2A9EBFAA4DFF58C2C8EF9286E931381E)   {    return _PS_ROOT_DIR_ . DIRECTORY_SEPARATOR . "modules" .DIRECTORY_SEPARATOR . $this->name . DIRECTORY_SEPARATOR . "shared_override" . DIRECTORY_SEPARATOR . $R2A9EBFAA4DFF58C2C8EF9286E931381E;   }      public function get_override_path($R2A9EBFAA4DFF58C2C8EF9286E931381E)   {    return _PS_ROOT_DIR_ . DIRECTORY_SEPARATOR . "modules" .DIRECTORY_SEPARATOR . $this->name . DIRECTORY_SEPARATOR . "override" . DIRECTORY_SEPARATOR . $R2A9EBFAA4DFF58C2C8EF9286E931381E;   }         public function shared_override_needs_install($RA4430B74B9E4625519C34D096588A89E)   {    $R7EB391DA43D71A7347879AE377DEF100 = $this->get_shared_override_files($RA4430B74B9E4625519C34D096588A89E);    $R947631E46E023AABB1E24E8BEC91C452 = array();    foreach($R7EB391DA43D71A7347879AE377DEF100 as $R6741CE3B293EB8E2C4F8EE62BEC5335C => $R52E86422141EA678B3963142BB909A12)    {        if(file_exists($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C)))continue;        if(file_exists($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C) . ".merged"))continue;     $R947631E46E023AABB1E24E8BEC91C452[$R6741CE3B293EB8E2C4F8EE62BEC5335C] = $R52E86422141EA678B3963142BB909A12;    }    return $R947631E46E023AABB1E24E8BEC91C452;   }        public function can_install_shared_overrides($R586414274DA85A6AF38AF1E74E0DADB2)   {    $R0EB1982D9BAA9716AC37A8F047D5800D = array();    $R660277E8F6E85255FDA02AFCD73BA2AD = array();    if(empty($R586414274DA85A6AF38AF1E74E0DADB2))return $R0EB1982D9BAA9716AC37A8F047D5800D;    foreach($R586414274DA85A6AF38AF1E74E0DADB2 as $R6741CE3B293EB8E2C4F8EE62BEC5335C => $R52E86422141EA678B3963142BB909A12)    {        if(file_exists($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C)))continue;          $R1561E4412460AB6B1F613D8F8538EC4E = explode('/', $R6741CE3B293EB8E2C4F8EE62BEC5335C);     $RF5F11A8D38D2AF447803CE98A8C3E58E = count($R1561E4412460AB6B1F613D8F8538EC4E);     $R3D9A15F4B89CA8D0B5D6EC97AB1D0799 = _PS_ROOT_DIR_ . "/modules/agilekernel/override";     for($R5B92E56774920499F4ADDD0EC782C83E = 0; $R5B92E56774920499F4ADDD0EC782C83E < $RF5F11A8D38D2AF447803CE98A8C3E58E - 1; $R5B92E56774920499F4ADDD0EC782C83E++)     {      $R3D9A15F4B89CA8D0B5D6EC97AB1D0799 =  $R3D9A15F4B89CA8D0B5D6EC97AB1D0799 . "/" . $R1561E4412460AB6B1F613D8F8538EC4E[$R5B92E56774920499F4ADDD0EC782C83E];      if(!file_exists($R3D9A15F4B89CA8D0B5D6EC97AB1D0799))mkdir($R3D9A15F4B89CA8D0B5D6EC97AB1D0799);     }             copy($this->get_shared_override_path( $R6741CE3B293EB8E2C4F8EE62BEC5335C), $this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C));     $R660277E8F6E85255FDA02AFCD73BA2AD[] = $R6741CE3B293EB8E2C4F8EE62BEC5335C;     $R0EB1982D9BAA9716AC37A8F047D5800D = array_merge($R0EB1982D9BAA9716AC37A8F047D5800D, AgileInstaller::CanClassOverride($this->name, basename($R6741CE3B293EB8E2C4F8EE62BEC5335C, ".php")));    }      if(!empty($R0EB1982D9BAA9716AC37A8F047D5800D))    {     foreach($R660277E8F6E85255FDA02AFCD73BA2AD as $R6741CE3B293EB8E2C4F8EE62BEC5335C)     {          unlink($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C));     }    }    return $R0EB1982D9BAA9716AC37A8F047D5800D;   }         public function install_shared_override($R586414274DA85A6AF38AF1E74E0DADB2, $RAEA8AD3A82E30759710E3B735C79E6B2)   {    $R0EB1982D9BAA9716AC37A8F047D5800D = array();    foreach($R586414274DA85A6AF38AF1E74E0DADB2 as $R6741CE3B293EB8E2C4F8EE62BEC5335C => $R52E86422141EA678B3963142BB909A12)    {     if(!$this->addOverride(basename($R6741CE3B293EB8E2C4F8EE62BEC5335C, ".php")))     {          $R0EB1982D9BAA9716AC37A8F047D5800D[] = $this->l('override Class installation was not successfull:') . $R6741CE3B293EB8E2C4F8EE62BEC5335C;      if(file_exists($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C)))unlink($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C));     }    }    return $R0EB1982D9BAA9716AC37A8F047D5800D;   }          public function uninstall_shared_override($RAEA8AD3A82E30759710E3B735C79E6B2)   {    $R0EB1982D9BAA9716AC37A8F047D5800D = array();    $R7EB391DA43D71A7347879AE377DEF100 = $this->get_shared_override_files($RAEA8AD3A82E30759710E3B735C79E6B2);      foreach($R7EB391DA43D71A7347879AE377DEF100 as $R6741CE3B293EB8E2C4F8EE62BEC5335C => $R52E86422141EA678B3963142BB909A12)    {        if($this->any_other_modules_installed($R52E86422141EA678B3963142BB909A12, $RAEA8AD3A82E30759710E3B735C79E6B2))      continue;          if(!file_exists($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C)))      copy($this->get_shared_override_path( $R6741CE3B293EB8E2C4F8EE62BEC5335C), $this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C));       if($this->removeOverride(basename($R6741CE3B293EB8E2C4F8EE62BEC5335C, ".php")))     {      unlink($this->get_override_path($R6741CE3B293EB8E2C4F8EE62BEC5335C));     }     else     {      $R0EB1982D9BAA9716AC37A8F047D5800D[] = $this->l('override Class uninstall was not successfull.');     }    }    return $R0EB1982D9BAA9716AC37A8F047D5800D;     }      private function any_other_modules_installed($R4D1B20585F5E90178187AC0090AC2F2F, $RDD360D727CB85F2508A8B4EF64E8A859)   {    if(empty($R4D1B20585F5E90178187AC0090AC2F2F))return false;    foreach($R4D1B20585F5E90178187AC0090AC2F2F as $R01787CB5A57D47DC8A648998E4A6512C)    {     if($R01787CB5A57D47DC8A648998E4A6512C != $RDD360D727CB85F2508A8B4EF64E8A859 && Module::isInstalled($R01787CB5A57D47DC8A648998E4A6512C))return true;    }    return false;   }  }    