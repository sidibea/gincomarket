<?php
$GLOBALS["UxpaPbRXERSOLPwRbRqc"]=base64_decode("bWF4X3F0eQ==");$GLOBALS["ACGsNtjeBZmtyMLzUxvw"]=base64_decode("cHJvZHVjdF9pbWFnZXM=");$GLOBALS["UWIPgjxFofMMrcoIwgFn"]=base64_decode("bGFiZWw=");$GLOBALS["sEVWmFbTxTyXCAuzlzdI"]=base64_decode("cG9zaXRpb24=");$GLOBALS["jNdZYXZYORKIDQAPRez"]=base64_decode("bGFyZ2U=");$GLOBALS["uDgJlAibwoXhqqJQgUbe"]=base64_decode("ZnVsbF9pbWFnZV91cmw=");$GLOBALS["jRoLhsfsiAeUhJKrALNg"]=base64_decode("Y3VzdG9tQXR0cmlidXRlcw==");$GLOBALS["SHnrRXoyKsYjLJCAtvTD"]=base64_decode("LyQy");$GLOBALS["qQlZmYRcFEcqncSpSkos"]=base64_decode("JDE=");$GLOBALS["gTHHinCFCTiKVgVZKM"]=base64_decode("Lyg8aW1nW148Xj5dKz9zcmNccyo9XHMqKCJ8JykpKFteOl4iXiddK1wyKS9p");$GLOBALS["EbXIawqnHDbDPPpxXRp"]=base64_decode("ZGVzY3JpcHRpb24=");$GLOBALS["LOUEjIBkjaWopnwaFhHn"]=base64_decode("c2hvcnRfZGVzY3JpcHRpb24=");$GLOBALS["JlesIBlrQqglCVkqHhAO"]=base64_decode("cmVsYXRlVG8=");$GLOBALS["rwOdVnTfQGAaYrmsMgnw"]=base64_decode("aWRfZmVhdHVyZQ==");$GLOBALS["PLaaBmZzGHSDoJcNaAFV"]=base64_decode("YWxsb3dfb29zcA==");$GLOBALS["femmxRrxnjALYHwtucSS"]=base64_decode("Y3VzdG9taXphYmxl");$GLOBALS["BqyYELduncgqBkajIVvH"]=base64_decode("cHJvZHVjdHM=");$GLOBALS["FGiYrDjYFONMguneiijw"]=base64_decode("cmVsYXRlZFByb2R1Y3Rz");$GLOBALS["kxughgBEvduIYGUqLnnc"]=base64_decode("c2hvd19wcmljZQ==");$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]=base64_decode("aWRfcHJvZHVjdA==");$GLOBALS["aDsyYlYDxUfZXGWWmcEh"]=base64_decode("cmVjb21tZW5kZWRfaXRlbXM=");$GLOBALS["ImvOgQBUmWCuICDaSpFT"]=base64_decode("KQogICAgICAgICAgICBHUk9VUCBCWSBpZF9wcm9kdWN0X2F0dHJpYnV0ZQogICAgICAgICAgICBIQVZJTkcgQ09VTlQoKik9");$GLOBALS["bBMsoLampSUmOtmZBsPc"]=base64_decode("IEFORCAgaWRfYXR0cmlidXRlIGluKA==");$GLOBALS["IaGUeeXEeXHjmVOOPTTu"]=base64_decode("cHJvZHVjdF9hdHRyaWJ1dGVfY29tYmluYXRpb25gIHBhYyBPTiBwYWMuYGlkX3Byb2R1Y3RfYXR0cmlidXRlYCA9IHBhLmBpZF9wcm9kdWN0X2F0dHJpYnV0ZWAKCQkJV0hFUkUgcGEuYGlkX3Byb2R1Y3RgPSA=");$GLOBALS["HJaoHATcYKRjsXgrwQhg"]=base64_decode("cHJvZHVjdF9hdHRyaWJ1dGVgIHBhCgkgICAgICAgIExFRlQgSk9JTiBg");$GLOBALS["CPEonBsVnLszXGOuxVuG"]=base64_decode("CgkJCVNFTEVDVCBwYS5pZF9wcm9kdWN0X2F0dHJpYnV0ZQogICAgICAgICAgICBGUk9NIGA=");$GLOBALS["xEuNZucKDqLNdbfNfI"]=base64_decode("b3VyX3ByaWNl");$GLOBALS["SiRSACHoXsTIZeRmGmwq"]=base64_decode("aWQ=");$GLOBALS["LgMNIFzKHGZVHsEXfc"]=base64_decode("cGVyY2VudGFnZQ==");$GLOBALS["xlhZIDgKOCIUhPpCPieU"]=base64_decode("aWRfY3VycmVuY3k=");$GLOBALS["hQbAuitXBYoioWKymoVk"]=base64_decode("cmVkdWN0aW9uX3RheA==");$GLOBALS["khKHMEfpjltzcnpywNSQ"]=base64_decode("YW1vdW50");$GLOBALS["XcMtDkftDvJyzeXXs"]=base64_decode("cmVkdWN0aW9uX3R5cGU=");$GLOBALS["kAVweimVWpDAwqtahOLu"]=base64_decode("cmVkdWN0aW9u");$GLOBALS["XFwXsAvKoUwvZModoiL"]=base64_decode("UFNfVEFYX0FERFJFU1NfVFlQRQ==");$GLOBALS["MSKgDnjqGggSrEvmtZQO"]=base64_decode("Y29tYmluYXRpb25z");$GLOBALS["jtQELVpcAjeMCcOqGrNl"]=base64_decode("cHJvZHVjdF9zdXBlcl9hdHRyaWJ1dGVz");$GLOBALS["oxLfgZjvEiOVbIhPCAEl"]=base64_decode("Z3JvdXBfaWQ=");$GLOBALS["aeTwKLfnxTGSegzYixzK"]=base64_decode("Y29sb3JfdmFsdWU=");$GLOBALS["wKBdEguMoAWWAnUKUSiN"]=base64_decode("cHJpY2luZw==");$GLOBALS["xdqLbjMkqNwAldSnYJvs"]=base64_decode("bGlzdA==");$GLOBALS["lRBzvzBSEQkJxdBItbg"]=base64_decode("LA==");$GLOBALS["iHVJabfYRGUXeOTMWlVU"]=base64_decode("Jyw=");$GLOBALS["sMqVCSjiuIyeEqweGUNR"]=base64_decode("Jw==");$GLOBALS["MHkHPxkiwgIThazfNCos"]=base64_decode("UFNfRElTUF9VTkFWQUlMQUJMRV9BVFRS");$GLOBALS["auNFNyZahVhAydLSwPNo"]=base64_decode("aWRfaW1hZ2Vfb25seQ==");$GLOBALS["ELkdWnXntlzZoMeKYinU"]=base64_decode("LQ==");$GLOBALS["scxqtfZjbaqArJFFvkZn"]=base64_decode("UFNfTEVHQUNZX0lNQUdFUw==");$GLOBALS["tkyeEKnOmGAnvcpautXx"]=base64_decode("bWFpbkltYWdl");$GLOBALS["hgRCVvwZSglzbxTrjDLP"]=base64_decode("aW1hZ2Vz");$GLOBALS["exwrKWeUzzEdBFLM"]=base64_decode("Y292ZXI=");$GLOBALS["uumiERFdHiBWTuFFNysQ"]=base64_decode("aWRfaW1hZ2U=");$GLOBALS["iCuNEzvtLntfhNUrtHlh"]=base64_decode("ZGF0ZV9mb3JtYXR0ZWQ=");$GLOBALS["AWSYaZPGxnmiKvVeIixx"]=base64_decode("MDAwMC0wMC0wMA==");$GLOBALS["FzVPNaRGvKtzSwrHBnkW"]=base64_decode("YXZhaWxhYmxlX2RhdGU=");$GLOBALS["GtOgKXexOHjqDLTWvQjV"]=base64_decode("bWluaW1hbF9xdWFudGl0eQ==");$GLOBALS["vgqeCYonmyNlLLJRJJKG"]=base64_decode("dW5pdF9wcmljZV9pbXBhY3Q=");$GLOBALS["CfIMBdFmUdrPQDvtgiAT"]=base64_decode("dW5pdF9pbXBhY3Q=");$GLOBALS["MLnOQfrCfPnFLwGWbxSz"]=base64_decode("cmVmZXJlbmNl");$GLOBALS["NhvdBMNFmbqxHRHb"]=base64_decode("d2VpZ2h0");$GLOBALS["ftRrdSQkCeFIwJJyABSS"]=base64_decode("ZWNvdGF4");$GLOBALS["bVRMRbGBDrrkiLSpulGW"]=base64_decode("c3BlY2lmaWNfcHJpY2U=");$GLOBALS["UAkfTDtQAocYzXZkOs"]=base64_decode("YXR0cmlidXRlc192YWx1ZXM=");$GLOBALS["ahSttejFzcuTRHYoOtXb"]=base64_decode("aWRfcHJvZHVjdF9hdHRyaWJ1dGU=");$GLOBALS["AspkDaNRjroFoIBFRvsj"]=base64_decode("ZGVmYXVsdF9vbg==");$GLOBALS["EcaVCaBpiURiLvayrnmh"]=base64_decode("YXR0cmlidXRlcw==");$GLOBALS["qPLtmziwLzIqenwZEpjf"]=base64_decode("ZGVmYXVsdA==");$GLOBALS["VRIPfjCUkfOcgmCJZpqC"]=base64_decode("Z3JvdXBfdHlwZQ==");$GLOBALS["xxBuXWulADtuGekLQbtA"]=base64_decode("cHVibGljX2dyb3VwX25hbWU=");$GLOBALS["eAoyLBrzMbviajqKrxHw"]=base64_decode("Z3JvdXBfbmFtZQ==");$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]=base64_decode("aWRfYXR0cmlidXRlX2dyb3Vw");$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]=base64_decode("cXVhbnRpdHk=");$GLOBALS["IrgAciSmwmtEQygfJLwU"]=base64_decode("YXR0cmlidXRlc19xdWFudGl0eQ==");$GLOBALS["StKbRlqoXfkWlFCisYlb"]=base64_decode("YXR0cmlidXRlX25hbWU=");$GLOBALS["kKdvCNdcMUzVsHqmcGpZ"]=base64_decode("LmpwZw==");$GLOBALS["wARnGvisqORwKuUlRbs"]=base64_decode("aWRfYXR0cmlidXRl");$GLOBALS["lcXZkFwmbVyLokzYIURZ"]=base64_decode("YXR0cmlidXRlX2NvbG9y");$GLOBALS["PGfoTUYdWSAYjIzyqg"]=base64_decode("aXNfY29sb3JfZ3JvdXA=");$GLOBALS["uDOcEudZlpcWciBoWYWI"]=base64_decode("JQ==");$GLOBALS["iKEQRFcfxIqznxtlsAQh"]=base64_decode("ZGlzY291bnQ=");$GLOBALS["FtaoUjQYZIwYCvcntNjy"]=base64_decode("c3BlY2lhbF9wcmljZQ==");$GLOBALS["oCxcQCBoFCYYTfCGlOHo"]=base64_decode("ZGlzcGxheV9wcmljZXM=");$GLOBALS["KrMMSTZfUhumfdxswHdZ"]=base64_decode("bGluZS10aHJvdWdo");$GLOBALS["tugkmwKQmrdyfghQnRJj"]=base64_decode("");$GLOBALS["usUuBrWKCIGqoqkxOFOk"]=base64_decode("bm9ybWFs");$GLOBALS["wKdyFSPwxxOROeoPCzre"]=base64_decode("c3R5bGU=");$GLOBALS["VYnTedwkWoFZehazspro"]=base64_decode("UHJpY2U=");$GLOBALS["MxXNtfJODZVrPpXNepHI"]=base64_decode("dGllcl9wcmljZXM=");$GLOBALS["IXCfKzsjlitrRiMXFvE"]=base64_decode("cHJpY2U=");$GLOBALS["NLslBGGtkJJgsrnJizxo"]=base64_decode("YmFzZV9wcmljZQ==");$GLOBALS["asxETQgoYgCVOHXhnboY"]=base64_decode("Y3VycmVuY3k=");$GLOBALS["fsDzMvYqKPbdYAAzsAhH"]=base64_decode("cHJvZHVjdF9hdHRyaWJ1dGVgCiAgICAgICAgICAgIFdIRVJFIGBpZF9wcm9kdWN0YCA9IA==");$GLOBALS["RfHUBPxVOxQtCtfmyHVx"]=base64_decode("CiAgICAgICAgICAgIFNFTEVDVCBDT1VOVChgaWRfcHJvZHVjdF9hdHRyaWJ1dGVgKQogICAgICAgICAgICBGUk9NIGA=");$GLOBALS["AyLWttwxGSkBzANPLdWr"]=base64_decode("UFNfQ0FUQUxPR19NT0RF");$GLOBALS["aaVSngfyKHLQgxZvwrY"]=base64_decode("MA==");$GLOBALS["KELWTCpcJHrlqxpkgpdY"]=base64_decode("c3VtbWFyeQ==");$GLOBALS["qcAqdRoXyOjMSzAvwpOV"]=base64_decode("b3B0aW9ucw==");$GLOBALS["VMehMeMJdDAFLKwcfKgB"]=base64_decode("NQ==");$GLOBALS["MOtTUmnXwRzNNWKdkc"]=base64_decode("NA==");$GLOBALS["UBoJZzOhUSaSNWJuQNdo"]=base64_decode("Mw==");$GLOBALS["djUHgAUBPKdarJcYpGng"]=base64_decode("Mg==");$GLOBALS["DmRRJuGUrFhCTDoFeuzy"]=base64_decode("cmF0aW5nX2lk");$GLOBALS["TNjUIwvUCKYoazJgtXiI"]=base64_decode("dmFsdWU=");$GLOBALS["fcoPzIuYMjbtOJqsdHcU"]=base64_decode("Y29kZQ==");$GLOBALS["MyGfQYdQGWFabnAhbjGR"]=base64_decode("b3B0aW9uX2lk");$GLOBALS["WCYFjJFyVRKRZDgiSJwH"]=base64_decode("cmF0aW5nX2NvZGU=");$GLOBALS["iKLyShFQlpjmJpFfaoec"]=base64_decode("IA==");$GLOBALS["SHlRCNLzGtCGyHhhetLl"]=base64_decode("MQ==");$GLOBALS["FIlrKFopiwhbBPpgSvjL"]=base64_decode("IEFORCAgYGFjdGl2ZWA9");$GLOBALS["faaWMhpzuyfPdqrAcZpd"]=base64_decode("cHJvZHVjdF9jb21tZW50X2NyaXRlcmlvbl9sYW5nYCBwY2NsIE9OIHBjY2wuYGlkX3Byb2R1Y3RfY29tbWVudF9jcml0ZXJpb25gID0gcGNjLmBpZF9wcm9kdWN0X2NvbW1lbnRfY3JpdGVyaW9uYAogICAgICAgICAgICBXSEVSRSBgaWRfbGFuZ2A9IA==");$GLOBALS["ucCmFymSGfFRtqPQUfWf"]=base64_decode("cHJvZHVjdF9jb21tZW50X2NyaXRlcmlvbmAgcGNjCiAgICAgICAgICAgIExFRlQgSk9JTiBg");$GLOBALS["DIhXAGKELwGOEuiXaodK"]=base64_decode("U0VMRUNUICoKICAgICAgICAgICAgRlJPTSBg");$GLOBALS["bVYGmvjqAbSUaNFnjGnq"]=base64_decode("aWRfcHJvZHVjdF9jb21tZW50X2NyaXRlcmlvbg==");$GLOBALS["iIOFUMrwXnyUpFNxRMjx"]=base64_decode("ZGF0ZV9hZGQ=");$GLOBALS["SUilqvzYBUFvqWDgqspY"]=base64_decode("Y3JlYXRlZF9hdA==");$GLOBALS["xjYOkrnNiShqzGuGOkKM"]=base64_decode("Y29udGVudA==");$GLOBALS["yDRHjxSUlPDFRNWNVRSO"]=base64_decode("ZGV0YWls");$GLOBALS["FKJJSrcKfNlcouSwAAmL"]=base64_decode("dGl0bGU=");$GLOBALS["kYwSnSoyCTdklkjPsqrR"]=base64_decode("Z3JhZGU=");$GLOBALS["CtlDmYhXLbkuLTtgzqk"]=base64_decode("Y3VzdG9tZXJfbmFtZQ==");$GLOBALS["zwVryddKWLySgZEhdbmN"]=base64_decode("bmlja25hbWU=");$GLOBALS["aUlUxAtdpAuHfRiNHQgH"]=base64_decode("YXZn");$GLOBALS["SsfIgQTisYCpWBxQcAmj"]=base64_decode("cHJvZHVjdGNvbW1lbnRzL1Byb2R1Y3RDb21tZW50Q3JpdGVyaW9uLnBocA==");$GLOBALS["wWfCEvcDqABdOKerHwEM"]=base64_decode("cHJvZHVjdGNvbW1lbnRzL1Byb2R1Y3RDb21tZW50LnBocA==");$GLOBALS["cZtxhxPPwByKVPfZvmff"]=base64_decode("cHJvZHVjdGNvbW1lbnRz");$GLOBALS["TOeAMkZYbiIeTLssrRUI"]=base64_decode("Y291bnQ=");$GLOBALS["jzTjktRqpozAuxsUrvBB"]=base64_decode("YXZlcmFnZVJhdGluZw==");$GLOBALS["idumNZtnyCdKUNpoNPo"]=base64_decode("cmF0aW5nT3B0aW9ucw==");$GLOBALS["vmiWVpDbDUOCTXwaVlBe"]=base64_decode("cmV2aWV3cw==");$GLOBALS["rxVRfDIGAUAOANLeBlcD"]=base64_decode("cmV2aWV3X3N1bW1hcnk=");$GLOBALS["nhWAuBNMUlltysutj"]=base64_decode("YXZhaWxhYmxlX2Zvcl9vcmRlcg==");$GLOBALS["mtniJtSfBUifnYAdTgNC"]=base64_decode("c3RvY2tfc3RhdHVz");$GLOBALS["npjYrUmxXsOjHVoIGfVv"]=base64_decode("cHJvZHVjdF9pbWFnZV91cmw=");$GLOBALS["YdhzFFiTsHZheiDjPLQW"]=base64_decode("cHJvZHVjdF90aHVtYm5haWxfdXJs");$GLOBALS["GnUlPBVDMuSlzQZLdzIr"]=base64_decode("aG9tZQ==");$GLOBALS["QtXGAQQggTtyJvIWmFWm"]=base64_decode("cHJvZHVjdF9zbWFsbF9pbWFnZV91cmw=");$GLOBALS["LNJcPXllxExzrmvPuZCw"]=base64_decode("ZW50aXR5X2lk");$GLOBALS["zLKQzQJILPsuisaucUmb"]=base64_decode("YXR0cmlidXRlU2V0TmFtZQ==");$GLOBALS["cObngTcExoZkYbJVKQUk"]=base64_decode("dHlwZV9pZA==");$GLOBALS["dJLWnUZqJJMnpFGrjgZA"]=base64_decode("c2ltcGxl");$GLOBALS["kqpjokinrNKzMlmecrBs"]=base64_decode("dHlwZQ==");$GLOBALS["TOKCYBEaPbdBQKiAAEYr"]=base64_decode("dXJs");$GLOBALS["BoWuBfavKqJxeLgCuLA"]=base64_decode("bmFtZQ==");$GLOBALS["ksmBVCTZnuQUbdBtBigo"]=base64_decode("cHJvZHVjdF9pZA==");$GLOBALS["SnsSSwMKZSYeMFnEirnh"]=base64_decode("");$GLOBALS["AohdBTLKLxDXDJvzKOAN"]=base64_decode("ZGVzY3JpcHRpb24=");$GLOBALS["eZrKzfUgBxsaIAHVNXws"]=base64_decode("MA==");
?><?php


class ProductTranslatorService extends BaseService
{
    private $product;
    private $item = array();
    private $isArray = true;
    private $tax;

    public function __construct()
    {
        parent::__construct();
        $this->tax = (!$this->priceDisplay || $this->priceDisplay == 2);
    }

    public function getTranslatedItem()
    {
        return $this->item;
    }

    public function getItemBaseInfo()
    {
        $this->item[$GLOBALS["ksmBVCTZnuQUbdBtBigo"]] = (string)$this->id_product;
        $this->item[$GLOBALS["BoWuBfavKqJxeLgCuLA"]] = $this->isArray ? $this->product[$GLOBALS["BoWuBfavKqJxeLgCuLA"]] : $this->product->name;
        $this->item[$GLOBALS["TOKCYBEaPbdBQKiAAEYr"]] = $this->link->getProductLink($this->id_product);
        $this->item[$GLOBALS["kqpjokinrNKzMlmecrBs"]] = $GLOBALS["dJLWnUZqJJMnpFGrjgZA"];
        $this->item[$GLOBALS["cObngTcExoZkYbJVKQUk"]] = $GLOBALS["dJLWnUZqJJMnpFGrjgZA"];
        $this->item[$GLOBALS["zLKQzQJILPsuisaucUmb"]] = NULL;
        $this->item[$GLOBALS["LNJcPXllxExzrmvPuZCw"]] = $this->id_product;
        $this->item[$GLOBALS["QtXGAQQggTtyJvIWmFWm"]] = $this->getProductImage($this->link_rewrite, $this->id_image, $GLOBALS["GnUlPBVDMuSlzQZLdzIr"]);
        $this->item[$GLOBALS["YdhzFFiTsHZheiDjPLQW"]] = $this->getProductImage($this->link_rewrite, $this->id_image, $GLOBALS["GnUlPBVDMuSlzQZLdzIr"]);
        $this->item[$GLOBALS["npjYrUmxXsOjHVoIGfVv"]] = $this->getProductImage($this->link_rewrite, $this->id_image, $GLOBALS["GnUlPBVDMuSlzQZLdzIr"]);        
        $this->item[$GLOBALS["mtniJtSfBUifnYAdTgNC"]] = $this->allowAddToCart() ? true : false;
        $this->item[$GLOBALS["nhWAuBNMUlltysutj"]] = $this->product->available_for_order;
        $this->item[$GLOBALS["rxVRfDIGAUAOANLeBlcD"]] = $this->getReviewSummary($this->id_product);
        $this->item[$GLOBALS["vmiWVpDbDUOCTXwaVlBe"]] = $this->getProductReviews($this->id_product, 1, 3);
        $this->item[$GLOBALS["idumNZtnyCdKUNpoNPo"]] = $this->getRatingOptions($this->id_product);
        addImageRatio($this->item);
                
        
        return $this->item;
    }

    
    public function getReviewSummary($productId)
    {
        $review_array = array(
            'averageRating' => 0,
            'count' => 0
            );

        if(Module::isInstalled($GLOBALS["cZtxhxPPwByKVPfZvmff"]))
        {
            include_once _PS_MODULE_DIR_.$GLOBALS["wWfCEvcDqABdOKerHwEM"];
            include_once _PS_MODULE_DIR_.$GLOBALS["SsfIgQTisYCpWBxQcAmj"];            

            $averages = ProductComment::getRatings((int)$productId);
            $averageTotal = 0;
            if(!empty($averages))
            {
                $averageTotal = $averages[$GLOBALS["aUlUxAtdpAuHfRiNHQgH"]];
            }

            $comments = ProductComment::getByProduct((int)$productId, $p, 5000);

            $review_array[$GLOBALS["jzTjktRqpozAuxsUrvBB"]] = $averageTotal ? round($averageTotal, 2) : 0;
            $review_array[$GLOBALS["TOeAMkZYbiIeTLssrRUI"]] = count($comments);
        }
        return $review_array;
    }

    public function getProductReviews($productId, $p=1, $n=3)
    {
        $review_array = array();
        if(Module::isInstalled('productcomments'))
        {
            include_once _PS_MODULE_DIR_.$GLOBALS["wWfCEvcDqABdOKerHwEM"];
            include_once _PS_MODULE_DIR_.$GLOBALS["SsfIgQTisYCpWBxQcAmj"];
            
            $comments = ProductComment::getByProduct((int)$productId, $p, $n);
            $_reviews = array();
            foreach ($comments as $key => $comment) {
                $_reviews[] = array(
                    'product_id'    => $productId,
                    'nickname'      => $comment['customer_name'],
                    'averageRating' => $comment['grade'],
                    'title'         => $comment['title'],
                    'detail'        => $comment['content'],
                    'created_at'    => $comment['date_add']
                );
            }
            $review_array = $_reviews;
        }
        return $review_array;
    }

    
    public static function getRatingOptions($id_product)
    {
        $ratingData = array();
        if(Module::isInstalled('productcomments'))
        {
            include_once _PS_MODULE_DIR_.$GLOBALS["wWfCEvcDqABdOKerHwEM"];
            include_once _PS_MODULE_DIR_.$GLOBALS["SsfIgQTisYCpWBxQcAmj"];
            
            $id_lang = (int) context::getContext()->cookie->id_lang;            
            $grades = ProductComment::getGradeByProduct((int) $id_product, $id_lang);

            $_grades = array();
            foreach ($grades as $key => $grade) {
                $comment_criterion_id = $grade[$GLOBALS["bVYGmvjqAbSUaNFnjGnq"]];
                $_grades[$comment_criterion_id][] = $grade[$GLOBALS["kYwSnSoyCTdklkjPsqrR"]];
            }        
            $comment_criterions = Db::getInstance()->executeS($GLOBALS["DIhXAGKELwGOEuiXaodK"]._DB_PREFIX_.$GLOBALS["ucCmFymSGfFRtqPQUfWf"] . _DB_PREFIX_ . $GLOBALS["faaWMhpzuyfPdqrAcZpd"] . $id_lang . $GLOBALS["FIlrKFopiwhbBPpgSvjL"].$GLOBALS["SHlRCNLzGtCGyHhhetLl"].$GLOBALS["iKLyShFQlpjmJpFfaoec"]);
            
            foreach ($comment_criterions as $key => $comment_criterion) {
                $comment_criterion_id = $comment_criterion[$GLOBALS["bVYGmvjqAbSUaNFnjGnq"]];
                if(!isset($_grades[$comment_criterion_id])){
                                    }
                $ratingData[$key][$GLOBALS["WCYFjJFyVRKRZDgiSJwH"]] = $comment_criterion[$GLOBALS["BoWuBfavKqJxeLgCuLA"]];
                $id_product_comment_criterion = $comment_criterion[$GLOBALS["bVYGmvjqAbSUaNFnjGnq"]];
                $options = array(
                    '1' => array('option_id' => 1,'code' => 1,'value' => 1, 'rating_id' => $id_product_comment_criterion,),
                    $GLOBALS["djUHgAUBPKdarJcYpGng"] => array('option_id' => 2,'code' => 2,'value' => 2, 'rating_id' => $id_product_comment_criterion,),
                    $GLOBALS["UBoJZzOhUSaSNWJuQNdo"] => array('option_id' => 3,'code' => 3,'value' => 3, 'rating_id' => $id_product_comment_criterion,),
                    $GLOBALS["MOtTUmnXwRzNNWKdkc"] => array('option_id' => 4,'code' => 4,'value' => 4, 'rating_id' => $id_product_comment_criterion,),
                    $GLOBALS["VMehMeMJdDAFLKwcfKgB"] => array('option_id' => 5,'code' => 5,'value' => 5, 'rating_id' => $id_product_comment_criterion,),
                );
                $ratingData[$key][$GLOBALS["qcAqdRoXyOjMSzAvwpOV"]] = $options;
                $ratingData[$key][$GLOBALS["DmRRJuGUrFhCTDoFeuzy"]] = $id_product_comment_criterion;
                
                if(isset($_grades[$comment_criterion_id])){
                    $count = count($_grades[$comment_criterion_id]);
                    $sum = array_sum($_grades[$comment_criterion_id]);
                    $ratingData[$key][$GLOBALS["KELWTCpcJHrlqxpkgpdY"]] = $sum/$count*10;
                }else{
                    $ratingData[$key][$GLOBALS["KELWTCpcJHrlqxpkgpdY"]] = $GLOBALS["aaVSngfyKHLQgxZvwrY"];
                }
                
            }
        }

        return $ratingData;
    }

    private function allowAddToCart()
    {
        return (!isset($this->available_for_order) || $this->available_for_order) &&
                $this->customizable != 2 &&
                !Configuration::get($GLOBALS["AyLWttwxGSkBzANPLdWr"]) &&
                ($this->allow_oosp || $this->quantity > 0);
    }

    
    public function hasAttributes()
    {
        $count = (int) Db::getInstance(_PS_USE_SQL_SLAVE_)->getValue($GLOBALS["RfHUBPxVOxQtCtfmyHVx"] . _DB_PREFIX_ . $GLOBALS["fsDzMvYqKPbdYAAzsAhH"] . (int) ($this->id_product));

        return $count > 0;
    }

    
    public function getItemPrices()
    {
        $prices = array();
        $productPriceWithoutRedution = Product::getPriceStatic($this->id_product, $this->tax, null, $this->context->cookie->decimals, NULL, false, false, 1);
        $finalPrice = Product::getPriceStatic($this->id_product, $this->tax, NULL, $this->context->cookie->decimals, NULL, false, true, 1);

        $prices[$GLOBALS["asxETQgoYgCVOHXhnboY"]] = $this->context->cookie->currency;
        $prices[$GLOBALS["NLslBGGtkJJgsrnJizxo"]] = array('price' => $finalPrice);         $prices[$GLOBALS["MxXNtfJODZVrPpXNepHI"]] = array();            $displayPrices = array();
        $displayPrices[] = array(            'title' => 'Price',
            'price' => Tools::ps_round($finalPrice, $this->context->cookie->decimals),
            $GLOBALS["wKdyFSPwxxOROeoPCzre"] => $GLOBALS["usUuBrWKCIGqoqkxOFOk"]
        );

        if ($productPriceWithoutRedution > $finalPrice) {
            $displayPrices[] = array(
                'title' => '',
                'price' => Tools::ps_round($productPriceWithoutRedution, $this->context->cookie->decimals),
                $GLOBALS["wKdyFSPwxxOROeoPCzre"] => $GLOBALS["KrMMSTZfUhumfdxswHdZ"]
            );
                    }

        $prices[$GLOBALS["oCxcQCBoFCYYTfCGlOHo"]] = $displayPrices;
                
        $price = $finalPrice;
        $this->item[$GLOBALS["IXCfKzsjlitrRiMXFvE"]] = $productPriceWithoutRedution;
        $this->item[$GLOBALS["FtaoUjQYZIwYCvcntNjy"]] = $price;
		if($this->item[$GLOBALS["IXCfKzsjlitrRiMXFvE"]] != $this->item[$GLOBALS["FtaoUjQYZIwYCvcntNjy"]]){
			$this->item[$GLOBALS["iKEQRFcfxIqznxtlsAQh"]] = round(100 - ($finalPrice * 100) / $productPriceWithoutRedution).$GLOBALS["uDOcEudZlpcWciBoWYWI"];
            		}else{
			$this->item[$GLOBALS["iKEQRFcfxIqznxtlsAQh"]] = 0;
		}
        
        return $price;
    }

    
    protected function assignAttributesGroups()
    {
        $this->context = Context::getContext();
        $colors = array();
        $groups = array();

                $attributes_groups = $this->product->getAttributesGroups($this->context->language->id);
                if (is_array($attributes_groups) && $attributes_groups)
        {

            $combination_images = $this->product->getCombinationImages($this->context->language->id);
            $combination_prices_set = array();
            foreach ($attributes_groups as $k => $row)
            {
                                if (isset($row[$GLOBALS["PGfoTUYdWSAYjIzyqg"]]) && $row[$GLOBALS["PGfoTUYdWSAYjIzyqg"]] && (isset($row[$GLOBALS["lcXZkFwmbVyLokzYIURZ"]]) && $row[$GLOBALS["lcXZkFwmbVyLokzYIURZ"]]) || (file_exists(_PS_COL_IMG_DIR_.$row[$GLOBALS["wARnGvisqORwKuUlRbs"]].$GLOBALS["kKdvCNdcMUzVsHqmcGpZ"])))
                {
                    $colors[$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]][$GLOBALS["TNjUIwvUCKYoazJgtXiI"]] = $row[$GLOBALS["lcXZkFwmbVyLokzYIURZ"]];
                    $colors[$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]][$GLOBALS["BoWuBfavKqJxeLgCuLA"]] = $row[$GLOBALS["StKbRlqoXfkWlFCisYlb"]];
                    if (!isset($colors[$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]][$GLOBALS["IrgAciSmwmtEQygfJLwU"]]))
                        $colors[$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]][$GLOBALS["IrgAciSmwmtEQygfJLwU"]] = 0;
                    $colors[$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]][$GLOBALS["IrgAciSmwmtEQygfJLwU"]] += (int)$row[$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]];
                }
                if (!isset($groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]]))
                    $groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]] = array(
                        'group_name' => $row['group_name'],
                        'name' => $row['public_group_name'],
                        'group_type' => $row['group_type'],
                        'default' => -1,
                    );

                $groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]][$GLOBALS["EcaVCaBpiURiLvayrnmh"]][$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]] = $row[$GLOBALS["StKbRlqoXfkWlFCisYlb"]];
                if ($row[$GLOBALS["AspkDaNRjroFoIBFRvsj"]] && $groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]][$GLOBALS["qPLtmziwLzIqenwZEpjf"]] == -1)
                    $groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]][$GLOBALS["qPLtmziwLzIqenwZEpjf"]] = (int)$row[$GLOBALS["wARnGvisqORwKuUlRbs"]];
                if (!isset($groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]][$GLOBALS["IrgAciSmwmtEQygfJLwU"]][$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]]))
                    $groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]][$GLOBALS["IrgAciSmwmtEQygfJLwU"]][$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]] = 0;
                $groups[$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]][$GLOBALS["IrgAciSmwmtEQygfJLwU"]][$row[$GLOBALS["wARnGvisqORwKuUlRbs"]]] += (int)$row[$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]];

                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["UAkfTDtQAocYzXZkOs"]][$row[$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]]] = $row[$GLOBALS["StKbRlqoXfkWlFCisYlb"]];
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["EcaVCaBpiURiLvayrnmh"]][] = (int)$row[$GLOBALS["wARnGvisqORwKuUlRbs"]];
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["IXCfKzsjlitrRiMXFvE"]] = (float)$row[$GLOBALS["IXCfKzsjlitrRiMXFvE"]];

                                if (!isset($combination_prices_set[(int)$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]]))
                {
                    Product::getPriceStatic((int)$this->product->id, false, $row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]], 6, null, false, true, 1, false, null, null, null, $combination_specific_price);
                    $combination_prices_set[(int)$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]] = true;
                    $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["bVRMRbGBDrrkiLSpulGW"]] = $combination_specific_price;
                }
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["ftRrdSQkCeFIwJJyABSS"]] = (float)$row[$GLOBALS["ftRrdSQkCeFIwJJyABSS"]];
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["NhvdBMNFmbqxHRHb"]] = (float)$row[$GLOBALS["NhvdBMNFmbqxHRHb"]];
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]] = (int)$row[$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]];
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["MLnOQfrCfPnFLwGWbxSz"]] = $row[$GLOBALS["MLnOQfrCfPnFLwGWbxSz"]];
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["CfIMBdFmUdrPQDvtgiAT"]] = $row[$GLOBALS["vgqeCYonmyNlLLJRJJKG"]];
                $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["GtOgKXexOHjqDLTWvQjV"]] = $row[$GLOBALS["GtOgKXexOHjqDLTWvQjV"]];
                if ($row[$GLOBALS["FzVPNaRGvKtzSwrHBnkW"]] != $GLOBALS["AWSYaZPGxnmiKvVeIixx"] && Validate::isDate($row[$GLOBALS["FzVPNaRGvKtzSwrHBnkW"]]))
                {
                    $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["FzVPNaRGvKtzSwrHBnkW"]] = $row[$GLOBALS["FzVPNaRGvKtzSwrHBnkW"]];
                    $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["iCuNEzvtLntfhNUrtHlh"]] = Tools::displayDate($row[$GLOBALS["FzVPNaRGvKtzSwrHBnkW"]]);
                }
                else
                    $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["FzVPNaRGvKtzSwrHBnkW"]] = $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["iCuNEzvtLntfhNUrtHlh"]] = $GLOBALS["tugkmwKQmrdyfghQnRJj"];

                if (!isset($combination_images[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][0][$GLOBALS["uumiERFdHiBWTuFFNysQ"]]))
                    $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["uumiERFdHiBWTuFFNysQ"]] = -1;
                else
                {
                    $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["uumiERFdHiBWTuFFNysQ"]] = $id_image = (int)$combination_images[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][0][$GLOBALS["uumiERFdHiBWTuFFNysQ"]];
                    if ($row[$GLOBALS["AspkDaNRjroFoIBFRvsj"]])
                    {
                        if (isset($this->context->smarty->tpl_vars[$GLOBALS["exwrKWeUzzEdBFLM"]]->value))
                            $current_cover = $this->context->smarty->tpl_vars[$GLOBALS["exwrKWeUzzEdBFLM"]]->value;

                        if (is_array($combination_images[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]]))
                        {
                            foreach ($combination_images[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]] as $tmp)
                                if ($tmp[$GLOBALS["uumiERFdHiBWTuFFNysQ"]] == $current_cover[$GLOBALS["uumiERFdHiBWTuFFNysQ"]])
                                {
                                    $combinations[$row[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]][$GLOBALS["uumiERFdHiBWTuFFNysQ"]] = $id_image = (int)$tmp[$GLOBALS["uumiERFdHiBWTuFFNysQ"]];
                                    break;
                                }
                        }

                        if ($id_image > 0)
                        {
                            if (isset($this->context->smarty->tpl_vars[$GLOBALS["hgRCVvwZSglzbxTrjDLP"]]->value))
                                $product_images = $this->context->smarty->tpl_vars[$GLOBALS["hgRCVvwZSglzbxTrjDLP"]]->value;
                            if (isset($product_images) && is_array($product_images) && isset($product_images[$id_image]))
                            {
                                $product_images[$id_image][$GLOBALS["exwrKWeUzzEdBFLM"]] = 1;
                                $this->context->smarty->assign($GLOBALS["tkyeEKnOmGAnvcpautXx"], $product_images[$id_image]);
                                if (count($product_images))
                                    $this->context->smarty->assign($GLOBALS["hgRCVvwZSglzbxTrjDLP"], $product_images);
                            }
                            if (isset($this->context->smarty->tpl_vars[$GLOBALS["exwrKWeUzzEdBFLM"]]->value))
                                $cover = $this->context->smarty->tpl_vars[$GLOBALS["exwrKWeUzzEdBFLM"]]->value;
                            if (isset($cover) && is_array($cover) && isset($product_images) && is_array($product_images))
                            {
                                $product_images[$cover[$GLOBALS["uumiERFdHiBWTuFFNysQ"]]][$GLOBALS["exwrKWeUzzEdBFLM"]] = 0;
                                if (isset($product_images[$id_image]))
                                    $cover = $product_images[$id_image];
                                $cover[$GLOBALS["uumiERFdHiBWTuFFNysQ"]] = (Configuration::get($GLOBALS["scxqtfZjbaqArJFFvkZn"]) ? ($this->product->id.$GLOBALS["ELkdWnXntlzZoMeKYinU"].$id_image) : (int)$id_image);
                                $cover[$GLOBALS["auNFNyZahVhAydLSwPNo"]] = (int)$id_image;
                                $this->context->smarty->assign($GLOBALS["exwrKWeUzzEdBFLM"], $cover);
                            }
                        }
                    }
                }
            }

                        if (!Product::isAvailableWhenOutOfStock($this->product->out_of_stock) && Configuration::get($GLOBALS["MHkHPxkiwgIThazfNCos"]) == 0)
            {
                foreach ($groups as &$group)
                    foreach ($group[$GLOBALS["IrgAciSmwmtEQygfJLwU"]] as $key => &$quantity)
                        if ($quantity <= 0)
                            unset($group[$GLOBALS["EcaVCaBpiURiLvayrnmh"]][$key]);

                foreach ($colors as $key => $color)
                    if ($color[$GLOBALS["IrgAciSmwmtEQygfJLwU"]] <= 0)
                        unset($colors[$key]);
            }
            foreach ($combinations as $id_product_attribute => $comb)
            {
                $attribute_list = $GLOBALS["tugkmwKQmrdyfghQnRJj"];
                foreach ($comb[$GLOBALS["EcaVCaBpiURiLvayrnmh"]] as $id_attribute)
                    $attribute_list .= $GLOBALS["sMqVCSjiuIyeEqweGUNR"].(int)$id_attribute.$GLOBALS["iHVJabfYRGUXeOTMWlVU"];
                $attribute_list = rtrim($attribute_list, $GLOBALS["lRBzvzBSEQkJxdBItbg"]);
                $combinations[$id_product_attribute][$GLOBALS["xdqLbjMkqNwAldSnYJvs"]] = $attribute_list;
                $combinations[$id_product_attribute][$GLOBALS["wKBdEguMoAWWAnUKUSiN"]] = $this->assignCombinationPrice($combinations, $id_product_attribute);
            }

            foreach ($groups as $key => $value){
                foreach($value[$GLOBALS["EcaVCaBpiURiLvayrnmh"]] as $_attr_key => $_attr_value){
                    $groups[$key][$GLOBALS["EcaVCaBpiURiLvayrnmh"]][$_attr_key] = array('value' => $_attr_value);
                    if(isset($colors[$_attr_key]))
                        $groups[$key][$GLOBALS["EcaVCaBpiURiLvayrnmh"]][$_attr_key][$GLOBALS["aeTwKLfnxTGSegzYixzK"]] = $colors[$_attr_key][$GLOBALS["TNjUIwvUCKYoazJgtXiI"]];
                }
                $groups[$key][$GLOBALS["oxLfgZjvEiOVbIhPCAEl"]] = $key;
            }
            
            $groups = array_values($groups);
            $this->item[$GLOBALS["qcAqdRoXyOjMSzAvwpOV"]][$GLOBALS["jtQELVpcAjeMCcOqGrNl"]] = $groups;
            $this->item[$GLOBALS["MSKgDnjqGggSrEvmtZQO"]] = $combinations;
            
        }
    }

    public function assignCombinationPrice($combinations, $combID)
    {
        $combination = $combinations[$combID];
 
        $ecotaxTax_rate = (float)Tax::getProductEcotaxRate($this->context->cart->{Configuration::get($GLOBALS["XFwXsAvKoUwvZModoiL"])});
        $taxRate = (float)$this->product->getTaxesRate(new Address((int)$this->context->cart->{Configuration::get($GLOBALS["XFwXsAvKoUwvZModoiL"])}));
        $currency = Tools::setCurrency($this->context->cookie);
                $currencyRate = (float)$currency->conversation_rate;
         
        $address = new Address($this->context->cart->{Configuration::get($GLOBALS["XFwXsAvKoUwvZModoiL"])});
        $no_tax = Tax::excludeTaxeOption() || !$this->product->getTaxesRate($address);
         
        $id_group = (int)Group::getCurrent()->id;
        $group_reduction = GroupReduction::getValueForProduct($this->product->id, $id_group);
        if ($group_reduction === false) {
            $group_reduction = Group::getReduction((int)$this->context->cookie->id_customer) / 100;
        }
         
        $productPriceTaxExcluded = $this->product->getPriceWithoutReduct(true) - $this->product->ecotax;
        $productPriceTaxIncluded = $this->product->getPriceWithoutReduct(false) - $this->product->ecotax * (1 + $ecotaxTax_rate / 100);
         
        $basePriceWithoutTax = +$productPriceTaxExcluded;
        $basePriceWithTax = +$productPriceTaxIncluded;
         
        $priceWithGroupReductionWithoutTax = 0;
        $priceWithGroupReductionWithoutTax = $basePriceWithoutTax * (1 - $groupReduction);
         
        $basePriceWithoutTax = $basePriceWithoutTax + +$combination[$GLOBALS["IXCfKzsjlitrRiMXFvE"]];
        $basePriceWithTax = $basePriceWithTax + +$combination[$GLOBALS["IXCfKzsjlitrRiMXFvE"]] * ($taxRate/100 + 1);
         
        if ($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]] && $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["IXCfKzsjlitrRiMXFvE"]] > 0)
        {
            $basePriceWithoutTax = +$combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["IXCfKzsjlitrRiMXFvE"]];
            $basePriceWithTax = +$combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["IXCfKzsjlitrRiMXFvE"]] * ($taxRate/100 + 1);
        }
         
        $priceWithDiscountsWithoutTax = $basePriceWithoutTax;
        $priceWithDiscountsWithTax = $basePriceWithTax;
         
        $default_eco_tax = $this->product->ecotax;
        if ($default_eco_tax)
        {
                        $priceWithDiscountsWithoutTax = $priceWithDiscountsWithoutTax + $default_eco_tax * (1 + $ecotaxTax_rate / 100);
            $priceWithDiscountsWithTax = $priceWithDiscountsWithTax + $default_eco_tax * (1 + $ecotaxTax_rate / 100);
            $basePriceWithTax = $basePriceWithTax + $default_eco_tax * (1 + $ecotaxTax_rate / 100);
            $basePriceWithoutTax = $basePriceWithoutTax + $default_eco_tax * (1 + $ecotaxTax_rate / 100);
        }
         
                                if ($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]] && $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["kAVweimVWpDAwqtahOLu"]] > 0)
        {
            if ($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["XcMtDkftDvJyzeXXs"]] == $GLOBALS["khKHMEfpjltzcnpywNSQ"])
            {
                if (isset($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["hQbAuitXBYoioWKymoVk"]]) && $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["hQbAuitXBYoioWKymoVk"]] === $GLOBALS["eZrKzfUgBxsaIAHVNXws"])
                {
                    $reduction = $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["kAVweimVWpDAwqtahOLu"]];
                    if ($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["xlhZIDgKOCIUhPpCPieU"]] == 0)
                        $reduction = $reduction * $currencyRate * (1 - $groupReduction);
                    $priceWithDiscountsWithoutTax -= $reduction;
                    $priceWithDiscountsWithTax -= $reduction * ($taxRate/100 + 1);
                }
            }
            else if ($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["XcMtDkftDvJyzeXXs"]] == $GLOBALS["LgMNIFzKHGZVHsEXfc"])
            {
                $priceWithDiscountsWithoutTax = $priceWithDiscountsWithoutTax * (1 - +$combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["kAVweimVWpDAwqtahOLu"]]);
                $priceWithDiscountsWithTax = $priceWithDiscountsWithTax * (1 - +$combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["kAVweimVWpDAwqtahOLu"]]);
            }
        }
         
                $noTaxForThisProduct = $no_tax;
        $customerGroupWithoutTax = Group::getPriceDisplayMethod($this->context->customer->id_default_group);
        if ($noTaxForThisProduct || $customerGroupWithoutTax)
        {
            $basePriceDisplay = $basePriceWithoutTax;
            $priceWithDiscountsDisplay = $priceWithDiscountsWithoutTax;
        }
        else
        {
            $basePriceDisplay = $basePriceWithTax;
            $priceWithDiscountsDisplay = $priceWithDiscountsWithTax;
        }
         
                if ($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]] && $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["kAVweimVWpDAwqtahOLu"]] > 0)
        {
            if ($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["XcMtDkftDvJyzeXXs"]] == $GLOBALS["khKHMEfpjltzcnpywNSQ"])
            {
                if (isset($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["hQbAuitXBYoioWKymoVk"]])
                    || (isset($combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["hQbAuitXBYoioWKymoVk"]]) && $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["hQbAuitXBYoioWKymoVk"]] === $GLOBALS["SHlRCNLzGtCGyHhhetLl"]))
                {
                    $reduction = $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["kAVweimVWpDAwqtahOLu"]];
                    $specific_currency=($this->product->specificPrice && $this->product->specificPrice->id_currency);
                    if (isset($specific_currency) && $specific_currency && (int) $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["xlhZIDgKOCIUhPpCPieU"]] && $combination[$GLOBALS["bVRMRbGBDrrkiLSpulGW"]][$GLOBALS["xlhZIDgKOCIUhPpCPieU"]] != $currency[$GLOBALS["SiRSACHoXsTIZeRmGmwq"]])
                        $reduction = $reduction / $currencyRate;
                    else if(!$specific_currency)
                        $reduction = $reduction * $currencyRate;
         
                    if (isset($groupReduction) && $groupReduction > 0)
                        $reduction *= 1 - (float)$groupReduction;
         
                    $priceWithDiscountsDisplay -= $reduction;
                                        $priceWithDiscountsWithoutTax = $priceWithDiscountsDisplay - $reduction * ( 1/(1+$taxRate/100) );
                }
            }
        }
         
        if ($priceWithDiscountsDisplay < 0)
        {
            $priceWithDiscountsDisplay = 0;
        }
         
                        if ($basePriceDisplay != $priceWithDiscountsDisplay)
        {
            $discountValue = $basePriceDisplay - $priceWithDiscountsDisplay;
            $discountPercentage = (1-($priceWithDiscountsDisplay/$basePriceDisplay))*100;
        }
         
        $unit_impact = +$combination[$GLOBALS["CfIMBdFmUdrPQDvtgiAT"]];
        $productUnitPriceRatio = $this->product->unit_price_ratio;
        $productBasePriceTaxExcl = $this->product->getPrice(false, null, 6, null, false, false);
        if ($productUnitPriceRatio > 0 || $unit_impact)
        {
            if ($unit_impact)
            {
                $baseUnitPrice = $productBasePriceTaxExcl / $productUnitPriceRatio;
                $unit_price = $baseUnitPrice + $unit_impact;
         
                if (!$noTaxForThisProduct || !$customerGroupWithoutTax)
                    $unit_price = $unit_price * ($taxRate/100 + 1);
            }
            else
                $unit_price = $priceWithDiscountsDisplay / $productUnitPriceRatio;
        }
         
        $prices[$GLOBALS["xEuNZucKDqLNdbfNfI"]] = $priceWithDiscountsDisplay;
        if ($priceWithDiscountsDisplay != $basePriceDisplay){
            $prices[$GLOBALS["NLslBGGtkJJgsrnJizxo"]] = $basePriceDisplay;
        }
        return $prices;
    }

    
    public function getProductAttributePrice($combinations, $default, $id)
    {
        if ($id && $combinations) {
            $defaultList = $combinations[$this->id_product_attribute][$GLOBALS["xdqLbjMkqNwAldSnYJvs"]];
            $price = $combinations[$this->id_product_attribute][$GLOBALS["IXCfKzsjlitrRiMXFvE"]];
            $list = str_replace($default, $id, $defaultList);
            if ($list != $defaultList) {
                foreach ($combinations as $combination) {
                    if ($list == $combination[$GLOBALS["xdqLbjMkqNwAldSnYJvs"]]) {
                        $price = ($combination[$GLOBALS["IXCfKzsjlitrRiMXFvE"]] - $price) * (100 - intval($this->item[$GLOBALS["iKEQRFcfxIqznxtlsAQh"]])) * 0.01;
                        return currency_price_value($price);
                    }
                }
            }
        }

        return 0;
    }

    
    public function getIdProductAttribut(array $options, $productId)
    {

        if (empty($options)) {
            return 0;
        }

        $whereStr = join($GLOBALS["lRBzvzBSEQkJxdBItbg"], $options);
        $id_product_attribute = Db::getInstance(_PS_USE_SQL_SLAVE_)->getValue($GLOBALS["CPEonBsVnLszXGOuxVuG"] . _DB_PREFIX_ . $GLOBALS["HJaoHATcYKRjsXgrwQhg"] . _DB_PREFIX_ . $GLOBALS["IaGUeeXEeXHjmVOOPTTu"] . $productId . $GLOBALS["bBMsoLampSUmOtmZBsPc"] . $whereStr . $GLOBALS["ImvOgQBUmWCuICDaSpFT"] . count($options));

        return $id_product_attribute;
    }

    public function getRecommededItems()
    {
        $this->item[$GLOBALS["aDsyYlYDxUfZXGWWmcEh"]] = array();
    }

    public function getRelatedItems()
    {
        $accessories = $this->product->getAccessories($this->context->language->id);

        $products = array();
        if($accessories){
            foreach($accessories as $cp){
                if($cp[$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]] == $this->product->id_product)
                    continue;
                
                $_product = array(
                    'product_id'            => $cp['id_product'],
                    'product_thumbnail_url' => $this->getProductImage($this->link_rewrite, $cp['id_image'], 'home'),
                    $GLOBALS["BoWuBfavKqJxeLgCuLA"]                  => $cp[$GLOBALS["BoWuBfavKqJxeLgCuLA"]],
                    $GLOBALS["kxughgBEvduIYGUqLnnc"]            => $price_show,
                    $GLOBALS["IXCfKzsjlitrRiMXFvE"]                 => $cp[$GLOBALS["IXCfKzsjlitrRiMXFvE"]]
                    );
                $_product[$GLOBALS["QtXGAQQggTtyJvIWmFWm"]] = $_product[$GLOBALS["YdhzFFiTsHZheiDjPLQW"]];
                $_product[$GLOBALS["mtniJtSfBUifnYAdTgNC"]] = $this->allowAddToCartProduct($cp) ? true : false;
                $_product[$GLOBALS["nhWAuBNMUlltysutj"]] = $cp[$GLOBALS["nhWAuBNMUlltysutj"]];
                $_product[$GLOBALS["rxVRfDIGAUAOANLeBlcD"]] = $this->getReviewSummary($cp[$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]]);
                $_product[$GLOBALS["idumNZtnyCdKUNpoNPo"]] = $this->getRatingOptions($cp[$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]]);
                $products[] = $_product;
            }
        }
                $this->item[$GLOBALS["FGiYrDjYFONMguneiijw"]][$GLOBALS["BqyYELduncgqBkajIVvH"]] = $products;
    }

    public function allowAddToCartProduct($product)
    {
        return (!isset($product[$GLOBALS["nhWAuBNMUlltysutj"]]) || $product[$GLOBALS["nhWAuBNMUlltysutj"]]) &&
                $product[$GLOBALS["femmxRrxnjALYHwtucSS"]] != 2 &&
                !Configuration::get($GLOBALS["AyLWttwxGSkBzANPLdWr"]) &&
                ($product[$GLOBALS["PLaaBmZzGHSDoJcNaAFV"]] || $product[$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]] > 0);
    }

    public function getProductFeature()
    {
        $features = $this->product->getFrontFeatures($this->context->cookie->id_lang);
        foreach ($features as &$feature) {
            $feature[$GLOBALS["fcoPzIuYMjbtOJqsdHcU"]] = $feature[$GLOBALS["rwOdVnTfQGAaYrmsMgnw"]];
            if(empty($feature[$GLOBALS["TNjUIwvUCKYoazJgtXiI"]])){
                unset($feature[$GLOBALS["rwOdVnTfQGAaYrmsMgnw"]]);
            }
            else{
                $feature[$GLOBALS["JlesIBlrQqglCVkqHhAO"]] = $GLOBALS["AohdBTLKLxDXDJvzKOAN"];
            }
        }

        return $features;
    }

    
    public function getItemImgs()
    {
        $this->item[$GLOBALS["LOUEjIBkjaWopnwaFhHn"]] = $this->description_short;
        $this->item[$GLOBALS["EbXIawqnHDbDPPpxXRp"]] = preg_replace($GLOBALS["gTHHinCFCTiKVgVZKM"], $GLOBALS["qQlZmYRcFEcqncSpSkos"] . _PS_BASE_URL_ . $GLOBALS["SHnrRXoyKsYjLJCAtvTD"], $this->description);
                $this->item[$GLOBALS["jRoLhsfsiAeUhJKrALNg"]] = $this->getProductFeature();

        $imgs = array();
        $images = $this->product->getImages($this->context->cookie->id_lang);

        $pos = 0;
        foreach ($images as $row) {
            $imageId = $this->id_product . $GLOBALS["ELkdWnXntlzZoMeKYinU"] . $row[$GLOBALS["uumiERFdHiBWTuFFNysQ"]];
            $imgs[] = array(
                'id' => $row['id_image'],
                'full_image_url' => $this->getProductImage($this->link_rewrite, $imageId, 'large'),
                $GLOBALS["sEVWmFbTxTyXCAuzlzdI"] => $pos++,
                $GLOBALS["UWIPgjxFofMMrcoIwgFn"] => $GLOBALS["SnsSSwMKZSYeMFnEirnh"]
            );
        }

        if (!$imgs) {
            $imgs[] = array(
                'id' => '1',
                'full_image_url' => $this->getProductImage($this->link_rewrite, $this->id_image, 'large'),
                $GLOBALS["sEVWmFbTxTyXCAuzlzdI"] => $pos,
                $GLOBALS["UWIPgjxFofMMrcoIwgFn"] => $GLOBALS["SnsSSwMKZSYeMFnEirnh"]
            );
        }
        $this->item[$GLOBALS["ACGsNtjeBZmtyMLzUxvw"]] = $imgs;
        return $imgs;
    }

    public function clear()
    {
        $this->product = null;
        $this->item = array();
    }

    public function setProduct($product)
    {
        if (is_array($product)) {
            if (!isset($product[$GLOBALS["uumiERFdHiBWTuFFNysQ"]])) {                 $productId = $product[$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]];
                $imageId = Product::getCover($productId);
                $product[$GLOBALS["uumiERFdHiBWTuFFNysQ"]] = $productId . $GLOBALS["ELkdWnXntlzZoMeKYinU"] . $imageId[$GLOBALS["uumiERFdHiBWTuFFNysQ"]];
            }

            empty($product[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]) && $product[$GLOBALS["ahSttejFzcuTRHYoOtXb"]] = Product::getDefaultAttribute($productId);
            if (!isset($product[$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]]) || empty($product[$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]])) {
                $product[$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]] = Product::getQuantity($product[$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]], $product[$GLOBALS["ahSttejFzcuTRHYoOtXb"]]);
            }
                        addImageRatio($product);

            $this->product = $product;
            $this->isArray = true;
        }
    }

    public function loadProductById($productId)
    {
        if (is_numeric($productId)) {
            $this->product = new Product($productId, true, $this->context->cookie->id_lang);
            $imageId = Product::getCover($productId);

            $this->isArray = false;
            $this->product->id_image = $productId . $GLOBALS["ELkdWnXntlzZoMeKYinU"] . $imageId[$GLOBALS["uumiERFdHiBWTuFFNysQ"]];
            $this->product->id_image = Product::defineProductImage( $imageId, $this->context->cookie->id_lang);
            $this->product->id_product = $productId;
            $this->product->id_product_attribute = Product::getDefaultAttribute($productId);

            if (!$this->product->quantity) {
                $this->product->quantity = Product::getQuantity($productId, $this->product->id_product_attribute);
            }
            $this->item[$GLOBALS["UxpaPbRXERSOLPwRbRqc"]] = $this->product->quantity;
            $this->item[$GLOBALS["MSKgDnjqGggSrEvmtZQO"]] = $this->product->getAttributeCombinations($this->context->language->id);
            $this->product->allow_oosp = Product::isAvailableWhenOutOfStock($this->product->out_of_stock);
        }
    }

    public function __get($name)
    {
        if ($this->product) {
            if ($this->isArray) {
                return $this->product[$name];
            } else {
                return $this->product->{$name};
            }
        } else {
            return null;
        }
    }

    public function __isset($name)
    {
        if ($this->product) {
            if ($this->isArray) {
                return isset($this->product[$name]);
            } else {
                return isset($this->product->{$name});
            }
        } else {
            return false;
        }
    }

    public function getListingItemInfo()
    {
        $this->getItemBaseInfo();
        if ($this->isArray) {
            $this->loadProductById($this->id_product);
        }
        $this->getItemPrices();
        $this->assignAttributesGroups();
        $this->getItemImgs();
        $this->getGroceryItems();
        return $this->getTranslatedItem();
    }

    public function getFullItemInfo()
    {
        $this->getItemBaseInfo();
        if ($this->isArray) {
            $this->loadProductById($this->id_product);
        }
        $this->getItemPrices();
        $this->assignAttributesGroups();
        $this->getItemImgs();
        $this->getRelatedItems();
        $this->getGroceryItems();
        return $this->getTranslatedItem();
    }

    public function getGroceryItems()
    {
        bindProductListingGrocery($this->item);
    }
}
 ?>