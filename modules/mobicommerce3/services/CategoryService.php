<?php
$GLOBALS["TOeAMkZYbiIeTLssrRUI"]=base64_decode("Y291bnQ=");$GLOBALS["tCYSApDKjdVXwbzQIJxw"]=base64_decode("cGFyZW50X2NpZA==");$GLOBALS["sdupJnxQUHSOsLfaZtpI"]=base64_decode("aXNfcGFyZW50");$GLOBALS["SEIWOTlsAALnWFpIAhNE"]=base64_decode("KQogICAgICAgIE9SREVSIEJZIGMuYGxldmVsX2RlcHRoYCBBU0MsIGNhdGVnb3J5X3Nob3AuYHBvc2l0aW9uYCBBU0M=");$GLOBALS["GXMfTUXsDODsXGffLZlK"]=base64_decode("aW50dmFs");$GLOBALS["alqLDMhvHSsTcLWVrdFB"]=base64_decode("IEFORCBjLmBhY3RpdmVgID0gIjEiCiAgICAgICAgQU5EIGMuYGlkX2NhdGVnb3J5YCBJTiAo");$GLOBALS["EdLpxBzXhZzLbdZiWAkF"]=base64_decode("KQogICAgICAgIFdIRVJFIGNsLmBpZF9sYW5nYCA9IA==");$GLOBALS["jcMiNJrTdpENVmnesqXJ"]=base64_decode("Y2F0ZWdvcnlfc2hvcGAgY3MKICAgICAgICAgICAgT04gKGMuYGlkX2NhdGVnb3J5YCA9IGNzLmBpZF9jYXRlZ29yeWAgQU5EIGNzLmBpZF9zaG9wYCA9IA==");$GLOBALS["XtjijoSfQjCWBfQqaJBW"]=base64_decode("CiAgICAgICAgTEVGVCBKT0lOIGA=");$GLOBALS["wCFbzDpjnbYGmjcexrRI"]=base64_decode("KQogICAgICAgIA==");$GLOBALS["oaJzyxJQSULJOMLCgcgM"]=base64_decode("Y2F0ZWdvcnlfbGFuZ2AgY2wgT04gKGMuYGlkX2NhdGVnb3J5YCA9IGNsLmBpZF9jYXRlZ29yeWA=");$GLOBALS["nicsSJzSEEtehUpKEDY"]=base64_decode("Y2F0ZWdvcnlgIGMKICAgICAgICBMRUZUIEpPSU4gYA==");$GLOBALS["dNkXTpMValqVhTQNlYWK"]=base64_decode("CiAgICAgICAgU0VMRUNUIGMuYGlkX2NhdGVnb3J5YCwgY2wuYG5hbWVgLCBjbC5gbGlua19yZXdyaXRlYCwgY2wuYGlkX2xhbmdgCiAgICAgICAgRlJPTSBg");$GLOBALS["RzSEVkispeUXhFoCFKok"]=base64_decode("UFNfU0hPUF9ERUZBVUxU");$GLOBALS["UaImqMgtUCvjvWIAwbbm"]=base64_decode("aW1nL3RtcC9jYXRlXw==");$GLOBALS["izRclBmLDPMEpbTVBjaw"]=base64_decode("Y2F0ZV8=");$GLOBALS["VZjhhbHAWdpHxEbYBkrO"]=base64_decode("L2ltZy90bXAvY2F0ZV8=");$GLOBALS["kKdvCNdcMUzVsHqmcGpZ"]=base64_decode("LmpwZw==");$GLOBALS["PqwJWBDOZqWZAfhvAiNw"]=base64_decode("bWNpX2Jhbm5lcg==");$GLOBALS["yRxXBWkyKplSSwKpGOWA"]=base64_decode("L21lZGlhL21vYmlfY29tbWVyY2UvY2F0ZWdvcnkv");$GLOBALS["elBBytaNdsVTJKsSXGuy"]=base64_decode("bW9kdWxlcy8=");$GLOBALS["pOYLvIrWeDsNWICXwgGU"]=base64_decode("bWNpX3RodW1ibmFpbA==");$GLOBALS["glCtwboWYexWxUNYpikb"]=base64_decode("bWNpX2NhdGVnb3J5X2lk");$GLOBALS["asIPZVYwThWDPmFOBfzS"]=base64_decode("bW9iaWNvbW1lcmNlX2NhdGVnb3J5X2ljb24z");$GLOBALS["ObPMBnloWfQEXONfvzIX"]=base64_decode("U0VMRUNUICogRlJPTSA=");$GLOBALS["VdgiCdagExNtYCmOeVI"]=base64_decode("YmFubmVyX3VybA==");$GLOBALS["RMVPxNDRmOvlaTeGcDhG"]=base64_decode("dGh1bWJuYWlsX3VybA==");$GLOBALS["BsswTBoNvOQkmJQbIsFL"]=base64_decode("aGFzX3dpZGdldHM=");$GLOBALS["gPbtrHOLmwwZYHcWigAB"]=base64_decode("Y2hpbGRyZW4=");$GLOBALS["QiOuCtkBuLIpKdDzfHJm"]=base64_decode("UFJPRFVDVFM=");$GLOBALS["NkbQibBFLqhlfISNaCNn"]=base64_decode("ZGlzcGxheV9tb2Rl");$GLOBALS["TCmEhPtemzjJFgIZboSA"]=base64_decode("cHJvZHVjdHNfY291bnQ=");$GLOBALS["OecjgeveAguzJiqDxlIO"]=base64_decode("cGFyZW50X2lk");$GLOBALS["PiAcIEATXlQdiYGIyCLU"]=base64_decode("Y2F0ZWdvcnlfaWQ=");$GLOBALS["BoWuBfavKqJxeLgCuLA"]=base64_decode("bmFtZQ==");$GLOBALS["TEEZNtEQBJEEdsXHoWuU"]=base64_decode("bGV2ZWxfZGVwdGg=");$GLOBALS["gAGcYhDAfcFzxNcNvseR"]=base64_decode("bGFuZ3VhZ2VfY29kZQ==");$GLOBALS["feSiCyHZJEsqYvpXxAka"]=base64_decode("UFNfTEFOR19ERUZBVUxU");$GLOBALS["wyXydZkTCDoGMhREuZY"]=base64_decode("aW5mb3M=");$GLOBALS["QVWFuLyKVyGmMRnfrqPG"]=base64_decode("aWRfY2F0ZWdvcnk=");$GLOBALS["tpOImrzfDrTKUGKrQLDT"]=base64_decode("aWRfcGFyZW50");$GLOBALS["DYlpRrpCXAmwbMcezjbr"]=base64_decode("T1JERVIgQlkgYy5gbGV2ZWxfZGVwdGhgIEFTQywgY2F0ZWdvcnlfc2hvcC5gcG9zaXRpb25gIEFTQw==");$GLOBALS["dTOjZMAIgejIWuXiTboJ"]=base64_decode("R1JPVVAgQlkgYy5pZF9jYXRlZ29yeQ==");$GLOBALS["ldlXFKVAnBQoqVsunyBC"]=base64_decode("QU5EIGBhY3RpdmVgID0gMQ==");$GLOBALS["XAkYITlmJBHKeKuVJRHU"]=base64_decode("QU5EIGBpZF9sYW5nYCA9IA==");$GLOBALS["iKLyShFQlpjmJpFfaoec"]=base64_decode("IA==");$GLOBALS["NlkGOgILliehXZVxPCUd"]=base64_decode("CiAgICAgICAgICAgIFdIRVJFIDEg");$GLOBALS["mycjraeYoBEhqvVxMHis"]=base64_decode("CiAgICAgICAgICAgIA==");$GLOBALS["QzGMQGFntYUNpLNLrryD"]=base64_decode("Y2w=");$GLOBALS["UjBNcVESRIqrIabtNSwP"]=base64_decode("Y2F0ZWdvcnlfbGFuZ2AgY2wgT04gYy5gaWRfY2F0ZWdvcnlgID0gY2wuYGlkX2NhdGVnb3J5YA==");$GLOBALS["yInKLWzeLRkBAylKeaXY"]=base64_decode("CiAgICAgICAgICAgIExFRlQgSk9JTiBg");$GLOBALS["WvPiHKEqeSkRBPjsyrxy"]=base64_decode("Yw==");$GLOBALS["sxVALmpUOyAaYsrTXikR"]=base64_decode("Y2F0ZWdvcnk=");$GLOBALS["ITuHJDRsAUSmnNIMELMc"]=base64_decode("Y2F0ZWdvcnlgIGMKICAgICAgICAgICAg");$GLOBALS["claNysYGLQhVsHiKTvgU"]=base64_decode("CiAgICAgICAgICAgIFNFTEVDVCAqCiAgICAgICAgICAgIEZST00gYA==");$GLOBALS["VCeDXyRjelXFDkiObLgu"]=base64_decode("PQ==");$GLOBALS["WLQfODDGnljWKEkYDnOg"]=base64_decode("KQ==");$GLOBALS["lRBzvzBSEQkJxdBItbg"]=base64_decode("LA==");$GLOBALS["NSyipOkrjsekCpYtaVy"]=base64_decode("SU4gKA==");$GLOBALS["NvvFSIRAMPydXdiJdvvE"]=base64_decode("QU5EIGNnLmBpZF9ncm91cGAg");$GLOBALS["XhOEHlSiHyKWGVzgjSic"]=base64_decode("Y2F0ZWdvcnlfZ3JvdXBgIGNnIE9OIChjZy5gaWRfY2F0ZWdvcnlgID0gYy5gaWRfY2F0ZWdvcnlgKQ==");$GLOBALS["xDzaxibzyVuSHpyEy"]=base64_decode("TEVGVCBKT0lOIGA=");$GLOBALS["tugkmwKQmrdyfghQnRJj"]=base64_decode("");$GLOBALS["vnikmTnwHXDcKJBQNHoK"]=base64_decode("TW9iaWNvbW1lcmNlaGVscGVy");$GLOBALS["PdepTkCacGhHbSYynMub"]=base64_decode("SFRUUC8xLjEgNDA0IE5vdCBGb3VuZA==");$GLOBALS["QIfjBqYCYzCTbgddRxFH"]=base64_decode("SU5fTU9CSUNPTU1FUkNF");$GLOBALS["ffhqVlccKexwAkkOWxhE"]=base64_decode("c3RyaW5nKC8vaW1nL0BzcmMp");$GLOBALS["blvxGuHdYPMKQBMJHxpo"]=base64_decode("anBn");
?><?php


if (!defined($GLOBALS["QIfjBqYCYzCTbgddRxFH"]))
{
    header($GLOBALS["PdepTkCacGhHbSYynMub"]);
    die();
}


class CategoryService extends BaseService
{
    public function __construct()
    {
        parent::__construct();
        ServiceFactory::factory($GLOBALS["vnikmTnwHXDcKJBQNHoK"])->autoLoginMobileUser();
    }

    
    public static function getCategories($id_lang = false, $active = true, $order = true, $sql_filter = '', $sql_sort = '', $sql_limit = '')
    {
        $sql_groups_where = $GLOBALS["tugkmwKQmrdyfghQnRJj"];
        $sql_groups_join = $GLOBALS["tugkmwKQmrdyfghQnRJj"];
        if (Group::isFeatureActive())
        {
                        $sql_groups_join = $GLOBALS["xDzaxibzyVuSHpyEy"]._DB_PREFIX_.$GLOBALS["XhOEHlSiHyKWGVzgjSic"];
            $groups = FrontController::getCurrentCustomerGroups();
            $sql_groups_where = $GLOBALS["NvvFSIRAMPydXdiJdvvE"].(count($groups) ? $GLOBALS["NSyipOkrjsekCpYtaVy"].implode($GLOBALS["lRBzvzBSEQkJxdBItbg"], $groups).$GLOBALS["WLQfODDGnljWKEkYDnOg"] : $GLOBALS["VCeDXyRjelXFDkiObLgu"].(int)Group::getCurrent()->id);
        }

        if (!Validate::isBool($active))
            die(Tools::displayError());
        $result = Db::getInstance(_PS_USE_SQL_SLAVE_)->executeS($GLOBALS["claNysYGLQhVsHiKTvgU"]._DB_PREFIX_.$GLOBALS["ITuHJDRsAUSmnNIMELMc"].Shop::addSqlAssociation($GLOBALS["sxVALmpUOyAaYsrTXikR"], $GLOBALS["WvPiHKEqeSkRBPjsyrxy"]).$GLOBALS["yInKLWzeLRkBAylKeaXY"]._DB_PREFIX_.$GLOBALS["UjBNcVESRIqrIabtNSwP"].Shop::addSqlRestrictionOnLang($GLOBALS["QzGMQGFntYUNpLNLrryD"]).$GLOBALS["mycjraeYoBEhqvVxMHis"].$sql_groups_join.$GLOBALS["NlkGOgILliehXZVxPCUd"].$sql_filter.$GLOBALS["iKLyShFQlpjmJpFfaoec"].($id_lang ? $GLOBALS["XAkYITlmJBHKeKuVJRHU"].(int)$id_lang : $GLOBALS["tugkmwKQmrdyfghQnRJj"]).$GLOBALS["mycjraeYoBEhqvVxMHis"].($active ? $GLOBALS["ldlXFKVAnBQoqVsunyBC"] : $GLOBALS["tugkmwKQmrdyfghQnRJj"]).$GLOBALS["mycjraeYoBEhqvVxMHis"].$sql_groups_where.$GLOBALS["mycjraeYoBEhqvVxMHis"].(!$id_lang ? $GLOBALS["dTOjZMAIgejIWuXiTboJ"] : $GLOBALS["tugkmwKQmrdyfghQnRJj"]).$GLOBALS["mycjraeYoBEhqvVxMHis"].($sql_sort != $GLOBALS["tugkmwKQmrdyfghQnRJj"] ? $sql_sort : $GLOBALS["DYlpRrpCXAmwbMcezjbr"]).$GLOBALS["mycjraeYoBEhqvVxMHis"].($sql_limit != $GLOBALS["tugkmwKQmrdyfghQnRJj"] ? $sql_limit : $GLOBALS["tugkmwKQmrdyfghQnRJj"])
        );

        if (!$order)
            return $result;

        $categories = array();
        foreach ($result as $row)
            $categories[$row[$GLOBALS["tpOImrzfDrTKUGKrQLDT"]]][$row[$GLOBALS["QVWFuLyKVyGmMRnfrqPG"]]][$GLOBALS["wyXydZkTCDoGMhREuZY"]] = $row;

        return $categories;
    }

    
    public function getAllCategories()
    {
        $root = Category::getRootCategory();
        $rows = $this->getCategories($this->context->cookie->id_lang);
        $categories = array();
        $parent = array();
        $postion = 0;
        $current_lang = (int) Configuration::get($GLOBALS["feSiCyHZJEsqYvpXxAka"]);
        $langDetails =  Language::getLanguage($current_lang);
        $lang_code = $langDetails[$GLOBALS["gAGcYhDAfcFzxNcNvseR"]];
       
        foreach ($rows as $pid => $row)
        {
            foreach ($row as $cid => $item)
            {
                if ($item[$GLOBALS["wyXydZkTCDoGMhREuZY"]][$GLOBALS["TEEZNtEQBJEEdsXHoWuU"]] > $root->level_depth)
                {
                    $pid == $root->id || $parent[$pid] = true;                    
                    $child = Category::getChildren($cid, $current_lang);
                    
                    
                    $categories[$cid] = array(
                        'name'           => $item['infos']['name'],
                        'category_id'    => $item['infos']['id_category'],
                        'parent_id'      => $item['infos']['id_parent'],
                        'products_count' => 10,
                        'display_mode'   => 'PRODUCTS',
                        'children'       => count($child),
                                                $GLOBALS["BsswTBoNvOQkmJQbIsFL"]    => false,
                                                $GLOBALS["RMVPxNDRmOvlaTeGcDhG"]  => $GLOBALS["tugkmwKQmrdyfghQnRJj"],
                        $GLOBALS["VdgiCdagExNtYCmOeVI"]     => $GLOBALS["tugkmwKQmrdyfghQnRJj"]
                    );
                }
            }
        }

        $this->getProductQuantity($categories, $root);
        $this->getProductTotal($categories, $parent);
        $categories = $this->_assignCategoryThumbnail($categories);
        return array_values($categories);
    }

    
    protected function _assignCategoryThumbnail($categories)
    {
        $base_url = $this->getBaseUrl();
                $allcategories = array();
        $categoryIds = array();
        if(!empty($categories)){
            foreach ($categories as $key => $value) {
                $allcategories[$value[$GLOBALS["PiAcIEATXlQdiYGIyCLU"]]] = $value;
                $categoryIds[] = $value[$GLOBALS["PiAcIEATXlQdiYGIyCLU"]];
            }
        }

        $sql = $GLOBALS["ObPMBnloWfQEXONfvzIX"]._DB_PREFIX_.$GLOBALS["asIPZVYwThWDPmFOBfzS"];
        if ($results = Db::getInstance()->ExecuteS($sql))
        {
            foreach ($results as $row){
                if(array_key_exists($row[$GLOBALS["glCtwboWYexWxUNYpikb"]], $allcategories)){
                    if($row[$GLOBALS["pOYLvIrWeDsNWICXwgGU"]])
                    {
                        $allcategories[$row[$GLOBALS["glCtwboWYexWxUNYpikb"]]][$GLOBALS["RMVPxNDRmOvlaTeGcDhG"]] = $base_url.$GLOBALS["elBBytaNdsVTJKsSXGuy"].$this->module->name.$GLOBALS["yRxXBWkyKplSSwKpGOWA"].$row[$GLOBALS["pOYLvIrWeDsNWICXwgGU"]];
                    }
                    if($row[$GLOBALS["PqwJWBDOZqWZAfhvAiNw"]])
                    {
                        $allcategories[$row[$GLOBALS["glCtwboWYexWxUNYpikb"]]][$GLOBALS["VdgiCdagExNtYCmOeVI"]] = $base_url.$GLOBALS["elBBytaNdsVTJKsSXGuy"].$this->module->name.$GLOBALS["yRxXBWkyKplSSwKpGOWA"].$row[$GLOBALS["PqwJWBDOZqWZAfhvAiNw"]];
                    }
                }
            }
        }

        return array_values($allcategories);
    }

    
    public function getCategory($categoriesIds)
    {
        $root = Category::getRootCategory();
        $rows = $this->getCategoryInformations($categoriesIds, $this->context->cookie->id_lang);
                $categories = array();
        $parent = array();
        $postion = 0;
        foreach ($rows as $cid => $row) {
                                    $categories[$cid] = array(
                'category_id'   => $cid,
                'name'          => $row['name'],
                'thumbnail_url' => '',
                'banner_url'    => ''
                );
        }
        $this->getProductQuantity($categories, $root);
        $this->getProductTotal($categories, $parent);
        $categories = $this->_assignCategoryThumbnail($categories);

        return array_values($categories);
    }

    
    public function getCategoryThumbnailUrl($id)
    {
        $image = _PS_CAT_IMG_DIR_.$id.$GLOBALS["kKdvCNdcMUzVsHqmcGpZ"];
        $thumbnail_url = NULL;
        if(file_exists($image))
        {
            $_tmp_image = _PS_ROOT_DIR_ . $GLOBALS["VZjhhbHAWdpHxEbYBkrO"].$id.$GLOBALS["kKdvCNdcMUzVsHqmcGpZ"];
            if(!file_exists($_tmp_image)){
                $image_url = ImageManager::thumbnail($image, $GLOBALS["izRclBmLDPMEpbTVBjaw"].$id.$GLOBALS["kKdvCNdcMUzVsHqmcGpZ"], 350,$GLOBALS["blvxGuHdYPMKQBMJHxpo"], true, true);
                $xpath = new DOMXPath(@DOMDocument::loadHTML($image_url));
                $src = $xpath->evaluate($GLOBALS["ffhqVlccKexwAkkOWxhE"]);
                $thumbnail_url = _PS_BASE_URL_ . DIRECTORY_SEPARATOR . $src;
            }
            else{
                $thumbnail_url = _PS_BASE_URL_ . DIRECTORY_SEPARATOR . $GLOBALS["UaImqMgtUCvjvWIAwbbm"].$id.$GLOBALS["kKdvCNdcMUzVsHqmcGpZ"];
            }
        }

        return $thumbnail_url;
    }

    
    public function getCategoryInformations($ids_category, $id_lang = null)
    {
        if ($id_lang === null)
            $id_lang = Context::getContext()->language->id;

        if (!is_array($ids_category) || !count($ids_category))
            return;

        $id = Context::getContext()->shop->id;
        $id_shop = $id ? $id: Configuration::get($GLOBALS["RzSEVkispeUXhFoCFKok"]);

        $categories = array();
        $results = Db::getInstance(_PS_USE_SQL_SLAVE_)->executeS($GLOBALS["dNkXTpMValqVhTQNlYWK"]._DB_PREFIX_.$GLOBALS["nicsSJzSEEtehUpKEDY"]._DB_PREFIX_.$GLOBALS["oaJzyxJQSULJOMLCgcgM"].Shop::addSqlRestrictionOnLang($GLOBALS["QzGMQGFntYUNpLNLrryD"]).$GLOBALS["wCFbzDpjnbYGmjcexrRI"].Shop::addSqlAssociation($GLOBALS["sxVALmpUOyAaYsrTXikR"], $GLOBALS["WvPiHKEqeSkRBPjsyrxy"]).$GLOBALS["XtjijoSfQjCWBfQqaJBW"]._DB_PREFIX_.$GLOBALS["jcMiNJrTdpENVmnesqXJ"].(int)$id_shop.$GLOBALS["EdLpxBzXhZzLbdZiWAkF"].(int)$id_lang.$GLOBALS["alqLDMhvHSsTcLWVrdFB"].implode($GLOBALS["lRBzvzBSEQkJxdBItbg"], array_map('intval', $ids_category)).$GLOBALS["SEIWOTlsAALnWFpIAhNE"]);

        foreach ($results as $category)
            $categories[$category[$GLOBALS["QVWFuLyKVyGmMRnfrqPG"]]] = $category;

        return $categories;
    }

    
    private function getProductTotal(&$cats, $pids)
    {
        if (!($count = sizeof($pids)))
        {
            return;
        }

        $parents = array();
        $newPids = array();
        foreach ($cats as $key => &$cat)
        {
            if (isset($pids[$key]))
            {
                $cat[$GLOBALS["sdupJnxQUHSOsLfaZtpI"]] = true;
                $parents[$key] = &$cat;
                $newPids[$cat[$GLOBALS["tCYSApDKjdVXwbzQIJxw"]]] = true;
            }
            elseif ($cat[$GLOBALS["tCYSApDKjdVXwbzQIJxw"]] != -1)
            {
                if(isset($cats[$cat[$GLOBALS["tCYSApDKjdVXwbzQIJxw"]]]))
                {
                    $cats[$cat[$GLOBALS["tCYSApDKjdVXwbzQIJxw"]]][$GLOBALS["TOeAMkZYbiIeTLssrRUI"]] += intval($cat[$GLOBALS["TOeAMkZYbiIeTLssrRUI"]]);
                }
            }
        }
        $pcount = sizeof($newPids);

        while ($pcount > 1 && $count != $pcount)
        {
                        $count = $pcount;
            $pids = array();
            foreach ($parents as $key => &$parent)
            {
                if (!isset($newPids[$key]))
                {
                    if ($parent[$GLOBALS["tCYSApDKjdVXwbzQIJxw"]] != -1) {
                        $parents[$parent[$GLOBALS["tCYSApDKjdVXwbzQIJxw"]]][$GLOBALS["TOeAMkZYbiIeTLssrRUI"]] += intval($parent[$GLOBALS["TOeAMkZYbiIeTLssrRUI"]]);
                    }
                    unset($parents[$key]);
                }
                else
                {
                    $pids[$parent[$GLOBALS["tCYSApDKjdVXwbzQIJxw"]]] = true;
                }
            }
            $pcount = sizeof($pids);
            $newPids = $pids;
        }
    }

    
    private function getProductQuantity(&$categories, $root)
    {
        foreach ($categories as $cid => &$category)
        {
            $root->id = $cid;
            $category[$GLOBALS["TCmEhPtemzjJFgIZboSA"]] = $root->getProducts($this->context->cookie->id_lang, 1, 10, null, null, true);
        }
    }
}
 ?>