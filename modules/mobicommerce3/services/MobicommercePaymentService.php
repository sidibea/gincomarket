<?php
$GLOBALS["HaufuVAxVoaTslmTgrOO"]=base64_decode("bXVsdGlzYWZlcGF5Y29ubmVjdA==");$GLOBALS["VEanVKYwoCQTAjCaCRaK"]=base64_decode("cGF5ZmFzdA==");$GLOBALS["gpSloVyXJrFWGoULOpVv"]=base64_decode("cGF5Zm9ydGZvcnQ=");$GLOBALS["MuhyBFGnPIXGZVGLHwPO"]=base64_decode("cHdhcHJlc3Rh");$GLOBALS["bnzybcikxbXsUSuyJKzu"]=base64_decode("ZWJz");$GLOBALS["NPZfGRGESLFNPRRaZwuS"]=base64_decode("cmVkc3lz");$GLOBALS["rxqmfrHuCErQKAHBLQbI"]=base64_decode("YmFua3dpcmV0aGFp");$GLOBALS["LSeSlYrYqgLLIcpbuRtH"]=base64_decode("c2V0Y29taGY=");$GLOBALS["rOKlWIKttKgmNVzEGp"]=base64_decode("c2lk");$GLOBALS["vCTotafbFpidfulCqwec"]=base64_decode("a3Rj");$GLOBALS["OlEnKVMIImzgVttQvUQ"]=base64_decode("bXltb2RwYXltZW50");$GLOBALS["PZkCpdJkaAoatdHlKVfY"]=base64_decode("cGF5cGFsdXNh");$GLOBALS["aSNzZzmtFTEdrlVXCSqG"]=base64_decode("cGF5cGFsd2l0aGZlZQ==");$GLOBALS["AvpWRgjbjjVvBFnFfcdK"]=base64_decode("cGF5cGFs");$GLOBALS["gGCaCOhxIZfWbvunttw"]=base64_decode("ZG10YmFua3M=");$GLOBALS["LqwgUBzUYfSaEUJGKJmP"]=base64_decode("YmFua21lbGxhdA==");$GLOBALS["AxBdgkljbonuWFVPxcGI"]=base64_decode("OQ==");$GLOBALS["BBZVtquvUYezndIHBQLN"]=base64_decode("cGFyc2lhbnBheW1lbnQ=");$GLOBALS["NaOCnpLqzUyskMYplDTo"]=base64_decode("Y2NhdmVudWU=");$GLOBALS["dyHJGSObcnDMVaDRQttD"]=base64_decode("cGF5dG0=");$GLOBALS["BWrJUkJUnXlOPWYJJhRw"]=base64_decode("cGF5dQ==");$GLOBALS["iVlXiAPBGSyqoTmJwgrc"]=base64_decode("c2F0aXNwYXk=");$GLOBALS["jONNVKAdJlCKHqOYVstI"]=base64_decode("Y2FzaG9uZGVsaXZlcnk=");$GLOBALS["bGNfnGTTSyRoNZylFcpw"]=base64_decode("Y2hlcXVl");$GLOBALS["rViTRjnGPwejFkKVinOL"]=base64_decode("MTg=");$GLOBALS["DMLzIAqFjqJiovjkaaql"]=base64_decode("YmFua3dpcmU=");$GLOBALS["OCuzcVUnsHaUWMoPgysJ"]=base64_decode("Q09EX0ZFRUZSRUU=");$GLOBALS["dUORbMGCXfUflIFqSbYP"]=base64_decode("Q09EX0ZFRQ==");$GLOBALS["RBeKggdezLAmIhDllqIg"]=base64_decode("UFNfT1NfQ0FOQ0VMRUQ=");$GLOBALS["OBwhOPCZZFqJpwbucdqY"]=base64_decode("X1BTX09TX0NBTkNFTEVEXw==");$GLOBALS["ZeDpKFPGJMoILGYOQZCc"]=base64_decode("UFNfT1NfUkVGVU5E");$GLOBALS["sHoglsZWekgutYoMzYBb"]=base64_decode("X1BTX09TX1JFRlVORF8=");$GLOBALS["lcjAeByFNSNQxeAwGOJu"]=base64_decode("X1BTX09TX1BSRVBBUkFUSU9OXw==");$GLOBALS["kyzKeMmplzqCMgVFIrLg"]=base64_decode("b3JkZXJfc3RhdGU=");$GLOBALS["BfGWNPxPdUGSjWuCvmXz"]=base64_decode("PGJyPg==");$GLOBALS["rHtXijWraoKSqpZJICkc"]=base64_decode("c3VjY2VlZA==");$GLOBALS["onjOOTlbgbkczwvdWoMH"]=base64_decode("Y29kZmVl");$GLOBALS["rULGlTcKFZhhqbhSGQYl"]=base64_decode("cGF5bWVudF9tZXRob2RfbmFtZQ==");$GLOBALS["notVClTHmAcmOgmjtzHe"]=base64_decode("UFNfT1Nf");$GLOBALS["dXhNzziEFocJhQCboxSN"]=base64_decode("RnJlZSBvcmRlcg==");$GLOBALS["tugkmwKQmrdyfghQnRJj"]=base64_decode("");$GLOBALS["QdqDtRYIQLPzBmOCtWO"]=base64_decode("cGF5bWVudF9yZXZpZXc=");$GLOBALS["xQLgWgmnELxxgADyEYUJ"]=base64_decode("aG9sZGVk");$GLOBALS["TKKaTjRezleCFXbXFRTo"]=base64_decode("Y2FuY2VsZWQ=");$GLOBALS["dXFqZlRcEWgAIlZoZTXU"]=base64_decode("Y2xvc2Vk");$GLOBALS["bnLlGksIUMlLhcTlSCZo"]=base64_decode("Y29tcGxldGU=");$GLOBALS["XhHmmdtAFDpAEXYjqTwC"]=base64_decode("cHJvY2Vzc2luZw==");$GLOBALS["EGSeFHfjquWMNmIMk"]=base64_decode("cGVuZGluZ19wYXltZW50");$GLOBALS["BGMYjdBDZDsDsqHsIdHu"]=base64_decode("bmV3");$GLOBALS["NiGqBRUFAYxFoTUyIjYT"]=base64_decode("ZnJlZV9vcmRlcg==");$GLOBALS["JNiSfXCiEfLEKOdFdbgG"]=base64_decode("UFNfT1NfUFJFUEFSQVRJT04=");$GLOBALS["deussBEzAYEsfQsubkes"]=base64_decode("UFNfT1NfRVJST1I=");$GLOBALS["rPTszJGkKehcQXSFEViH"]=base64_decode("X1BTX09TX0VSUk9SXw==");$GLOBALS["eSYUgUYbuAgmCKOjHMNE"]=base64_decode("UFNfT1NfUEFZTUVOVA==");$GLOBALS["drJTMkuNfrlPMiDXwcRg"]=base64_decode("X1BTX09TX1BBWU1FTlRf");$GLOBALS["gATadadzyXwdXqhoKLQ"]=base64_decode("UFNfT1NfQ0hFUVVF");$GLOBALS["ZiWUQWSStcaYnsZiBspe"]=base64_decode("X1BTX09TX0NIRVFVRV8=");$GLOBALS["hpiMIVWpqGZYoZBDlcRk"]=base64_decode("Y29kZmVl");$GLOBALS["pcNyPFUvjcSXlldcYSPB"]=base64_decode("Y2FzaG9uZGVsaXZlcnlwbHVz");$GLOBALS["gqQTguQVvHzRNfFxSvMU"]=base64_decode("Y2FzaG9uZGVsaXZlcnk=");
?><?php




defined($GLOBALS["ZiWUQWSStcaYnsZiBspe"]) || define($GLOBALS["ZiWUQWSStcaYnsZiBspe"], Configuration::get($GLOBALS["gATadadzyXwdXqhoKLQ"]));
defined($GLOBALS["drJTMkuNfrlPMiDXwcRg"]) || define($GLOBALS["drJTMkuNfrlPMiDXwcRg"], Configuration::get($GLOBALS["eSYUgUYbuAgmCKOjHMNE"]));
defined($GLOBALS["rPTszJGkKehcQXSFEViH"]) || define($GLOBALS["rPTszJGkKehcQXSFEViH"], Configuration::get($GLOBALS["deussBEzAYEsfQsubkes"]));
defined($GLOBALS["JNiSfXCiEfLEKOdFdbgG"]) || define($GLOBALS["JNiSfXCiEfLEKOdFdbgG"], Configuration::get($GLOBALS["JNiSfXCiEfLEKOdFdbgG"]));

class FreeOrder extends PaymentModule
{
    public $active = 1;
    public $name = 'free_order';
    public $displayName = 'free_order';
}

class MobicommercePaymentService extends PaymentModule
{
    const STATE_NEW = $GLOBALS["BGMYjdBDZDsDsqHsIdHu"];
    const STATE_PENDING_PAYMENT = $GLOBALS["EGSeFHfjquWMNmIMk"];
    const STATE_PROCESSING = $GLOBALS["XhHmmdtAFDpAEXYjqTwC"];
    const STATE_COMPLETE = $GLOBALS["bnLlGksIUMlLhcTlSCZo"];
    const STATE_CLOSED = $GLOBALS["dXFqZlRcEWgAIlZoZTXU"];
    const STATE_CANCELED = $GLOBALS["TKKaTjRezleCFXbXFRTo"];
    const STATE_HOLDED = $GLOBALS["xQLgWgmnELxxgADyEYUJ"];
    const STATE_PAYMENT_REVIEW = $GLOBALS["QdqDtRYIQLPzBmOCtWO"];

    public function __construct() {
        parent::__construct();
        $this->active = true;
    }

    
    public function placeOrder($method, $message = '')
    {
        if ($this->context->cart->getOrderTotal() <= 0)
        {
            $order = new FreeOrder();
            $order->free_order_class = true;
            $order->validateOrder($this->context->cart->id, Configuration::get($GLOBALS["eSYUgUYbuAgmCKOjHMNE"]), 0, Tools::displayError($GLOBALS["dXhNzziEFocJhQCboxSN"], false), null, array(), null, false, $this->context->cart->secure_key);
            $order_id = (int)Order::getOrderByCartId($this->context->cart->id);
            $order = new Order($order_id);
        }
        else
        {
            $id_cart = $this->context->cookie->id_cart;
            if(in_array($method, array("cashondelivery", "cashondeliveryplus")))
            {
                $id_order_state = PS_OS_PREPARATION;
                $id_order_state_string = $GLOBALS["JNiSfXCiEfLEKOdFdbgG"];
            }
            else if($id_order_state = Configuration::get($GLOBALS["notVClTHmAcmOgmjtzHe"].strtoupper($method))){
                $id_order_state_string = $GLOBALS["notVClTHmAcmOgmjtzHe"].strtoupper($method);
            }
            else
            {
                $id_order_state = _PS_OS_CHEQUE_;
                $id_order_state_string = $GLOBALS["gATadadzyXwdXqhoKLQ"];
            }

            if(in_array($method, array("codfee"))){
                $id_order_state_string = $GLOBALS["JNiSfXCiEfLEKOdFdbgG"];
            }

            $extraVars = array();
            $amountPaid = (float) (Tools::ps_round((float) ($this->context->cart->getOrderTotal(true, BOTH)), 2));
            $total = $this->context->cart->getOrderTotal(true, Cart::BOTH);
            
            $method = Tools::getValue($GLOBALS["rULGlTcKFZhhqbhSGQYl"], $method);
            $this->name = $method;
            
                        if(Module::isInstalled($method)){
                $customer = new Customer((int)$this->context->cart->id_customer);
                $total = $this->context->cart->getOrderTotal(true, Cart::BOTH)+ Tools::convertPrice($this->getDobirecne());
                $this->module = Module::getInstanceByName($method);
                if($method == $GLOBALS["onjOOTlbgbkczwvdWoMH"]) {
                    $cashOnDelivery = new CodFee();
                    $fee = (float)Tools::ps_round((float)$cashOnDelivery->getFeeCost($this->context->cart), 2);

                    $result = $this->module->validateOrder16((int)$this->context->cart->id, Configuration::get($id_order_state_string), $total, $fee, $this->module->displayName, null, array(), null, false, $customer->secure_key);
                }
                else
                {
                    $result = $this->module->validateOrder((int)$this->context->cart->id, Configuration::get($id_order_state_string), $total, $this->module->displayName, null, array(), null, false, $customer->secure_key);
                }
                $this->currentOrder = $this->module->currentOrder;
            }
            else{
                $result = $this->validateOrder($id_cart, $id_order_state, $total, $method, $message, $extraVars, NULL, false, $this->context->cart->secure_key);
            }
            
            if ($result === true) {
                unset($this->context->cookie->id_cart);
                unset($this->context->cookie->id_order);
                $order = new Order($this->currentOrder);
            }
            return array($result, $order, NULL);
        }
    }

    public function mobicommercePaymentDone($order_id, $custom_kc_comments, $payment_status)
    {
        $status = (Tools::strtolower($payment_status) == $GLOBALS["rHtXijWraoKSqpZJICkc"]) ? $this->getOrderState() : _PS_OS_ERROR_;
        $orderHistory = new OrderHistory();
        $orderHistory->id_order = (int) ($order_id);
        $orderHistory->changeIdOrderState($status, $order_id);
        $orderHistory->addWithemail();
        $msg = new Message();
        $message = strip_tags($custom_kc_comments, $GLOBALS["BfGWNPxPdUGSjWuCvmXz"]);
        if (Validate::isCleanHtml($message)) {
            $msg->message = $message;
            $msg->id_order = intval($order_id);
            $msg->private = 1;
            $msg->add();
        }
        $order = new Order($order_id);
        return array(TRUE, $order);
    }

    private function getOrderState()
    {
        if (!isset($_POST[$GLOBALS["kyzKeMmplzqCMgVFIrLg"]])) {
            return _PS_OS_PAYMENT_;
        }

        $order_status_id = _PS_OS_PAYMENT_;
        switch ($_POST[$GLOBALS["kyzKeMmplzqCMgVFIrLg"]]) {
            case self::STATE_NEW:
                $order_status_id = defined($GLOBALS["lcjAeByFNSNQxeAwGOJu"]) ? _PS_OS_PREPARATION_ : Configuration::get($GLOBALS["JNiSfXCiEfLEKOdFdbgG"]);
                break;
            case self::STATE_HOLDED:
                $order_status_id = _PS_OS_CHEQUE_;
                break;
            case self::STATE_PAYMENT_REVIEW:
                $order_status_id = defined($GLOBALS["sHoglsZWekgutYoMzYBb"]) ? _PS_OS_REFUND_ : Configuration::get($GLOBALS["ZeDpKFPGJMoILGYOQZCc"]);
                break;
            case self::STATE_PENDING_PAYMENT:
                $order_status_id = defined($GLOBALS["lcjAeByFNSNQxeAwGOJu"]) ? _PS_OS_PREPARATION_ : Configuration::get($GLOBALS["JNiSfXCiEfLEKOdFdbgG"]);
                break;
            case self::STATE_CANCELED:
                $order_status_id = defined($GLOBALS["OBwhOPCZZFqJpwbucdqY"]) ? _PS_OS_CANCELED_ : Configuration::get($GLOBALS["RBeKggdezLAmIhDllqIg"]);
                break;
            default:
                break;
        }

        return $order_status_id;
    }

    public function getDobirecne()
    {
        $dobirecne=Configuration::get($GLOBALS["dUORbMGCXfUflIFqSbYP"]);
        if( Configuration::get($GLOBALS["OCuzcVUnsHaUWMoPgysJ"]) > 0 
        && $this->context->cart->getOrderTotal(false, Cart::BOTH_WITHOUT_SHIPPING) > Tools::convertPrice(Configuration::get($GLOBALS["OCuzcVUnsHaUWMoPgysJ"]))  ) 
        $dobirecne=0;

        return $dobirecne;
    }

    public function getPaymentMethods()
    {
        $methods = array(
            'bankwire'            => '18',
            'cheque'              => '18',
            'cashondelivery'      => '18',
            'satispay'            => '18',
            'codfee'              => '18',
            'payu'                => '18',
            'paytm'               => '18',
            'ccavenue'            => '18',

            'parsianpayment'      => '9',
            'bankmellat'          => '9',
            'dmtbanks'            => '9',
            'paypal'              => '9',
            'paypalwithfee'       => '9',
            'paypalusa'           => '9',
            'mymodpayment'        => '9',
            'ktc'                 => '9',
            'sid'                 => '9',
            'setcomhf'            => '9',
            'bankwirethai'        => '9',
            'redsys'              => '9',
            'ebs'                 => '9',
            'pwapresta'           => '9',
            'payfortfort'         => '9',
            'payfast'             => '9',
            'multisafepayconnect' => '9',
                        );

        return $methods;
    }

    public function getExternalPaymentMethods()
    {
        $external_methods = array();
        $methods = $this->getPaymentMethods();
        foreach($methods as $_method_key => $_method_value)
        {
            if($_method_value == $GLOBALS["AxBdgkljbonuWFVPxcGI"])
            {
                $external_methods[] = $_method_key;
            }
        }

        return $external_methods;
    }

    public function getType18PaymentMethods()
    {
        $external_methods = array();
        $methods = $this->getPaymentMethods();
        foreach($methods as $_method_key => $_method_value)
        {
            if($_method_value == $GLOBALS["rViTRjnGPwejFkKVinOL"])
            {
                $external_methods[] = $_method_key;
            }
        }

        return $external_methods;   
    }
}
 ?>