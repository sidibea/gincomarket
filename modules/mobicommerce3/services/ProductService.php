<?php
$GLOBALS["sxVALmpUOyAaYsrTXikR"]=base64_decode("Y2F0ZWdvcnk=");$GLOBALS["heyzirTAWsKLGFYlseYV"]=base64_decode("bWFudWZhY3R1cmVy");$GLOBALS["KEIaVoEwhIoBCMBsuRaf"]=base64_decode("cXVhbnRpdHk=");$GLOBALS["ELkdWnXntlzZoMeKYinU"]=base64_decode("LQ==");$GLOBALS["ZJSkWhiMcPEyCZoVipbq"]=base64_decode("bGF5ZXJlZF9wcmljZV9zbGlkZXI=");$GLOBALS["qcAqdRoXyOjMSzAvwpOV"]=base64_decode("b3B0aW9ucw==");$GLOBALS["TNjUIwvUCKYoazJgtXiI"]=base64_decode("dmFsdWU=");$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]=base64_decode("aWRfYXR0cmlidXRlX2dyb3Vw");$GLOBALS["NabgjNPDctussDPXNRUG"]=base64_decode("bmJy");$GLOBALS["TOeAMkZYbiIeTLssrRUI"]=base64_decode("Y291bnQ=");$GLOBALS["lxoFhxKCKHGNMufzSYFR"]=base64_decode("dmFsdWVz");$GLOBALS["PlMIiOdaIwcSLByTwLpK"]=base64_decode("bWF4");$GLOBALS["mADcDrPgLtOqLDssenuj"]=base64_decode("bWlu");$GLOBALS["fcoPzIuYMjbtOJqsdHcU"]=base64_decode("Y29kZQ==");$GLOBALS["BoWuBfavKqJxeLgCuLA"]=base64_decode("bmFtZQ==");$GLOBALS["UWIPgjxFofMMrcoIwgFn"]=base64_decode("bGFiZWw=");$GLOBALS["fKTXsjNQxdbqgCPznas"]=base64_decode("aWRfa2V5");$GLOBALS["rojWvnbZNAUBRjTQLXdg"]=base64_decode("Xw==");$GLOBALS["ZjwliCMiZSKhlhLkVtKM"]=base64_decode("YXR0cmlidXRlQ29kZVByZXN0YQ==");$GLOBALS["xTfpcXyoLrWHKltgxtwp"]=base64_decode("YXR0cmlidXRlQ29kZQ==");$GLOBALS["IXCfKzsjlitrRiMXFvE"]=base64_decode("cHJpY2U=");$GLOBALS["rwOdVnTfQGAaYrmsMgnw"]=base64_decode("aWRfZmVhdHVyZQ==");$GLOBALS["kqpjokinrNKzMlmecrBs"]=base64_decode("dHlwZQ==");$GLOBALS["HJmzCwDFmrPlYNjDNdNx"]=base64_decode("Z2V0RmlsdGVyQmxvY2s=");$GLOBALS["ebKuPojsdYSIHbPwRrnc"]=base64_decode("ZmlsdGVy");$GLOBALS["gqUkshCPBHNgtvQKvOmi"]=base64_decode("aXNfbnVtZXJpYw==");$GLOBALS["TBjDJzTpaHcBKQPltydk"]=base64_decode("dG90YWw=");$GLOBALS["CRQpWQYoLFgmEBkPiPtV"]=base64_decode("cmVzdWx0");$GLOBALS["UNHLRQjKDApiNBPXTsxf"]=base64_decode("LygoXCU1QzArKXwoXCUwMCspKS9p");$GLOBALS["FmsmCLGVKsoCmyXhNvoA"]=base64_decode("d2F5");$GLOBALS["ZOaBCHzuIJytqixndAeX"]=base64_decode("Ynk=");$GLOBALS["LBfAzvjUtWQQRrkhtJhF"]=base64_decode("Y2F0ZWdvcnlfcHJvZHVjdGAgY3AgT04gKHAuYGlkX3Byb2R1Y3RgID0gY3AuYGlkX3Byb2R1Y3RgKSBXSEVSRSAgcC5gYWN0aXZlYCA9IDE=");$GLOBALS["LOeFCPHzrTTPkDSGMRcf"]=base64_decode("cHJvZHVjdGAgcCBMRUZUIEpPSU4gYA==");$GLOBALS["oPyNfqENDivKwQYswJjh"]=base64_decode("U0VMRUNUIENPVU5UKCopIEZST00gYA==");$GLOBALS["nwFxWnitsoFmbnefTsst"]=base64_decode("Iik=");$GLOBALS["spxQSGQYAYqOrRwBhwiS"]=base64_decode("Iiwi");$GLOBALS["eSxJGxcZjnltLttFw"]=base64_decode("cHJvZHVjdGAgcCBXSEVSRSAgcC5gYWN0aXZlYCA9IDEgQU5EIHAuYGlkX3Byb2R1Y3RgIElOICgi");$GLOBALS["hzMetJoqSYOLqwAPnDeO"]=base64_decode("U0VMRUNUICogRlJPTSBg");$GLOBALS["lRBzvzBSEQkJxdBItbg"]=base64_decode("LA==");$GLOBALS["WNXmzzfNZszboJLOODGi"]=base64_decode("c2FsZXM=");$GLOBALS["DjUOEdOspWINrMCJaQyk"]=base64_decode("d2lkZ2V0X3R5cGU=");$GLOBALS["ZNJRtVzCHKSNXCxJfQc"]=base64_decode("Z2V0UHJvZHVjdHM=");$GLOBALS["jfzoVJZLAlfcuCZEarPc"]=base64_decode("YmxvY2tsYXllcmVk");$GLOBALS["qXKFiqnhJPaOZFDNYEMo"]=base64_decode("UHJvZHVjdFRyYW5zbGF0b3I=");$GLOBALS["PiAcIEATXlQdiYGIyCLU"]=base64_decode("Y2F0ZWdvcnlfaWQ=");$GLOBALS["UYelJqcbwkBBCZjPoMdk"]=base64_decode("cXVlcnk=");$GLOBALS["bJLMlFdrhZlMfHEKguNo"]=base64_decode("aXNfc3BlY2lhbHM=");$GLOBALS["BqyYELduncgqBkajIVvH"]=base64_decode("cHJvZHVjdHM=");$GLOBALS["RBJbMQCDHxABfRSjHxyJ"]=base64_decode("cHJvZHVjdF9jb3VudA==");$GLOBALS["VtyabxBAjoNAXBjDoqxy"]=base64_decode("ZGF0YQ==");$GLOBALS["tugkmwKQmrdyfghQnRJj"]=base64_decode("");$GLOBALS["lfZwhCoVRiYhvVPBQbEe"]=base64_decode("bWVzc2FnZQ==");$GLOBALS["oqTLpquYVEJTMyjXAtSP"]=base64_decode("ZmlsdGVycw==");$GLOBALS["EuHxvRhklQEZsNJgXMCv"]=base64_decode("cQ==");$GLOBALS["oPIXvArZcPbxJFnHnnjE"]=base64_decode("aXRlbV9pZHM=");$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]=base64_decode("aXRlbXM=");$GLOBALS["USuIzbDLgGoteDmbTgph"]=base64_decode("dG90YWxfcmVzdWx0cw==");$GLOBALS["IILKyemJoIaydIwgZhVM"]=base64_decode("bg==");$GLOBALS["IbEcMnSRttjLeClaMVkR"]=base64_decode("cA==");$GLOBALS["TxKKShAyajUHzxDEYMAz"]=base64_decode("ZGVzYw==");$GLOBALS["UBmkXYiwrwACKcKfPguC"]=base64_decode("c29ydF9vcmRlcg==");$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]=base64_decode("aWRfcHJvZHVjdA==");$GLOBALS["OxQfzBAjtXxSRfdvxcQY"]=base64_decode("c29ydF9ieQ==");$GLOBALS["PPujwNfSSRRCezamCiDr"]=base64_decode("cGFnZV9ubw==");$GLOBALS["nVWeDTWlafDTkpRzvCph"]=base64_decode("cGFnZV9zaXpl");$GLOBALS["vnikmTnwHXDcKJBQNHoK"]=base64_decode("TW9iaWNvbW1lcmNlaGVscGVy");$GLOBALS["PdepTkCacGhHbSYynMub"]=base64_decode("SFRUUC8xLjEgNDA0IE5vdCBGb3VuZA==");$GLOBALS["QIfjBqYCYzCTbgddRxFH"]=base64_decode("SU5fTU9CSUNPTU1FUkNF");$GLOBALS["lhysjbAVbLipeHcOM"]=base64_decode("PQ==");$GLOBALS["SDwDSRHnuHiuPUrxGOHA"]=base64_decode("Jg==");$GLOBALS["MbajDNJRhmMOwGojscvU"]=base64_decode("Xw==");$GLOBALS["VrIktHzGpoHbbHMGmvhk"]=base64_decode("cHJpY2U=");$GLOBALS["lrRdgiojhwFbhSzhvOII"]=base64_decode("c2VsZWN0");$GLOBALS["xzjLzLOrSakQGzBbeLSQ"]=base64_decode("c3BlY2lmaWNfcHJpY2Vg");$GLOBALS["hmBTUYLLOwAehDWtFApy"]=base64_decode("U0VMRUNUIGNvdW50KCopIGNvdW50IEZST00gYA==");$GLOBALS["SnsSSwMKZSYeMFnEirnh"]=base64_decode("");$GLOBALS["JDfeyGDbvUQucHiTMHyj"]=base64_decode("LCA=");$GLOBALS["XlWyhAilwlLoBzFYRunn"]=base64_decode("c3BlY2lmaWNfcHJpY2VgCgkJCUxJTUlUIA==");$GLOBALS["DxzZzECGQJEBgwLNJo"]=base64_decode("CgkJCVNFTEVDVCBgaWRfcHJvZHVjdGAKCQkJRlJPTSBg");$GLOBALS["vGWCEfsXeENwUTnXwFgV"]=base64_decode("bmV3YXJyaXZhbHM=");$GLOBALS["FLzWMdhniFRFqDLDZQEi"]=base64_decode("cHJvZHVjdHZpZXdlZA==");$GLOBALS["tpWeaCeaTwltJaZfqEqQ"]=base64_decode("YmVzdHNlbGxlcg==");
?><?php


if (!defined($GLOBALS["QIfjBqYCYzCTbgddRxFH"])) {
    header($GLOBALS["PdepTkCacGhHbSYynMub"]);
    die();
}

class ProductService extends BaseService
{
    public function __construct()
    {
        parent::__construct();
        ServiceFactory::factory($GLOBALS["vnikmTnwHXDcKJBQNHoK"])->autoLoginMobileUser();
    }

    private function setDefaultFilterIfNeed(&$filter)
    {
        if (!$filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]]) {
            $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]] = 10;
        }
        if (!$filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]]) {
            $filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] = 1;
        }
        if (!$filter[$GLOBALS["OxQfzBAjtXxSRfdvxcQY"]]) {
            $filter[$GLOBALS["OxQfzBAjtXxSRfdvxcQY"]] = $GLOBALS["hqzNeHAWOwqfUZHIwuEa"];
        }
        if (!$filter[$GLOBALS["UBmkXYiwrwACKcKfPguC"]]) {
            $filter[$GLOBALS["UBmkXYiwrwACKcKfPguC"]] = $GLOBALS["TxKKShAyajUHzxDEYMAz"];
        }
        
        $filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] = Tools::getValue($GLOBALS["IbEcMnSRttjLeClaMVkR"], $filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]]);
        $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]] = Tools::getValue($GLOBALS["IILKyemJoIaydIwgZhVM"], $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]]);
    }
    
    
    public function searchProducts($filter)
    {
        $this->setDefaultFilterIfNeed($filter);
        $products = array('total_results' => 0, 'items' => array());
        if (isset($filter[$GLOBALS["oPIXvArZcPbxJFnHnnjE"]]) && !empty($filter[$GLOBALS["oPIXvArZcPbxJFnHnnjE"]]))
        {
            $products = $this->getSpecifiedProducts($filter);
        }
        else if (isset($filter[$GLOBALS["EuHxvRhklQEZsNJgXMCv"]]) && $filter[$GLOBALS["EuHxvRhklQEZsNJgXMCv"]])
        {
            $products = $this->getProductsByQuery($filter);
        } 

        $returnResult[$GLOBALS["oqTLpquYVEJTMyjXAtSP"]] = array(
            'message' => '',
            'data'    => array()
            );
        $returnResult[$GLOBALS["RBJbMQCDHxABfRSjHxyJ"]] = count($products[$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]]);
        if(isset($products[$GLOBALS["USuIzbDLgGoteDmbTgph"]])){
            $returnResult[$GLOBALS["RBJbMQCDHxABfRSjHxyJ"]] = $products[$GLOBALS["USuIzbDLgGoteDmbTgph"]];
        }
        $returnResult[$GLOBALS["BqyYELduncgqBkajIVvH"]] = $products[$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]];
        
        return $returnResult;
    }
    
    
    public function getProducts($filter)
    {
        $this->setDefaultFilterIfNeed($filter);
        $products = array('total_results' => 0, 'items' => array());
        if (isset($filter[$GLOBALS["oqTLpquYVEJTMyjXAtSP"]]) && !empty($filter[$GLOBALS["oqTLpquYVEJTMyjXAtSP"]])) {
            $products = $this->getProductFilterbased($filter);
        } else if (isset($filter[$GLOBALS["bJLMlFdrhZlMfHEKguNo"]]) && intval($filter[$GLOBALS["bJLMlFdrhZlMfHEKguNo"]])) {
            $products = $this->getSpecialProducts($filter);
        } else if (isset($filter[$GLOBALS["UYelJqcbwkBBCZjPoMdk"]]) && $filter[$GLOBALS["UYelJqcbwkBBCZjPoMdk"]]) {
            $products = $this->getProductsByQuery($filter);
        } else {
            $products = $this->getProductsByCategory($filter, $filter[$GLOBALS["PiAcIEATXlQdiYGIyCLU"]]);
        }
        $returnResult = array();
        $returnResult['products'] = $products['items'] ? $products['items'] : array();
        
                $returnResult['filters'] = array(
            'message' => '',
            'data'    => $this->getProductFilters($filter)
            );
        $returnResult[$GLOBALS["RBJbMQCDHxABfRSjHxyJ"]] = count($products[$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]]);
        if(isset($products[$GLOBALS["USuIzbDLgGoteDmbTgph"]])){
            $returnResult[$GLOBALS["RBJbMQCDHxABfRSjHxyJ"]] = $products[$GLOBALS["USuIzbDLgGoteDmbTgph"]];
        }
                
        return $returnResult;
    }
    
    public function getProductFilterbased($filter)
    {
        $proudctTranslator = ServiceFactory::factory($GLOBALS["qXKFiqnhJPaOZFDNYEMo"]);
        $selectedFilter = $this->convertFilterArray($filter[$GLOBALS["oqTLpquYVEJTMyjXAtSP"]]);
                        $module_name = $GLOBALS["jfzoVJZLAlfcuCZEarPc"];
        $_nb_products = 0;
        if (Module::isInstalled($module_name) && Module::isEnabled($module_name))
        {
            $mod = Module::getInstanceByName($module_name);
            if (method_exists($mod, $GLOBALS["ZNJRtVzCHKSNXCxJfQc"]))
                $mod->getProducts($selectedFilter,$search, $_nb_products);
        }
        foreach ($search as $row) {
            $proudctTranslator->clear();
            $proudctTranslator->setProduct($row);
            $products[$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]][] = $proudctTranslator->getListingItemInfo();
        }
        $products [$GLOBALS["USuIzbDLgGoteDmbTgph"]] = $_nb_products;
        return $products;
    }
    
    
    public function getProductsByCategory($filter)
    {
        $categoryId = $filter[$GLOBALS["PiAcIEATXlQdiYGIyCLU"]];
        $proudctTranslator = ServiceFactory::factory($GLOBALS["qXKFiqnhJPaOZFDNYEMo"]);

        if ($categoryId > 0) {
            $category = new Category($categoryId, $this->context->cookie->id_lang);
            $rows = $category->getProducts($this->context->cookie->id_lang, $filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]], $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]], $filter[$GLOBALS["OxQfzBAjtXxSRfdvxcQY"]], $filter[$GLOBALS["UBmkXYiwrwACKcKfPguC"]], false);
            $total = $category->getProducts($this->context->cookie->id_lang, $filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]], $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]], $filter[$GLOBALS["OxQfzBAjtXxSRfdvxcQY"]], $filter[$GLOBALS["UBmkXYiwrwACKcKfPguC"]], true);
        } else if($filter[$GLOBALS["DjUOEdOspWINrMCJaQyk"]] == $GLOBALS["tpWeaCeaTwltJaZfqEqQ"]) {
            $rows = ProductSale::getBestSales($this->context->language->id, ($filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] - 1), $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]], $GLOBALS["WNXmzzfNZszboJLOODGi"], $filter[$GLOBALS["UBmkXYiwrwACKcKfPguC"]]);
            $total = count($rows);
                    }
        
        else if($filter[$GLOBALS["DjUOEdOspWINrMCJaQyk"]] == $GLOBALS["FLzWMdhniFRFqDLDZQEi"]) {
            $productsViewed = (isset($this->context->cookie->viewed) && !empty($this->context->cookie->viewed)) ? array_slice(array_reverse(explode(',', $this->context->cookie->viewed)), ($filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] - 1), $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]]) : array();

            if (count($productsViewed))
            {
                $result_with_product_id = array();
                $rows = array();
                
                $result = Db::getInstance(_PS_USE_SQL_SLAVE_)->executeS($GLOBALS["hzMetJoqSYOLqwAPnDeO"] . _DB_PREFIX_ . $GLOBALS["eSxJGxcZjnltLttFw"].implode($GLOBALS["spxQSGQYAYqOrRwBhwiS"], $productsViewed).$GLOBALS["nwFxWnitsoFmbnefTsst"]);
                foreach($result as $_result) {
                    $result_with_product_id[$_result[$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]]] = $_result;
                }

                foreach($productsViewed as $_viewed) {
                    if(isset($result_with_product_id[$_viewed])) {
                        $rows[] = $result_with_product_id[$_viewed];
                    }
                }
                $total = count($rows);
            }
            else
            {
                $rows = array();
                $total = 0;
            }
                    }
        
        else if($filter['widget_type'] == "newarrivals") {
            $rows = Product::getNewProducts($this->context->cookie->id_lang, ($filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] - 1), $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]]);
            $total = count($rows);
                    } else {
            $start = max(($filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] - 1) * $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]], 0);
            $rows = Product::getProducts($this->context->cookie->id_lang, $start, $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]], $filter[$GLOBALS["OxQfzBAjtXxSRfdvxcQY"]], $filter[$GLOBALS["UBmkXYiwrwACKcKfPguC"]], false, true);
            $total = Db::getInstance(_PS_USE_SQL_SLAVE_)->getValue($GLOBALS["oPyNfqENDivKwQYswJjh"] . _DB_PREFIX_ . $GLOBALS["LOeFCPHzrTTPkDSGMRcf"] . _DB_PREFIX_ . $GLOBALS["LBfAzvjUtWQQRrkhtJhF"]);
        }

        $products = array();
        $products['items'] = array();
        foreach ($rows as $row) {
            $proudctTranslator->clear();
            $proudctTranslator->setProduct($row);
            $products[$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]][] = $proudctTranslator->getListingItemInfo();
        }
        $products[$GLOBALS["USuIzbDLgGoteDmbTgph"]] = $total;
        return $products;
    }

    
    public function getProductsByQuery($filter)
    {
        if (is_null($filter[$GLOBALS["EuHxvRhklQEZsNJgXMCv"]]))
        {
            return array('total_results' => 0, 'items' => array());
        }

        $orderBy = Tools::getProductsOrder($GLOBALS["ZOaBCHzuIJytqixndAeX"], $filter[$GLOBALS["OxQfzBAjtXxSRfdvxcQY"]]);
        $orderWay = Tools::getProductsOrder($GLOBALS["FmsmCLGVKsoCmyXhNvoA"], $filter[$GLOBALS["UBmkXYiwrwACKcKfPguC"]]);
        $query = Tools::stripslashes(urldecode(preg_replace($GLOBALS["UNHLRQjKDApiNBPXTsxf"], $GLOBALS["tugkmwKQmrdyfghQnRJj"], urlencode($filter[$GLOBALS["EuHxvRhklQEZsNJgXMCv"]]))));
        
        $search = Search::find($this->context->cookie->id_lang, $query, $filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]], $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]], $orderBy, $orderWay);
        
        $proudctTranslator = ServiceFactory::factory($GLOBALS["qXKFiqnhJPaOZFDNYEMo"]);

        $products = array('items' => array(), 'total_results' => 0);

        foreach ($search[$GLOBALS["CRQpWQYoLFgmEBkPiPtV"]] as $row) {
            $proudctTranslator->clear();
            $proudctTranslator->setProduct($row);
                                                            $products[$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]][] = $proudctTranslator->getListingItemInfo();
        }
        $products[$GLOBALS["USuIzbDLgGoteDmbTgph"]] = $search[$GLOBALS["TBjDJzTpaHcBKQPltydk"]];
        return $products;
    }

    
    public function getSpecialProducts($filter)
    {
        $pageNo = ($filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] - 1 < 0 ? 0 : $filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] - 1) * $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]];

        $db = DB::getInstance();
        $resource = $db->ExecuteS($GLOBALS["DxzZzECGQJEBgwLNJo"] . _DB_PREFIX_ . $GLOBALS["XlWyhAilwlLoBzFYRunn"].$pageNo.$GLOBALS["JDfeyGDbvUQucHiTMHyj"].$filter['page_size'].$GLOBALS["SnsSSwMKZSYeMFnEirnh"], false);
        $count = $db->getValue($GLOBALS["hmBTUYLLOwAehDWtFApy"] . _DB_PREFIX_ . $GLOBALS["xzjLzLOrSakQGzBbeLSQ"]);

        $productTranslator = ServiceFactory::factory($GLOBALS["qXKFiqnhJPaOZFDNYEMo"]);
        while ($row = $db->nextRow($resource)) {
            $productTranslator->clear();
            $productTranslator->loadProductById($row[$GLOBALS["hqzNeHAWOwqfUZHIwuEa"]]);
                                                            $items[] = $proudctTranslator->getListingItemInfo();
        }
        $returnResult[$GLOBALS["USuIzbDLgGoteDmbTgph"]] = $count;
        $returnResult[$GLOBALS["uVuEDCLjTSQjNtEpPTGN"]] = $items;

        return $returnResult;
    }

    
    public function getSpecifiedProducts($filter)
    {
        if (!is_array($filter[$GLOBALS["oPIXvArZcPbxJFnHnnjE"]])) {
            $filter[$GLOBALS["oPIXvArZcPbxJFnHnnjE"]] = explode($GLOBALS["lRBzvzBSEQkJxdBItbg"], $filter[$GLOBALS["oPIXvArZcPbxJFnHnnjE"]]);
        }
        $filter[$GLOBALS["oPIXvArZcPbxJFnHnnjE"]] = array_filter($filter['item_ids'], 'is_numeric');
        $count = count($filter[$GLOBALS["oPIXvArZcPbxJFnHnnjE"]]);
        $start = max(($filter[$GLOBALS["PPujwNfSSRRCezamCiDr"]] - 1) * $filter[$GLOBALS["nVWeDTWlafDTkpRzvCph"]], 0);
        $productIds = array_slice($filter['item_ids'], $start, $filter['page_size']);
        $productTranslator = ServiceFactory::factory($GLOBALS["qXKFiqnhJPaOZFDNYEMo"]);

        $items = array();
        foreach ($productIds as $productId) {
            $productTranslator->loadProductById($productId);
                                                            $items[] = $proudctTranslator->getListingItemInfo();
            $productTranslator->clear();
        }
        $returnResult = array();
        $returnResult['total_results'] = $count;
        $returnResult['items'] = $items;

        return $returnResult;
    }

    public function getProduct($productId)
    {
        if (is_numeric($productId)) {
            $productTranslator = ServiceFactory::factory($GLOBALS["qXKFiqnhJPaOZFDNYEMo"]);
            $productTranslator->loadProductById($productId);
            return $productTranslator->getListingItemInfo();
        }
        return array();
    }
    
    public function getProductFilters($filter)
    {
                        $module_name = $GLOBALS["jfzoVJZLAlfcuCZEarPc"];
        $filters = array();    
        if (Module::isInstalled($module_name) && Module::isEnabled($module_name))
        {
            $mod = Module::getInstanceByName($module_name);
            $selectedFilter = array();
            if(isset($filter['filter']))
                $selectedFilter = $this->convertFilterArray($filter[$GLOBALS["ebKuPojsdYSIHbPwRrnc"]]);
            
            if (method_exists($mod, $GLOBALS["HJmzCwDFmrPlYNjDNdNx"]))
                $filters =  $mod->getFilterBlock($selectedFilter);
        }
        $filterArrayToReturn = array();
        if(isset($filters['filters']))
        {
            foreach($filters[$GLOBALS["oqTLpquYVEJTMyjXAtSP"]] as $filter)
            {
                $type = $filter[$GLOBALS["kqpjokinrNKzMlmecrBs"]];
                if(in_array($type, array('id_feature'))){
                    $type = $GLOBALS["lrRdgiojhwFbhSzhvOII"];
                }
                else if(in_array($type, array('price'))){
                    $type = $GLOBALS["VrIktHzGpoHbbHMGmvhk"];
                }
                else{
                    $type = $GLOBALS["lrRdgiojhwFbhSzhvOII"];
                }

                $f = array();
                $f['attributeCode'] = $filter['type'];
                $f['attributeCodePresta'] = $filter['type'].'_'.$filter['id_key'];
                $f['type'] = $type;
                $f['label'] = $filter['name'];
                $f['code'] = $filter['id_key'];

                if($type == 'price'){
                    $f[$GLOBALS["mADcDrPgLtOqLDssenuj"]] = $filter[$GLOBALS["mADcDrPgLtOqLDssenuj"]];
                    $f[$GLOBALS["PlMIiOdaIwcSLByTwLpK"]] = $filter[$GLOBALS["PlMIiOdaIwcSLByTwLpK"]];
                }
                
                $optionArray = array();
                foreach($filter['values'] as $ok => $o)
                {
                    $option[$GLOBALS["UWIPgjxFofMMrcoIwgFn"]] = $o[$GLOBALS["BoWuBfavKqJxeLgCuLA"]];     
                    $option[$GLOBALS["TOeAMkZYbiIeTLssrRUI"]] = $o[$GLOBALS["NabgjNPDctussDPXNRUG"]];
                    if(in_array($filter[$GLOBALS["kqpjokinrNKzMlmecrBs"]],array($GLOBALS["rwOdVnTfQGAaYrmsMgnw"],$GLOBALS["zUjAKHNVBDYZHHeAvqeH"]))){
                        $option[$GLOBALS["TNjUIwvUCKYoazJgtXiI"]] = $filter[$GLOBALS["fKTXsjNQxdbqgCPznas"]].$GLOBALS["MbajDNJRhmMOwGojscvU"].$ok;
                    }
                    else if(in_array($filter[$GLOBALS["kqpjokinrNKzMlmecrBs"]],array($GLOBALS["IXCfKzsjlitrRiMXFvE"]))) {
                        $option[$GLOBALS["UWIPgjxFofMMrcoIwgFn"]] = $o;
                        $option[$GLOBALS["TNjUIwvUCKYoazJgtXiI"]] = $ok;
                    }
                    else{
                        $option[$GLOBALS["TNjUIwvUCKYoazJgtXiI"]] = $ok;
                    }
                    $optionArray[] = $option; 
                }
                $f[$GLOBALS["qcAqdRoXyOjMSzAvwpOV"]] = $optionArray;
                $filterArrayToReturn[] = $f;   
            }
        }
        return $filterArrayToReturn;
    }
   
    public function convertFilterArray($filters)
    {
        $selectedFilter = array();
        parse_str($filters,$filterArray);
        $filters = explode($GLOBALS["SDwDSRHnuHiuPUrxGOHA"], $filters);
        $filters = array_filter($filters);

        foreach ($filters as $key => $filter) {
            $filterpart = explode($GLOBALS["lhysjbAVbLipeHcOM"],$filter);
            $filter_type = $filterpart[0];
            $filter_value = $filterpart[1];
            if($filter_value){                
                $filter_id = explode($GLOBALS["MbajDNJRhmMOwGojscvU"], $filter_value);
                $filter_id = $filter_id[1];
            }

            if(in_array($filter_type, array('layered_price_slider', 'price'))){
                $filter_type = $GLOBALS["ZJSkWhiMcPEyCZoVipbq"];
                $filter_value = str_replace($GLOBALS["ELkdWnXntlzZoMeKYinU"], $GLOBALS["rojWvnbZNAUBRjTQLXdg"], $filter_value);
                $selectedFilter[$filter_type] = $filter_value;
				$selectedFilter[$GLOBALS["IXCfKzsjlitrRiMXFvE"]] = explode($GLOBALS["MbajDNJRhmMOwGojscvU"], $filter_value);
                continue;
            }  
            if(in_array($filter_type, array('quantity', 'manufacturer', 'category'))){
                $selectedFilter[$filter_type][] = $filter_value;
                continue;
            }
            if(in_array($filter_type, array('id_feature'))){
                $feature_value = explode($GLOBALS["MbajDNJRhmMOwGojscvU"], $filter_value);
                                $selectedFilter[$filter_type][$feature_value[1]] = $feature_value[0].$GLOBALS["rojWvnbZNAUBRjTQLXdg"].$feature_value[1];
                continue;
            }
            $selectedFilter[$filter_type][$filter_id] = $filter_value;
        }
                return $selectedFilter;
    }
}
 ?>