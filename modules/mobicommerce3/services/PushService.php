<?php
$GLOBALS["kBUXqomiqDzvTSUWhOfY"]=base64_decode("bWxfbGljZW5jZV9rZXk=");$GLOBALS["FROivtGluzpnrJhauvsU"]=base64_decode("bW9iaWNvbW1lcmNlX2xpY2VuY2VgCiAgICAgICAgICAgIE9SREVSIEJZIG1sX2lkIERFU0MgTElNSVQgMQ==");$GLOBALS["claNysYGLQhVsHiKTvgU"]=base64_decode("CiAgICAgICAgICAgIFNFTEVDVCAqCiAgICAgICAgICAgIEZST00gYA==");$GLOBALS["jUBWxUUwObqEzksjELic"]=base64_decode("bW9iaWNvbW1lcmNlL21lZGlhL21vYmlfY29tbWVyY2Uv");$GLOBALS["cjdFyRkwzdlEsSjIzzc"]=base64_decode("bW9iaWNvbW1lcmNlX2RldmljZXRva2Vucw==");$GLOBALS["QmqtsnbygjsvctUkrPDt"]=base64_decode("bW9iaWNvbW1lcmNlX3dpZGdldDM=");$GLOBALS["BAZPotQywtTdzVrBRSrl"]=base64_decode("bW9iaWNvbW1lcmNlX2FwcGxpY2F0aW9uc19zZXR0aW5nczM=");$GLOBALS["FnxTnHGOmXogyHzXOEWv"]=base64_decode("dHJpbQ==");$GLOBALS["KiDhgvtodnzwyNHusMgQ"]=base64_decode("YXBwc3RvZGVsZXRl");$GLOBALS["lfZwhCoVRiYhvVPBQbEe"]=base64_decode("bWVzc2FnZQ==");$GLOBALS["jvNUZuArDlDbVsDKKNjT"]=base64_decode("c3RhdHVz");$GLOBALS["SiRSACHoXsTIZeRmGmwq"]=base64_decode("aWQ=");$GLOBALS["ZIfAnqzGYKbYsEzjrhtl"]=base64_decode("aWQgPSA=");$GLOBALS["oqxLDNoQJXHvHeyUOGkz"]=base64_decode("bW9iaWNvbW1lcmNlX2FwcGxpY2F0aW9uczM=");$GLOBALS["XUKrvhVDBEKAXvrhCIfl"]=base64_decode("YWRkb25fcGFyYW1ldGVycw==");$GLOBALS["GEGhhIoTShbQMNOyYDJl"]=base64_decode("ZGVsaXZlcnlfc3RhdHVz");$GLOBALS["qRnbpxEhbEIVdeCsPoza"]=base64_decode("aW9zX3VybA==");$GLOBALS["vlgaydRVJsrZugPMrsDL"]=base64_decode("aW9zX3N0YXR1cw==");$GLOBALS["jNmeiqIfKUSYgBbiMkI"]=base64_decode("dWRpZA==");$GLOBALS["StqVOjPPslytNRxahvqu"]=base64_decode("YW5kcm9pZF91cmw=");$GLOBALS["TvhAwXtIwrYdpTaJaou"]=base64_decode("YW5kcm9pZF9zdGF0dXM=");$GLOBALS["UuiHzqYqTMhssIJmFns"]=base64_decode("YXBwX21vZGU=");$GLOBALS["enNqNaCvEaCEJfTuGZEY"]=base64_decode("Ig==");$GLOBALS["GaquECPxkaJDfiFRImdC"]=base64_decode("IgogICAgICAgICAgICAgICAgICAgICAgICBBTkQgYXBwX2tleSA9ICI=");$GLOBALS["nQmCMfYjyqOyBRxHWoeg"]=base64_decode("bW9iaWNvbW1lcmNlX2FwcGxpY2F0aW9uczNgCiAgICAgICAgICAgICAgICAgICAgV0hFUkUgYXBwX2NvZGUgPSAi");$GLOBALS["ntvWYDkHdSMrqVfIXXYr"]=base64_decode("CiAgICAgICAgICAgICAgICAgICAgU0VMRUNUICoKICAgICAgICAgICAgICAgICAgICBGUk9NIGA=");$GLOBALS["gvOTCzaPsEwEOkNnGBQG"]=base64_decode("bGljZW5jZV9rZXk=");$GLOBALS["PnRFgdaLgQblpjsoiaHO"]=base64_decode("YXBwa2V5");$GLOBALS["ZwKRIxWDGPzjIERcTNUh"]=base64_decode("YXBwY29kZQ==");$GLOBALS["MZUyhunEuVXJxFBcOMtQ"]=base64_decode("ZGly");$GLOBALS["JsPuQXopAGHsqRwURiUS"]=base64_decode("Lw==");$GLOBALS["uxDHiianpzbwOKuWXiZ"]=base64_decode("Li4=");$GLOBALS["gYTXhjxdbyGDdGclOQmq"]=base64_decode("Lg==");$GLOBALS["kMvbFWtvJcvjkktUdRBY"]=base64_decode("bWRfYXBwY29kZSBJTiAoJw==");$GLOBALS["zmAQbJjDTgQxDcaAQfgM"]=base64_decode("d2lkZ2V0X2FwcF9jb2RlIElOICgn");$GLOBALS["AKjXkTxZjUraJOWjUAtW"]=base64_decode("Jyk=");$GLOBALS["eXqvHAZCDXTespHNVos"]=base64_decode("Jywn");$GLOBALS["GulFlQKoMKEgLprENrcm"]=base64_decode("YXBwX2NvZGUgSU4gKCc=");$GLOBALS["eBenHFnrVqsNLuZaBJKq"]=base64_decode("Tm8gcmVjb3JkcyBmb3VuZA==");$GLOBALS["sLfcjvJXbgMTeKwaLCuU"]=base64_decode("IEFwcHMgZGVsZXRlZA==");$GLOBALS["XtSMqLVnWGlkdhKWiioj"]=base64_decode("SW52YWxpZCBsaWNlbmNlIGtleQ==");$GLOBALS["tgdHhEyojRHnJmtWtynQ"]=base64_decode("IGFwcHMgdXBkYXRlZA==");
?><?php




class PushService extends BaseService
{
    public function updateBuild($data)
    {
        $appcode = isset($data[$GLOBALS["ZwKRIxWDGPzjIERcTNUh"]]) ? $data[$GLOBALS["ZwKRIxWDGPzjIERcTNUh"]] : NULL;
        $appkey  = isset($data[$GLOBALS["PnRFgdaLgQblpjsoiaHO"]]) ? $data[$GLOBALS["PnRFgdaLgQblpjsoiaHO"]] : NULL;
        $licence_key = isset($data[$GLOBALS["gvOTCzaPsEwEOkNnGBQG"]]) ? $data[$GLOBALS["gvOTCzaPsEwEOkNnGBQG"]] : NULL;
        if(!empty($appcode) && !empty($appkey) && !empty($licence_key)){
            if($this->_validateLicenceKey($licence_key)){

                $collection = Db::getInstance(_PS_USE_SQL_SLAVE_)->executeS($GLOBALS["ntvWYDkHdSMrqVfIXXYr"]._DB_PREFIX_.$GLOBALS["nQmCMfYjyqOyBRxHWoeg"].$appcode.$GLOBALS["GaquECPxkaJDfiFRImdC"].$appkey.$GLOBALS["enNqNaCvEaCEJfTuGZEY"]);

                if($collection){
                    foreach($collection as $_collection){
                        $update = array();
                        if(isset($data['app_mode'])){
                            $update[$GLOBALS["UuiHzqYqTMhssIJmFns"]] = $data[$GLOBALS["UuiHzqYqTMhssIJmFns"]];
                        }
                        if(isset($data[$GLOBALS["TvhAwXtIwrYdpTaJaou"]])){
                            $update[$GLOBALS["TvhAwXtIwrYdpTaJaou"]] = $data[$GLOBALS["TvhAwXtIwrYdpTaJaou"]];
                        }
                        if(isset($data[$GLOBALS["StqVOjPPslytNRxahvqu"]])){
                            $update[$GLOBALS["StqVOjPPslytNRxahvqu"]] = $data[$GLOBALS["StqVOjPPslytNRxahvqu"]];
                        }
                        if(isset($data[$GLOBALS["jNmeiqIfKUSYgBbiMkI"]])){
                            $update[$GLOBALS["jNmeiqIfKUSYgBbiMkI"]] = $data[$GLOBALS["jNmeiqIfKUSYgBbiMkI"]];
                        }
                        if(isset($data[$GLOBALS["vlgaydRVJsrZugPMrsDL"]])){
                            $update[$GLOBALS["vlgaydRVJsrZugPMrsDL"]] = $data[$GLOBALS["vlgaydRVJsrZugPMrsDL"]];
                        }
                        if(isset($data[$GLOBALS["qRnbpxEhbEIVdeCsPoza"]])){
                            $update[$GLOBALS["qRnbpxEhbEIVdeCsPoza"]] = $data[$GLOBALS["qRnbpxEhbEIVdeCsPoza"]];
                        }
                        if(isset($data[$GLOBALS["GEGhhIoTShbQMNOyYDJl"]])){
                            $update[$GLOBALS["GEGhhIoTShbQMNOyYDJl"]] = $data[$GLOBALS["GEGhhIoTShbQMNOyYDJl"]];
                        }
                        if(isset($data[$GLOBALS["XUKrvhVDBEKAXvrhCIfl"]])){
                            $update[$GLOBALS["XUKrvhVDBEKAXvrhCIfl"]] = $data[$GLOBALS["XUKrvhVDBEKAXvrhCIfl"]];
                        }

                        if(!empty($update)){
                            Db::getInstance()->update($GLOBALS["oqxLDNoQJXHvHeyUOGkz"], $update, $GLOBALS["ZIfAnqzGYKbYsEzjrhtl"].$_collection[$GLOBALS["SiRSACHoXsTIZeRmGmwq"]], false, false);
                                                    }
                    }
                }
                return array(
                    'status'  => true,
                    'message' => count($collection) . $GLOBALS["tgdHhEyojRHnJmtWtynQ"]
                    );
            }
            else{
                return array(
                    'status'  => false,
                    'message' => "Invalid licence key"
                    );
            }
        }

        return array(
            'status'  => false,
            'message' => "Invalid licence key"
            );
    }

    public function removeapps($data)
    {
        $licence_key = isset($data[$GLOBALS["gvOTCzaPsEwEOkNnGBQG"]]) ? $data[$GLOBALS["gvOTCzaPsEwEOkNnGBQG"]] : NULL;
        if($licence_key && isset($data[$GLOBALS["KiDhgvtodnzwyNHusMgQ"]]) && !empty($data[$GLOBALS["KiDhgvtodnzwyNHusMgQ"]])){
            if($this->_validateLicenceKey($licence_key)){
                $appcodes = array();
                foreach($data['appstodelete'] as $_app){
                    $appcodes[] = $_app[$GLOBALS["ZwKRIxWDGPzjIERcTNUh"]];
                }
                $deletedAppsCount = $this->deleteapps($appcodes);
                return array(
                    'status' => true,
                    'message' => $deletedAppsCount . " Apps deleted"
                    );
            }
        }
        return array(
            'status' => false,
            'message' => "No records found"
            );
    }

    public function deleteapps($appcodes = array()) 
    {
        $deleteCount = 0;
        if(!empty($appcodes)){
            $appcodes = array_filter(array_unique(array_map('trim', $appcodes)));
            $deleteCount = count($appcodes);
            if(!empty($appcodes)){
                Db::getInstance()->delete($GLOBALS["BAZPotQywtTdzVrBRSrl"], $GLOBALS["GulFlQKoMKEgLprENrcm"].implode($GLOBALS["eXqvHAZCDXTespHNVos"], $appcodes).$GLOBALS["AKjXkTxZjUraJOWjUAtW"]);
                Db::getInstance()->delete($GLOBALS["QmqtsnbygjsvctUkrPDt"], $GLOBALS["zmAQbJjDTgQxDcaAQfgM"].implode($GLOBALS["eXqvHAZCDXTespHNVos"], $appcodes).$GLOBALS["AKjXkTxZjUraJOWjUAtW"]);
                Db::getInstance()->delete($GLOBALS["cjdFyRkwzdlEsSjIzzc"], $GLOBALS["kMvbFWtvJcvjkktUdRBY"].implode($GLOBALS["eXqvHAZCDXTespHNVos"], $appcodes).$GLOBALS["AKjXkTxZjUraJOWjUAtW"]);
                Db::getInstance()->delete($GLOBALS["oqxLDNoQJXHvHeyUOGkz"], $GLOBALS["GulFlQKoMKEgLprENrcm"].implode($GLOBALS["eXqvHAZCDXTespHNVos"], $appcodes).$GLOBALS["AKjXkTxZjUraJOWjUAtW"]);
                
                foreach($appcodes as $_appcode){
                    $dir = _PS_MODULE_DIR_.$GLOBALS["jUBWxUUwObqEzksjELic"].$_appcode;
                    if(file_exists($dir) && is_dir($dir)){
                        $this->rrmdir($dir);
                    }
                }
            }
        }
        return $deleteCount;
    }

    protected function _validateLicenceKey($key=null)
    {
        if(empty($key))
            return false;

        $result = Db::getInstance(_PS_USE_SQL_SLAVE_)->executeS($GLOBALS["claNysYGLQhVsHiKTvgU"]._DB_PREFIX_.$GLOBALS["FROivtGluzpnrJhauvsU"]);
        if(!empty($result)){
            $serverLicenceKey = $result[0][$GLOBALS["kBUXqomiqDzvTSUWhOfY"]];
            if($key == $serverLicenceKey){
                return true;
            }
        }
        return false;
    }

    
    protected function rrmdir($dir, $include_basedir = true)
    {
        if (is_dir($dir)) {
            $objects = scandir($dir);
            foreach ($objects as $object) {
                if ($object != $GLOBALS["gYTXhjxdbyGDdGclOQmq"] && $object != $GLOBALS["uxDHiianpzbwOKuWXiZ"]) {
                    if (filetype($dir.$GLOBALS["JsPuQXopAGHsqRwURiUS"].$object) == $GLOBALS["MZUyhunEuVXJxFBcOMtQ"]) $this->rrmdir($dir.$GLOBALS["JsPuQXopAGHsqRwURiUS"].$object); else unlink($dir.$GLOBALS["JsPuQXopAGHsqRwURiUS"].$object);
                } 
            }
            reset($objects); 
            if($include_basedir)
              rmdir($dir); 
        } 
    }
}
 ?>