<?php
$GLOBALS["GfJKjzZNhFPZECvzNuLT"]=base64_decode("VGhlIGFkZHJlc3MgaGFzIGJlZW4gc2F2ZWQu");$GLOBALS["IqsFllUjlJsBKQcJWZEz"]=base64_decode("VGhpcyBjb3VudHJ5IHJlcXVpcmVzIGEgc3RhdGUgc2VsZWN0aW9uLg==");$GLOBALS["sXFAzYYlvJESUgLScLtJ"]=base64_decode("L15bMC05YS16QS1aIC1dezQsOX0kL3Vp");$GLOBALS["HMiwcEzNlrpoZvYfvNhB"]=base64_decode("aXMgcmVxdWlyZWQu");$GLOBALS["GUzErTlxbZmgjjCXdvqp"]=base64_decode("QQ==");$GLOBALS["aaVSngfyKHLQgxZvwrY"]=base64_decode("MA==");$GLOBALS["mqznzyHGHaXFQEzIDQNY"]=base64_decode("TXVzdCBiZSB0eXBlZCBhcyBmb2xsb3dzOg==");$GLOBALS["GkrOImiyITWvPAMmxHtI"]=base64_decode("PGJyIC8+");$GLOBALS["ydJAQAgQavnZwHeYSQeK"]=base64_decode("aXMgaW52YWxpZC4=");$GLOBALS["GZlfNEusoXPpdmipMUEm"]=base64_decode("PC9zdHJvbmc+IA==");$GLOBALS["OwdgYjuPPhwDkoiovQov"]=base64_decode("WmlwLyBQb3N0YWwgY29kZQ==");$GLOBALS["EKrYxSslVVthqhhGhHTv"]=base64_decode("PHN0cm9uZz4=");$GLOBALS["evDKuzaAtsMxrjearyg"]=base64_decode("Qw==");$GLOBALS["wEmyiowcxeXdrJJwTanM"]=base64_decode("W2EtekEtWl0=");$GLOBALS["RRSdJVKVVkEeLplDbHUy"]=base64_decode("TA==");$GLOBALS["FTOlpiUpPpkhqqwfYLkr"]=base64_decode("WzAtOV0=");$GLOBALS["GMWgxRjKWYDAdFBHVCPz"]=base64_decode("Tg==");$GLOBALS["hfllxwEtVShFEaFfgxon"]=base64_decode("KC18KQ==");$GLOBALS["ELkdWnXntlzZoMeKYinU"]=base64_decode("LQ==");$GLOBALS["LPCaqahCoioocaEJlzk"]=base64_decode("KCB8KQ==");$GLOBALS["ounCHQuYHLNhmXwuJtqz"]=base64_decode("JC91aQ==");$GLOBALS["zauhObEVQfcvgHoyzJEA"]=base64_decode("L14=");$GLOBALS["jzsISHRaYcAMSnMGtvCN"]=base64_decode("QWRkcmVzc1N0YW5kYXJkaXphdGlvblNvbHV0aW9uLnBocA==");$GLOBALS["TAsFCxXSQEmEbdEVswkx"]=base64_decode("VVM=");$GLOBALS["YCDsptNWmCmHWpXjReAi"]=base64_decode("WW91IG11c3QgcmVnaXN0ZXIgYXQgbGVhc3Qgb25lIHBob25lIG51bWJlci4=");$GLOBALS["BEqKbmRnnNkqkUxfUFWN"]=base64_decode("UFNfT05FX1BIT05FX0FUX0xFQVNU");$GLOBALS["KiOzLfZJBPkKLVwZhBnm"]=base64_decode("YWRkcmVzc18y");$GLOBALS["mUMIWkNxHVmuOiAKTnBv"]=base64_decode("YWRkcmVzc18x");$GLOBALS["yFoLRCpCxqJNidAOTqTt"]=base64_decode("YWxpYXM=");$GLOBALS["KweijIUSAnkiqrUsUlHq"]=base64_decode("YWRkcmVzc19pZA==");$GLOBALS["DpayoxepPcALBwuBZEwa"]=base64_decode("VGhpcyBhZGRyZXNzIGNhbm5vdCBiZSBkZWxldGVkLg==");$GLOBALS["jsNEahWuENiqVCYiuWPB"]=base64_decode("cmVnaW9u");$GLOBALS["ArdbgzhIAUwiyHBcivFl"]=base64_decode("dmFsaWRhdGVDb250cm9sbGVy");$GLOBALS["pTUOYHbwbHCGWVJNMlii"]=base64_decode("UHVzaG5vdGlmaWNhdGlvbg==");$GLOBALS["kkthtzTzpAJMHyzlJqfZ"]=base64_decode("dXNlcmlk");$GLOBALS["CNxdZqWtbEUodCNEYxhA"]=base64_decode("ZGV2aWNldG9rZW4=");$GLOBALS["ZwKRIxWDGPzjIERcTNUh"]=base64_decode("YXBwY29kZQ==");$GLOBALS["luWSvzIIcvylqTUWQNxv"]=base64_decode("cHVzaF9kZXZpY2V0b2tlbg==");$GLOBALS["tTNVJUzrJhllDhrUzpQI"]=base64_decode("Y3VzdG9tZXI=");$GLOBALS["kvrgZcimqQnsTnGrmgH"]=base64_decode("YWN0aW9uQXV0aGVudGljYXRpb24=");$GLOBALS["nYrpvbwPKUpZBzcETSxf"]=base64_decode("UFNfT1JERVJfUFJPQ0VTU19UWVBF");$GLOBALS["GEEwlrrngOEAdHYkSgc"]=base64_decode("UFNfQ0FSVF9GT0xMT1dJTkc=");$GLOBALS["STmpbcOnDgdtizmMiZlm"]=base64_decode("MS43");$GLOBALS["rnRYJMgcoKShFdHVrFfY"]=base64_decode("e3Bhc3N3ZH0=");$GLOBALS["PuQuMLIRBbfHrBQKeWHM"]=base64_decode("e2ZpcnN0bmFtZX0=");$GLOBALS["wBzUMnRaFxYCvTwYidFf"]=base64_decode("e2xhc3RuYW1lfQ==");$GLOBALS["ACVQhyvmpAAGAvCuYwTa"]=base64_decode("e2VtYWlsfQ==");$GLOBALS["egxvmxbzaEViaLFVIjlE"]=base64_decode("YWNjb3VudA==");$GLOBALS["hLAoZCFdRsQgAAnploKi"]=base64_decode("V2VsY29tZQ==");$GLOBALS["WcRHiphIGOwqZMKqoRPY"]=base64_decode("bA==");$GLOBALS["ByjelEgtPWsOHwzsrWg"]=base64_decode("TWFpbA==");$GLOBALS["jRoLhsfsiAeUhJKrALNg"]=base64_decode("Y3VzdG9tQXR0cmlidXRlcw==");$GLOBALS["ombfvMHYalYMZnQwHMK"]=base64_decode("bGFzdG5hbWUgbmFtZSBJbnZhbGlk");$GLOBALS["SfMjUhOMFQOEZAwolZHy"]=base64_decode("Zmlyc3QgbmFtZSBJbnZhbGlk");$GLOBALS["lxJuPRqZoSfNgzJOudsg"]=base64_decode("SW52YWxpZCBlLW1haWwgYWRkcmVzcw==");$GLOBALS["svbToKjsDeBKXBjiVdAk"]=base64_decode("bm8=");$GLOBALS["fCqDpHKuVGzBTdGdfrAb"]=base64_decode("QA==");$GLOBALS["qhJymdWpyVJoFTtbyogs"]=base64_decode("cGFzc3dvcmQ=");$GLOBALS["lRBzvzBSEQkJxdBItbg"]=base64_decode("LA==");$GLOBALS["wqNXbYUTvwDTFKnVYnxe"]=base64_decode("QW4gYWNjb3VudCB1c2luZyB0aGlzIGVtYWlsIGFkZHJlc3MgaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkLg==");$GLOBALS["ZZevGfLehHpFeizSKHWI"]=base64_decode("VGhlIGFjY291bnQgaW5mb3JtYXRpb24gaGFzIGJlZW4gc2F2ZWQu");$GLOBALS["lfZwhCoVRiYhvVPBQbEe"]=base64_decode("bWVzc2FnZQ==");$GLOBALS["jvNUZuArDlDbVsDKKNjT"]=base64_decode("c3RhdHVz");$GLOBALS["hisQaHmNwnXuxDABlXZJ"]=base64_decode("aWRfc3RhdGU=");$GLOBALS["bbAGmWKbjedCFATLKJma"]=base64_decode("Y291bnRyeV9jb2Rl");$GLOBALS["rYlIPOBrKjdNxIKNcBXZ"]=base64_decode("c3RyZWV0");$GLOBALS["iKLyShFQlpjmJpFfaoec"]=base64_decode("IA==");$GLOBALS["SiRSACHoXsTIZeRmGmwq"]=base64_decode("aWQ=");$GLOBALS["sTNZyWEMSHxWjCmIYtcB"]=base64_decode("IiAKICAgICAgICAgICAgICAgIEFORCBhLmFjdGl2ZSA9ICIxIiAKICAgICAgICAgICAgICAgIEFORCBhLmRlbGV0ZWQgPSAiMCIKICAgICAgICAgICAgR1JPVVAgQlkgYS5pZF9hZGRyZXNzCiAgICAgICAgICAgICAgICA=");$GLOBALS["ZsAxLZEQHvCzeRcYAKDz"]=base64_decode("c3RhdGUgQVMgcyBPTiAocy5pZF9zdGF0ZSA9IGEuaWRfc3RhdGUpCiAgICAgICAgICAgIFdIRVJFIGEuaWRfY3VzdG9tZXIgPSAi");$GLOBALS["gqtacZhHpXtUURvHxkKw"]=base64_decode("KQogICAgICAgICAgICBMRUZUIEpPSU4g");$GLOBALS["UzdQUGdPhtvwJUTDKOhF"]=base64_decode("Y291bnRyeV9sYW5nIEFTIGNsIE9OIChjbC5pZF9jb3VudHJ5ID0gYy5pZF9jb3VudHJ5IEFORCBjbC5pZF9sYW5nID0g");$GLOBALS["LViYfhlqIPTcFRufNNSk"]=base64_decode("Y291bnRyeSBBUyBjIE9OIChjLmlkX2NvdW50cnkgPSBhLmlkX2NvdW50cnkpCiAgICAgICAgICAgIExFRlQgSk9JTiA=");$GLOBALS["mlcTllSpDzcFZLangDo"]=base64_decode("YWRkcmVzcyBBUyBhCiAgICAgICAgICAgIExFRlQgSk9JTiA=");$GLOBALS["kDpdecFRXcnHPXTOxPnM"]=base64_decode("CiAgICAgICAgICAgIFNFTEVDVCBhLiosIGMuaXNvX2NvZGUgQVMgY291bnRyeV9jb2RlLCBjbC5uYW1lIEFTIGNvdW50cnksIHMubmFtZSBBUyByZWdpb24gRlJPTSA=");$GLOBALS["grxMrQxySSeGQsYdmPYb"]=base64_decode("YWRkcmVzc2Vz");$GLOBALS["rUVLMDNCwQuomgyFgSRa"]=base64_decode("c2hpcHBpbmdfYWRkcmVzcw==");$GLOBALS["ioiNpBIJqdbdxztuPQbp"]=base64_decode("Q2hlY2tvdXQ=");$GLOBALS["IioRvFMpbjxLVvTrXse"]=base64_decode("YmlsbGluZ19hZGRyZXNz");$GLOBALS["KbrGmRkAWSsuKqouUKWP"]=base64_decode("ZnVsbG5hbWU=");$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]=base64_decode("ZW1haWw=");$GLOBALS["vnikmTnwHXDcKJBQNHoK"]=base64_decode("TW9iaWNvbW1lcmNlaGVscGVy");$GLOBALS["nBsokqpBqDRpxvHdiuu"]=base64_decode("YXV0b2xvZ2luaWQ=");$GLOBALS["udsgbqFGtkNGuyKXxiuf"]=base64_decode("Y3VzdG9tZXJfaWQ=");$GLOBALS["jUJlFKAHJtuCBOaXqLAA"]=base64_decode("cGhvbmVfbW9iaWxl");$GLOBALS["LDaCknwxASaApkDZdzqc"]=base64_decode("cGhvbmU=");$GLOBALS["ZpUDbwPQocJrSAPpBgbL"]=base64_decode("Y29tcGFueQ==");$GLOBALS["eXzPUWlNwFsHWkMUnYUR"]=base64_decode("cG9zdGNvZGU=");$GLOBALS["GNgmbRbejfRAIZpcZGBR"]=base64_decode("Y291bnRyeV9pZA==");$GLOBALS["sZRAcUoqHGXbJrmuprel"]=base64_decode("aWRfY291bnRyeQ==");$GLOBALS["GNvpafcVjyBCEkcYYRA"]=base64_decode("c3RhdGU=");$GLOBALS["WKBChtIeVLMffdOLPBQn"]=base64_decode("Y2l0eQ==");$GLOBALS["LICtGLdwzIqFApaJRRXy"]=base64_decode("YWRkcmVzczI=");$GLOBALS["CaauDtHlPHjHNetsgjE"]=base64_decode("YWRkcmVzczE=");$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]=base64_decode("bGFzdG5hbWU=");$GLOBALS["FhzXsRsmAttmXNINpnhh"]=base64_decode("Zmlyc3RuYW1l");$GLOBALS["wSCtxSTvtRXPTULgPUHH"]=base64_decode("YWRkcmVzc19ib29rX2lk");$GLOBALS["hGyJOqOuWFEGkJEhqZvV"]=base64_decode("aWRfYWRkcmVzcw==");$GLOBALS["PdepTkCacGhHbSYynMub"]=base64_decode("SFRUUC8xLjEgNDA0IE5vdCBGb3VuZA==");$GLOBALS["QIfjBqYCYzCTbgddRxFH"]=base64_decode("SU5fTU9CSUNPTU1FUkNF");$GLOBALS["ZUKrugOOGNsUDYpyIlzG"]=base64_decode("IA==");
?><?php


if (!defined($GLOBALS["QIfjBqYCYzCTbgddRxFH"]))
{
    header($GLOBALS["PdepTkCacGhHbSYynMub"]);
    die();
}

class UserService extends BaseService
{
    private $addressFieldsMap = array(
        'id_address'   => 'address_book_id',
        'firstname'    => 'firstname',
        'lastname'     => 'lastname',
        'address1'     => 'address1',
        'address2'     => 'address2',
        'city'         => 'city',
        'state'        => 'state',
        'id_country'   => 'country_id',
        'postcode'     => 'postcode',
        'company'      => 'company',
        'phone'        => 'phone',
        'phone_mobile' => 'phone_mobile'
    );
    
    public function userTraslatore($customerInfo)
    {
       $userArray = array();
       $userArray['customer_id'] = $customerInfo->id;
       $userArray['autologinid'] = ServiceFactory::factory('Mobicommercehelper')->encrypt($customerInfo->id);
       $userArray[$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]] = $customerInfo->email;
       $userArray[$GLOBALS["FhzXsRsmAttmXNINpnhh"]] = $customerInfo->firstname;
       $userArray[$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]] = $customerInfo->lastname;
       $userArray[$GLOBALS["KbrGmRkAWSsuKqouUKWP"]] = $customerInfo->firstname.$GLOBALS["ZUKrugOOGNsUDYpyIlzG"].$customerInfo->lastname;
       $userArray[$GLOBALS["IioRvFMpbjxLVvTrXse"]] = ServiceFactory::factory($GLOBALS["ioiNpBIJqdbdxztuPQbp"])->getBillingAddress();
       $userArray[$GLOBALS["rUVLMDNCwQuomgyFgSRa"]] = ServiceFactory::factory($GLOBALS["ioiNpBIJqdbdxztuPQbp"])->getShippingAddress();
       $addresses = $this->getCustomerAddresses($customerInfo->id);
       $userArray[$GLOBALS["grxMrQxySSeGQsYdmPYb"]] = $addresses;
       return $userArray; 
    }

    
    public function getCustomerAddresses($customer_id)
    {
        $addresses = array();
        $sql = '
            SELECT a.*, c.iso_code AS country_code, cl.name AS country, s.name AS region FROM '._DB_PREFIX_.'address AS a
            LEFT JOIN '._DB_PREFIX_.'country AS c ON (c.id_country = a.id_country)
            LEFT JOIN '._DB_PREFIX_.'country_lang AS cl ON (cl.id_country = c.id_country AND cl.id_lang = '.$this->context->cookie->id_lang.')
            LEFT JOIN '._DB_PREFIX_.'state AS s ON (s.id_state = a.id_state)
            WHERE a.id_customer = "'.$customer_id.'" 
                AND a.active = "1" 
                AND a.deleted = "0"
            GROUP BY a.id_address
                ';
        if ($results = Db::getInstance()->ExecuteS($sql)){
            foreach($results as $row){
                $_address = $row;
                $_address[$GLOBALS["SiRSACHoXsTIZeRmGmwq"]]           = $row[$GLOBALS["hGyJOqOuWFEGkJEhqZvV"]];
                $_address[$GLOBALS["KbrGmRkAWSsuKqouUKWP"]]     = $row[$GLOBALS["FhzXsRsmAttmXNINpnhh"]].$GLOBALS["iKLyShFQlpjmJpFfaoec"].$row[$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]];
                $_address[$GLOBALS["rYlIPOBrKjdNxIKNcBXZ"]][0]    = $row[$GLOBALS["CaauDtHlPHjHNetsgjE"]];
                $_address[$GLOBALS["rYlIPOBrKjdNxIKNcBXZ"]][1]    = $row[$GLOBALS["LICtGLdwzIqFApaJRRXy"]];
                $_address[$GLOBALS["LDaCknwxASaApkDZdzqc"]]        = $row[$GLOBALS["LDaCknwxASaApkDZdzqc"]];
                $_address[$GLOBALS["jUJlFKAHJtuCBOaXqLAA"]] = $row[$GLOBALS["jUJlFKAHJtuCBOaXqLAA"]];
                $_address[$GLOBALS["GNgmbRbejfRAIZpcZGBR"]]   = $row[$GLOBALS["bbAGmWKbjedCFATLKJma"]];
                $addresses[] = $_address;
            }
        }
        return $addresses;
    }
    
    
    public function getUserInfo()
    {
        $customerInfo = array();
        if($this->context->cookie->id_customer) {
            $customer = new Customer((int)$this->context->cookie->id_customer);
            $customerInfo = $this->userTraslatore($customer->getByEmail($customer->email));
        }

        return $customerInfo;
    }
    
    
    public function checkAddressIntegrity($address)
    {
        if ($address) {
            return (int) $address[$GLOBALS["wSCtxSTvtRXPTULgPUHH"]] > 0
                    && $address[$GLOBALS["FhzXsRsmAttmXNINpnhh"]]
                    && $address[$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]]
                    && (int) $address[$GLOBALS["GNgmbRbejfRAIZpcZGBR"]] > 0
                    && $address[$GLOBALS["WKBChtIeVLMffdOLPBQn"]]
                    && $address[$GLOBALS["eXzPUWlNwFsHWkMUnYUR"]];
        }
        return false;
    }

    
    public function translateAddress($address)
    {
        $translatedAddress = array();
        $address['state'] = State::getNameById($address['id_state']);
        foreach ($this->addressFieldsMap as $key => $value) {
            $translatedAddress[$value] = $address[$key];
        }
        return $translatedAddress;
    }

    
    public function getAddresses()
    {
        $customer = new Customer($this->context->cookie->id_customer);
        if (!Validate::isLoadedObject($customer)) {
            return array();
        }

        $addressesInfo = $customer->getAddresses($this->context->cookie->id_lang);
        $addresses = array();
        foreach ($addressesInfo as $addresse) {
            $addresses[] = $this->translateAddress($addresse);
        }
        return $addresses;
    }

    public function checkEmailExists($email)
    {
        if (!empty($email)) {
            return Customer::customerExists($email, false, false);
        }
        return false;
    }
    
    public function update($userInfo)
    {
        $return = array(
            'status'  => true,
            'message' => $this->l('The account information has been saved.')
            );

        $customer = new Customer((int)$this->context->cookie->id_customer);
                {
            $customer->email  = $userInfo[$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]];
            $customer->firstname = $userInfo[$GLOBALS["FhzXsRsmAttmXNINpnhh"]];
            $customer->lastname = $userInfo[$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]];

            $errors = $customer->validateController();
            if ($this->context->customer->email != $userInfo[$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]] && Customer::customerExists($userInfo[$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]], true)) {
                $errors[] = Tools::displayError($GLOBALS["wqNXbYUTvwDTFKnVYnxe"]);
            }

            if(!empty($errors)){
                $return[$GLOBALS["jvNUZuArDlDbVsDKKNjT"]] = false;
                $return[$GLOBALS["lfZwhCoVRiYhvVPBQbEe"]] = implode($GLOBALS["lRBzvzBSEQkJxdBItbg"], $errors);
                return $return;
            }

            if($customer->update())
            {
                $this->context->cookie->id_customer = (int) ($customer->id);
                $this->context->cookie->customer_lastname = $customer->lastname;
                $this->context->cookie->customer_firstname = $customer->firstname;
                $this->context->cookie->passwd = $customer->passwd;
                $this->context->cookie->logged = 1;
                $this->context->cookie->email = $customer->email;
                $this->context->cookie->is_guest = $customer->is_guest;
                
                $this->context->cart->secure_key = $customer->secure_key;
                return $return;
            }
            else
            {
                $return[$GLOBALS["jvNUZuArDlDbVsDKKNjT"]] = false;
                return $return;
            }
        }
        
    }
    
    public function register($registerInfo) {
        $customer = new Customer();
        $customer->active = 1;
        $customer->is_guest = 0;
        $customer->email = $registerInfo[$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]];
        $customer->passwd = md5(_COOKIE_KEY_.$registerInfo[$GLOBALS["qhJymdWpyVJoFTtbyogs"]]);
        $name = explode($GLOBALS["fCqDpHKuVGzBTdGdfrAb"], $registerInfo[$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]]);
        $registerInfo[$GLOBALS["FhzXsRsmAttmXNINpnhh"]] == $name[0] && !Validate::isName($registerInfo[$GLOBALS["FhzXsRsmAttmXNINpnhh"]]) && $registerInfo[$GLOBALS["FhzXsRsmAttmXNINpnhh"]] = $GLOBALS["svbToKjsDeBKXBjiVdAk"];
        $customer->firstname = $registerInfo[$GLOBALS["FhzXsRsmAttmXNINpnhh"]];
        $customer->lastname = empty($registerInfo[$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]]) ? $GLOBALS["svbToKjsDeBKXBjiVdAk"] : $registerInfo[$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]];

        $error = array();
        Validate::isEmail($customer->email) || $error[] = Tools::displayError($GLOBALS["lxJuPRqZoSfNgzJOudsg"]);
        Validate::isName($customer->firstname) || $error[] = Tools::displayError($GLOBALS["SfMjUhOMFQOEZAwolZHy"]);
        Validate::isName($customer->lastname) || $error[] = Tools::displayError($GLOBALS["ombfvMHYalYMZnQwHMK"]);

        if (sizeof($error)) {
            return $error;
        }

        if(isset($registerInfo[$GLOBALS["jRoLhsfsiAeUhJKrALNg"]]) && !empty($registerInfo[$GLOBALS["jRoLhsfsiAeUhJKrALNg"]])){
            foreach($registerInfo[$GLOBALS["jRoLhsfsiAeUhJKrALNg"]] as $_attr_key => $_attr_value){
                $customer->$_attr_key = $_attr_value;
            }
        }

        
        
        if (!$customer->add()) {
            return false;
        } else {
            

                        
            
            $welcome = method_exists($GLOBALS["ByjelEgtPWsOHwzsrWg"], $GLOBALS["WcRHiphIGOwqZMKqoRPY"]) ? Mail::l($GLOBALS["hLAoZCFdRsQgAAnploKi"], $this->context->cookie->id_lang) : $GLOBALS["hLAoZCFdRsQgAAnploKi"];
            if (!$customer->is_guest) {
                Mail::Send($this->context->cookie->id_lang, $GLOBALS["egxvmxbzaEViaLFVIjlE"], $welcome, array('{email}' => $customer->email,
                    '{lastname}'  => $customer->lastname,
                    '{firstname}' => $customer->firstname,
                    '{passwd}'    => $registerInfo['password']), $customer->email, $customer->firstname . $GLOBALS["iKLyShFQlpjmJpFfaoec"] . $customer->lastname);
            }

            $this->context->cookie->id_customer = (int) ($customer->id);
            $this->context->cookie->customer_lastname = $customer->lastname;
            $this->context->cookie->customer_firstname = $customer->firstname;
            $this->context->cookie->passwd = $customer->passwd;
            $this->context->cookie->logged = 1;
            $this->context->cookie->email = $customer->email;
            $this->context->cookie->is_guest = $customer->is_guest;
            
            $this->context->cart->secure_key = $customer->secure_key;
            
            $this->context->cart->update();
        }
        return true;
    }

    public function checkUser($email,$pwd)
    {
        $customer = new Customer();
        $authentication = $customer->getByEmail(trim($email), trim($pwd));
        
        if (!$authentication || !$customer->id) {
            
            sleep(1);
            return false;
        } else {
            return true;
        }    
    } 
             
    
    public function login($loginInfo, $id = null)
    {
        if(empty($id)){
            $customer = new Customer();
            $authentication = $customer->getByEmail($loginInfo[$GLOBALS["VwCGqpUwTcGsnqOFNfAB"]], $loginInfo[$GLOBALS["qhJymdWpyVJoFTtbyogs"]]);
        }
        else{
            $authentication = true;
            $customer = new Customer($id);
        }
        
        if($customer->active != 1){
            $authentication = false;
        }
                
        if (!$authentication || !$customer->id) {
            
            sleep(1);
            return false;
        } else {
            
            

            if (_PS_VERSION_ < $GLOBALS["STmpbcOnDgdtizmMiZlm"]) {
                $this->context->cookie->id_compare = isset($this->context->cookie->id_compare) ? $this->context->cookie->id_compare: CompareProduct::getIdCompareByIdCustomer($customer->id);
            }
            $this->context->cookie->id_customer = (int)($customer->id);
            $this->context->cookie->customer_lastname = $customer->lastname;
            $this->context->cookie->customer_firstname = $customer->firstname;
            $this->context->cookie->logged = 1;
            $customer->logged = 1;
            $this->context->cookie->is_guest = $customer->isGuest();
            $this->context->cookie->passwd = $customer->passwd;
            $this->context->cookie->email = $customer->email;

                        $this->context->customer = $customer;

            if (Configuration::get($GLOBALS["GEEwlrrngOEAdHYkSgc"]) && (empty($this->context->cookie->id_cart) || Cart::getNbProducts($this->context->cookie->id_cart) == 0) && $id_cart = (int)Cart::lastNoneOrderedCart($this->context->customer->id)) {
                $this->context->cart = new Cart($id_cart);
            } else {
                $id_carrier = (int)$this->context->cart->id_carrier;
                $this->context->cart->id_carrier = 0;
                $this->context->cart->setDeliveryOption(null);
                $this->context->cart->id_address_delivery = (int)Address::getFirstCustomerAddressId((int)($customer->id));
                $this->context->cart->id_address_invoice = (int)Address::getFirstCustomerAddressId((int)($customer->id));
            }
            $this->context->cart->id_customer = (int)$customer->id;
            $this->context->cart->secure_key = $customer->secure_key;

            if ($this->ajax && isset($id_carrier) && $id_carrier && Configuration::get($GLOBALS["nYrpvbwPKUpZBzcETSxf"])) {
                $delivery_option = array($this->context->cart->id_address_delivery => $id_carrier.',');
                $this->context->cart->setDeliveryOption($delivery_option);
            }

            $this->context->cart->save();
            $this->context->cookie->id_cart = (int)$this->context->cart->id;
            $this->context->cookie->write();
            $this->context->cart->autosetProductAddress();

            Hook::exec($GLOBALS["kvrgZcimqQnsTnGrmgH"], array('customer' => $this->context->customer));

                        CartRule::autoRemoveFromCart($this->context);
            CartRule::autoAddToCart($this->context);

            

            $this->_loginFromMobile($this->context->cookie->id_customer);
            return true;
        }
    }

    protected function _loginFromMobile($customer_id)
    {
        $data = $_REQUEST;
        if(isset($data[$GLOBALS["luWSvzIIcvylqTUWQNxv"]]) && isset($data[$GLOBALS["ZwKRIxWDGPzjIERcTNUh"]])){
            $_data = array(
                'appcode'     => $data['appcode'],
                'devicetoken' => $data['push_devicetoken'],
                'userid'      => $customer_id
                );
                
            ServiceFactory::factory($GLOBALS["pTUOYHbwbHCGWVJNMlii"])->updateDeviceTokenUser($_data);
        }
    }

    
    private function prepareSqlDataArrayForAddress($address)
    {
        if (method_exists($address, $GLOBALS["ArdbgzhIAUwiyHBcivFl"])) {
            return $address->validateController();
        } else {
            return $address->validateControler();
        }
    }

    
    public function getAddress($addressBookId)
    {
        if (Address::addressExists($addressBookId)) {
            $address = new Address((int) $addressBookId, $this->context->cookie->id_lang);
            $address = $this->translateAddress($address->getFields());
            $address[$GLOBALS["rYlIPOBrKjdNxIKNcBXZ"]] = array($address['address1'], $address['address2']);

            if($address[$GLOBALS["GNvpafcVjyBCEkcYYRA"]])
            {
                $address[$GLOBALS["jsNEahWuENiqVCYiuWPB"]] = $address[$GLOBALS["GNvpafcVjyBCEkcYYRA"]];
            }
            return $address;
        } else {
            return array();
        }
    }

    
    public function deleteAddress($id_address)
    {
        $errorMessages = array();
        $id_address = (int) $id_address;
        $address = new Address($id_address);
        if (Validate::isLoadedObject($address) && Customer::customerHasAddress($this->context->customer->id, $id_address))
        {
            if ($address->delete())
            {
                if ($this->context->cart->id_address_invoice == $address->id)
                    unset($this->context->cart->id_address_invoice);
                if ($this->context->cart->id_address_delivery == $address->id)
                {
                    unset($this->context->cart->id_address_delivery);
                    $this->context->cart->updateAddressId($address->id, (int)Address::getFirstCustomerAddressId(Context::getContext()->customer->id));
                }
            }
            else {
                $errorMessages[] = Tools::displayError($GLOBALS["DpayoxepPcALBwuBZEwa"]);
            }
        }
        return sizeof($errorMessages) ? $errorMessages : true;
    }

    public function updateAddress($addressInfo)
    {
        $address = new Address();
        if($addressInfo[$GLOBALS["KweijIUSAnkiqrUsUlHq"]])
            $address = new Address($addressInfo[$GLOBALS["KweijIUSAnkiqrUsUlHq"]]);

        $country_id = $addressInfo[$GLOBALS["GNgmbRbejfRAIZpcZGBR"]];
        $id_country = Country::getByIso($country_id, true);

        $address->alias        = $addressInfo[$GLOBALS["yFoLRCpCxqJNidAOTqTt"]];
        $address->firstname    = $addressInfo[$GLOBALS["FhzXsRsmAttmXNINpnhh"]];
        $address->lastname     = $addressInfo[$GLOBALS["aSUcuRxxYGDxeyhLbbVE"]];
        $address->id_country   = $id_country;
        $address->city         = $addressInfo[$GLOBALS["WKBChtIeVLMffdOLPBQn"]];
        $address->address1     = $addressInfo[$GLOBALS["mUMIWkNxHVmuOiAKTnBv"]];
        $address->address2     = $addressInfo[$GLOBALS["KiOzLfZJBPkKLVwZhBnm"]];
        $address->postcode     = $addressInfo[$GLOBALS["eXzPUWlNwFsHWkMUnYUR"]];
        $address->phone        = $addressInfo[$GLOBALS["LDaCknwxASaApkDZdzqc"]];
        $address->phone_mobile = $addressInfo[$GLOBALS["jUJlFKAHJtuCBOaXqLAA"]];
		
        if(is_numeric($addressInfo[$GLOBALS["hisQaHmNwnXuxDABlXZJ"]])){
            $address->id_state = $addressInfo[$GLOBALS["hisQaHmNwnXuxDABlXZJ"]];
        }

        $address->id_customer = $this->context->cookie->id_customer;

        $errorMessages = $this->prepareSqlDataArrayForAddress($address);

        if (Configuration::get($GLOBALS["BEqKbmRnnNkqkUxfUFWN"]) && !$addressInfo[$GLOBALS["LDaCknwxASaApkDZdzqc"]] && !$addressInfo[$GLOBALS["jUJlFKAHJtuCBOaXqLAA"]]) {
            $errorMessages[] = Tools::displayError($GLOBALS["YCDsptNWmCmHWpXjReAi"]);
        }

        if (empty($errorMessages)) {
            if (!$country = new Country((int) $address->id_country) OR !Validate::isLoadedObject($country))
                $errorMessages[] = Tools::displayError();

            
            if ($address->id_country == Country::getByIso($GLOBALS["TAsFCxXSQEmEbdEVswkx"])) {
                if (file_exists(_PS_TAASC_PATH_ . $GLOBALS["jzsISHRaYcAMSnMGtvCN"])) {
                    include_once(_PS_TAASC_PATH_ . $GLOBALS["jzsISHRaYcAMSnMGtvCN"]);
                    $normalize = new AddressStandardizationSolution;
                    $address->address1 = $normalize->AddressLineStandardization($address->address1);
                    $address->address2 = $normalize->AddressLineStandardization($address->address2);
                }
            }

            $zip_code_format = $country->zip_code_format;
            if ($country->need_zip_code) {
                if (($address->postcode) AND $zip_code_format) {
                    $zip_regexp0 = $GLOBALS["zauhObEVQfcvgHoyzJEA"] . $zip_code_format . $GLOBALS["ounCHQuYHLNhmXwuJtqz"];
                    $zip_regexp1 = str_replace($GLOBALS["iKLyShFQlpjmJpFfaoec"], $GLOBALS["LPCaqahCoioocaEJlzk"], $zip_regexp0);
                    $zip_regexp2 = str_replace($GLOBALS["ELkdWnXntlzZoMeKYinU"], $GLOBALS["hfllxwEtVShFEaFfgxon"], $zip_regexp1);
                    $zip_regexp3 = str_replace($GLOBALS["GMWgxRjKWYDAdFBHVCPz"], $GLOBALS["FTOlpiUpPpkhqqwfYLkr"], $zip_regexp2);
                    $zip_regexp4 = str_replace($GLOBALS["RRSdJVKVVkEeLplDbHUy"], $GLOBALS["wEmyiowcxeXdrJJwTanM"], $zip_regexp3);
                    $zip_regexp = str_replace($GLOBALS["evDKuzaAtsMxrjearyg"], $country->iso_code, $zip_regexp4);
                    if (!preg_match($zip_regexp, $address->postcode))
                        $errorMessages[] = $GLOBALS["EKrYxSslVVthqhhGhHTv"] . Tools::displayError($GLOBALS["OwdgYjuPPhwDkoiovQov"]) . $GLOBALS["GZlfNEusoXPpdmipMUEm"] . Tools::displayError($GLOBALS["ydJAQAgQavnZwHeYSQeK"]) . $GLOBALS["GkrOImiyITWvPAMmxHtI"] . Tools::displayError($GLOBALS["mqznzyHGHaXFQEzIDQNY"]) . $GLOBALS["iKLyShFQlpjmJpFfaoec"] . str_replace($GLOBALS["evDKuzaAtsMxrjearyg"], $country->iso_code, str_replace($GLOBALS["GMWgxRjKWYDAdFBHVCPz"], $GLOBALS["aaVSngfyKHLQgxZvwrY"], str_replace($GLOBALS["RRSdJVKVVkEeLplDbHUy"], $GLOBALS["GUzErTlxbZmgjjCXdvqp"], $zip_code_format)));
                }
                elseif ($zip_code_format)
                    $errorMessages[] = $GLOBALS["EKrYxSslVVthqhhGhHTv"] . Tools::displayError($GLOBALS["OwdgYjuPPhwDkoiovQov"]) . $GLOBALS["GZlfNEusoXPpdmipMUEm"] . Tools::displayError($GLOBALS["HMiwcEzNlrpoZvYfvNhB"]);
                elseif ($address->postcode AND !preg_match($GLOBALS["sXFAzYYlvJESUgLScLtJ"], $address->postcode))
                    $errorMessages[] = $GLOBALS["EKrYxSslVVthqhhGhHTv"] . Tools::displayError($GLOBALS["OwdgYjuPPhwDkoiovQov"]) . $GLOBALS["GZlfNEusoXPpdmipMUEm"] . Tools::displayError($GLOBALS["ydJAQAgQavnZwHeYSQeK"]) . $GLOBALS["GkrOImiyITWvPAMmxHtI"] . Tools::displayError($GLOBALS["mqznzyHGHaXFQEzIDQNY"]) . $GLOBALS["iKLyShFQlpjmJpFfaoec"] . str_replace($GLOBALS["evDKuzaAtsMxrjearyg"], $country->iso_code, str_replace($GLOBALS["GMWgxRjKWYDAdFBHVCPz"], $GLOBALS["aaVSngfyKHLQgxZvwrY"], str_replace($GLOBALS["RRSdJVKVVkEeLplDbHUy"], $GLOBALS["GUzErTlxbZmgjjCXdvqp"], $zip_code_format)));
            }

            if ((int) ($country->contains_states) AND !(int) ($address->id_state))
                $errorMessages[] = Tools::displayError($GLOBALS["IqsFllUjlJsBKQcJWZEz"]);

                        if (!sizeof($errorMessages)) {
                $country = new Country((int) ($address->id_country));
                if (Validate::isLoadedObject($country) AND !$country->contains_states)
                    $address->id_state = 0;
                $address_old = new Address($addressInfo[$GLOBALS["KweijIUSAnkiqrUsUlHq"]]);
                
                if ($address->save()) {
                    $this->context->cart->id_address_invoice = (int) ($address->id);
                    $this->context->cart->update();
                }
            }
        }

        return sizeof($errorMessages) ? $errorMessages : $this->l($GLOBALS["GfJKjzZNhFPZECvzNuLT"]);
    }

    public function logout()
    {
        $this->context->cart->delete();
        $context = Context::getContext();
        $context->cookie->mylogout();
        $context->customer->logout();
        $context->customer->mylogout();
    }
}
 ?>